<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DIB Jobs // Integrated Console</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ==========================================================================
   NEO-BRUTALIST DESIGN SYSTEM
   ========================================================================== */
:root {
    --ink-black: #1a1a2e;
    --deep-blue: #4a6a8a;
    --warm-cream: #f8f6f1;
    --card-white: #ffffff;
    --bg-blue: #e8f0f6;
    --accent-clay: #e07a5f;
    --accent-gold: #f2cc8f;
    --accent-olive: #81b29a;
    --accent-mint: #d4e8dc;
    
    /* Chunky Tokens */
    --border: 3px solid var(--ink-black);
    --radius: 8px;
    --shadow: 6px 6px 0 var(--ink-black);
    --shadow-sm: 3px 3px 0 var(--ink-black);
    --shadow-hover: 8px 8px 0 var(--ink-black);
}

* { box-sizing: border-box; }
body { margin: 0; padding: 0; font-family: 'DM Sans', sans-serif; background: var(--bg-blue); color: var(--ink-black); height: 100vh; overflow: hidden; }
h1, h2, h3, h4, .mono { font-family: 'Space Mono', monospace; }

/* ==========================================================================
   APP LAYOUT (Split Pane)
   ========================================================================== */
.app-container {
    display: grid;
    grid-template-columns: 380px 1fr; /* Fixed Chat, Fluid Workspace */
    height: 100vh;
}

/* ==========================================================================
   LEFT PANEL: ARTI'S CONSOLE
   ========================================================================== */
.chat-panel {
    background: var(--warm-cream);
    border-right: var(--border);
    display: flex;
    flex-direction: column;
    height: 100%;
    z-index: 10;
    box-shadow: 10px 0 0 rgba(0,0,0,0.05);
}

.chat-header {
    padding: 20px;
    border-bottom: var(--border);
    background: var(--card-white);
    display: flex;
    align-items: center;
    gap: 12px;
}
.brand-logo {
    width: 40px; height: 40px; background: var(--ink-black); color: white;
    display: grid; place-items: center; font-family: 'Space Mono'; font-weight: 700;
    border-radius: 4px; font-size: 20px;
}
.brand-text h1 { font-size: 16px; font-weight: 700; text-transform: uppercase; line-height: 1.1; margin: 0; }
.brand-text span { font-size: 10px; opacity: 0.7; display: block; }

.chat-thread {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    background: var(--warm-cream);
}

/* Chat Bubbles - Neo Brutalist Style */
.msg-row { display: flex; gap: 10px; align-items: flex-start; }
.msg-row.user { flex-direction: row-reverse; }
.avatar { width: 32px; height: 32px; flex-shrink: 0; }
.avatar img { width: 100%; height: 100%; object-fit: contain; }
.bubble {
    max-width: 85%;
    padding: 14px 16px;
    font-size: 13px;
    line-height: 1.5;
    border: 2px solid var(--ink-black);
    box-shadow: var(--shadow-sm);
    position: relative;
}
.msg-row.arti .bubble {
    background: var(--card-white);
    border-radius: 12px;
    border-top-left-radius: 2px;
}
.msg-row.user .bubble {
    background: var(--ink-black);
    color: white;
    border-radius: 12px;
    border-top-right-radius: 2px;
}
.chat-chips {
    display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px;
}
.chip {
    font-family: 'Space Mono'; font-size: 10px; font-weight: 700;
    background: var(--accent-mint); border: 2px solid var(--ink-black);
    padding: 6px 10px; border-radius: 20px; cursor: pointer;
    transition: all 0.1s;
}
.chip:hover { transform: translate(-1px, -1px); box-shadow: 3px 3px 0 var(--ink-black); }

/* Chat Input */
.chat-input-area {
    padding: 20px;
    background: var(--card-white);
    border-top: var(--border);
}
.chat-input-wrapper { display: flex; gap: 10px; }
textarea.chat-box {
    flex: 1; border: 2px solid var(--ink-black); border-radius: 6px;
    padding: 12px; font-family: 'DM Sans'; font-size: 14px; resize: none; height: 50px;
}
textarea.chat-box:focus { outline: none; box-shadow: var(--shadow-sm); }
.send-btn {
    width: 50px; background: var(--ink-black); color: white; border: none;
    border-radius: 6px; cursor: pointer; font-family: 'Space Mono'; font-weight: 700;
}
.send-btn:hover { background: var(--deep-blue); }

/* ==========================================================================
   RIGHT PANEL: WORKSPACE
   ========================================================================== */
.workspace-panel {
    background: var(--bg-blue);
    overflow-y: auto;
    padding: 32px;
    display: flex;
    flex-direction: column;
    gap: 32px;
}

.workspace-container { max-width: 900px; margin: 0 auto; width: 100%; }

/* --- INPUT STATE --- */
#inputState { display: block; }
#dashboardState { display: none; }

.section-title {
    font-family: 'Space Mono'; font-size: 14px; font-weight: 700; 
    text-transform: uppercase; margin-bottom: 12px; 
    display: flex; align-items: center; gap: 10px;
}
.section-title::after { content:''; flex:1; height:2px; background:var(--ink-black); opacity:0.1; }

.input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
.input-card {
    background: var(--card-white);
    border: var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 20px;
    display: flex;
    flex-direction: column;
}
.input-header {
    font-family: 'Space Mono'; font-size: 12px; font-weight: 700; text-transform: uppercase;
    margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #eee;
}
textarea.big-input {
    width: 100%; min-height: 200px; border: none; resize: vertical;
    font-family: 'DM Sans'; font-size: 14px; background: transparent;
}
textarea.big-input:focus { outline: none; }

.primary-action-btn {
    width: 100%; padding: 16px; background: var(--accent-mint);
    border: var(--border); border-radius: var(--radius);
    font-family: 'Space Mono'; font-weight: 700; font-size: 16px;
    text-transform: uppercase; cursor: pointer; box-shadow: var(--shadow);
    transition: all 0.1s; margin-top: 24px; display: flex; align-items: center; justify-content: center; gap: 12px;
}
.primary-action-btn:hover { transform: translate(-2px, -2px); box-shadow: var(--shadow-hover); }

/* --- DASHBOARD STATE --- */
.hero-card {
    background: var(--ink-black); color: white;
    border: var(--border); border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 0; display: grid; grid-template-columns: 200px 1fr;
    overflow: hidden; margin-bottom: 24px;
}
.hero-score {
    background: var(--accent-olive); color: var(--ink-black);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    border-right: var(--border); padding: 30px;
}
.score-big { font-family: 'Space Mono'; font-size: 64px; font-weight: 700; line-height: 1; }
.score-label { font-family: 'Space Mono'; font-size: 11px; text-transform: uppercase; margin-top: 8px; }
.hero-details { padding: 30px; display: flex; flex-direction: column; justify-content: center; }
.hero-role { font-family: 'Space Mono'; font-size: 20px; font-weight: 700; margin-bottom: 8px; }
.hero-company { font-size: 16px; opacity: 0.8; }

.stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 24px; }
.stat-card {
    background: var(--card-white); border: var(--border); border-radius: var(--radius);
    padding: 16px; box-shadow: var(--shadow-sm); text-align: center;
}
.stat-val { font-family: 'Space Mono'; font-size: 24px; font-weight: 700; color: var(--ink-black); }
.stat-lbl { font-size: 11px; text-transform: uppercase; opacity: 0.6; margin-top: 4px; }

.split-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
.list-card {
    background: var(--card-white); border: var(--border); border-radius: var(--radius);
    padding: 20px; box-shadow: var(--shadow);
}
.list-item {
    padding: 10px; border: 2px solid var(--ink-black); margin-bottom: 10px;
    border-radius: 6px; font-size: 13px; background: white;
}
.list-item.match { border-left: 8px solid var(--accent-olive); }
.list-item.gap { border-left: 8px solid var(--accent-clay); }

/* --- TOOLS --- */
.tool-card {
    background: var(--card-white); border: var(--border); border-radius: var(--radius);
    margin-bottom: 24px; box-shadow: var(--shadow);
}
.tool-header {
    background: var(--warm-cream); padding: 14px 20px; border-bottom: 2px solid var(--ink-black);
    display: flex; justify-content: space-between; align-items: center; cursor: pointer;
}
.tool-content { padding: 20px; display: none; }
.tool-content.open { display: block; }

.generated-text {
    background: #fafafa; border: 1px dashed var(--ink-black); padding: 20px;
    font-family: 'Space Mono'; font-size: 12px; white-space: pre-wrap; margin-bottom: 16px;
}

/* RESPONSIVE */
@media (max-width: 900px) {
    .app-container { grid-template-columns: 1fr; grid-template-rows: 400px 1fr; overflow-y: auto; }
    .chat-panel { border-right: none; border-bottom: var(--border); }
    .hero-card { grid-template-columns: 1fr; text-align: center; }
    .hero-score { border-right: none; border-bottom: var(--border); padding: 20px; }
}
</style>
</head>
<body>

<div class="app-container">
    
    <aside class="chat-panel">
        <header class="chat-header">
            <div class="brand-logo">A</div>
            <div class="brand-text">
                <h1>DIB Jobs</h1>
                <span>Integrated Console</span>
            </div>
        </header>
        
        <div id="chatThread" class="chat-thread">
            </div>

        <div class="chat-input-area">
            <div class="chat-input-wrapper">
                <textarea id="chatInput" class="chat-box" placeholder="Ask Arti..." onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault(); sendChat();}"></textarea>
                <button class="send-btn" onclick="sendChat()">-></button>
            </div>
        </div>
    </aside>

    <main class="workspace-panel">
        <div class="workspace-container">
            
            <div id="inputState">
                <div class="hero-card" style="background:var(--warm-cream); color:var(--ink-black); display:flex; align-items:center; padding:30px; text-align:left;">
                    <div style="flex:1;">
                        <h2 style="font-size:24px; margin-bottom:8px;">Ready to Analyze.</h2>
                        <p style="font-size:14px; opacity:0.8;">Paste your details below. I'll generate your score, gap analysis, and application toolkit.</p>
                    </div>
                    <div style="font-size:40px;">ðŸ“‚</div>
                </div>

                <div class="input-grid">
                    <div class="input-card">
                        <div class="input-header">Your Resume</div>
                        <textarea id="resumeText" class="big-input" placeholder="Paste resume text..."></textarea>
                    </div>
                    <div class="input-card">
                        <div class="input-header">Job Description</div>
                        <textarea id="jdText" class="big-input" placeholder="Paste job description or URL..."></textarea>
                    </div>
                </div>

                <button class="primary-action-btn" onclick="analyzeJob()">
                    <span>Run Analysis</span>
                    <span>â†’</span>
                </button>
            </div>

            <div id="dashboardState">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                    <div class="section-title" style="margin:0;">Analysis Results</div>
                    <button class="mono" onclick="resetApp()" style="background:none; border:none; text-decoration:underline; cursor:pointer;">Start Over</button>
                </div>

                <div class="hero-card">
                    <div class="hero-score" id="scoreBg">
                        <span class="score-big" id="scoreVal">--</span>
                        <span class="score-label">Match Score</span>
                    </div>
                    <div class="hero-details">
                        <div class="hero-role" id="roleText">Analyzing...</div>
                        <div class="hero-company" id="companyText">--</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-val" id="salaryVal">--</div>
                        <div class="stat-lbl">Est. Salary</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-val" id="compVal">--</div>
                        <div class="stat-lbl">Competition</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-val" id="timelineVal">--</div>
                        <div class="stat-lbl">Time to Hire</div>
                    </div>
                </div>

                <div class="split-grid">
                    <div class="list-card">
                        <div class="input-header" style="color:var(--accent-olive);">Top Strengths</div>
                        <div id="strengthsList"></div>
                    </div>
                    <div class="list-card">
                        <div class="input-header" style="color:var(--accent-clay);">Critical Gaps</div>
                        <div id="gapsList"></div>
                    </div>
                </div>

                <div class="section-title">Toolkit</div>
                
                <div class="tool-card" id="emailTool">
                    <div class="tool-header" onclick="toggleTool('emailContent')">
                        <span class="mono" style="font-weight:700">// GENERATE INTRO EMAIL</span>
                        <span class="mono">+</span>
                    </div>
                    <div id="emailContent" class="tool-content">
                        <div id="emailOutput" class="generated-text" style="display:none;"></div>
                        <button class="primary-action-btn" onclick="generateEmail()" style="font-size:14px; padding:12px;">Draft Email</button>
                    </div>
                </div>

                <div class="tool-card">
                    <div class="tool-header" onclick="toggleTool('interviewContent')">
                        <span class="mono" style="font-weight:700">// INTERVIEW PREP</span>
                        <span class="mono">+</span>
                    </div>
                    <div id="interviewContent" class="tool-content">
                        <div id="interviewQuestions"></div>
                    </div>
                </div>

            </div>

        </div>
    </main>
</div>

<script>
// ==========================================================================
// CONFIG & STATE
// ==========================================================================
const API_ENDPOINT = 'https://76unm1rlj0.execute-api.us-east-1.amazonaws.com/default/grumpy2';
let appState = {
    step: 'INPUT', 
    resume: '',
    jd: '',
    analysis: null,
    chatHistory: []
};

// ==========================================================================
// INIT
// ==========================================================================
document.addEventListener('DOMContentLoaded', () => {
    addMessage('arti', "Welcome to the console. I'm Arti. Paste your resume and JD to the right, and I'll analyze your fit.");
});

// ==========================================================================
// CHAT LOGIC
// ==========================================================================
const chatThread = document.getElementById('chatThread');

function addMessage(sender, text, chips = []) {
    const div = document.createElement('div');
    div.className = `msg-row ${sender}`;
    
    let avatar = sender === 'arti' ? `<div class="avatar"><img src="arti.png" alt="A"></div>` : '';
    
    // Formatting
    let fmtText = text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    
    // Chips
    let chipsHtml = '';
    if(chips.length > 0) {
        chipsHtml = `<div class="chat-chips">
            ${chips.map(c => `<div class="chip" onclick="${c.action}">${c.label}</div>`).join('')}
        </div>`;
    }

    div.innerHTML = `
        ${avatar}
        <div class="bubble">
            <div>${fmtText}</div>
            ${chipsHtml}
        </div>
    `;
    
    chatThread.appendChild(div);
    chatThread.scrollTop = chatThread.scrollHeight;
}

function sendChat() {
    const input = document.getElementById('chatInput');
    const text = input.value.trim();
    if(!text) return;
    
    input.value = '';
    addMessage('user', text);
    
    // Add "Thinking" bubble
    const loadingId = 'load-' + Date.now();
    addMessage('arti', `<span id="${loadingId}">Thinking...</span>`);
    
    // API Call
    fetch(API_ENDPOINT, {
        method: 'POST',
        body: JSON.stringify({
            request_type: 'ask_expert',
            question: text,
            job_description: appState.jd,
            resume_text: appState.resume,
            analysis_data: appState.analysis,
            chat_history: appState.chatHistory.slice(-6)
        })
    })
    .then(r => r.json())
    .then(data => {
        document.getElementById(loadingId).closest('.msg-row').remove();
        addMessage('arti', data.response);
        appState.chatHistory.push({role:'user', content:text}, {role:'assistant', content:data.response});
    })
    .catch(e => {
        document.getElementById(loadingId).innerText = "Connection Error.";
    });
}

// ==========================================================================
// APP LOGIC
// ==========================================================================
function analyzeJob() {
    const r = document.getElementById('resumeText').value;
    const j = document.getElementById('jdText').value;
    
    if(!r || !j) {
        addMessage('arti', "I need both inputs to proceed.");
        return;
    }
    
    appState.resume = r;
    appState.jd = j;
    
    addMessage('arti', "Analyzing... give me a moment.");
    
    // Show Dashboard State (Loading)
    document.getElementById('inputState').style.display = 'none';
    document.getElementById('dashboardState').style.display = 'block';
    
    fetch(API_ENDPOINT, {
        method: 'POST',
        body: JSON.stringify({
            request_type: 'resume_match',
            job_description: j,
            resume_text: r
        })
    })
    .then(r => r.json())
    .then(data => {
        if(data.error) throw new Error(data.error);
        appState.analysis = data;
        renderDashboard(data);
        
        let msg = `Analysis complete. Score: **${data.score}%**. `;
        if(data.score > 80) msg += "Strong fit!";
        else if(data.score > 60) msg += "Good fit, check the gaps.";
        else msg += "Stretch role.";
        
        addMessage('arti', msg, [
            {label: "Draft Email", action: "triggerEmail()"},
            {label: "Prep Interview", action: "toggleTool('interviewContent', true)"}
        ]);
        
        // Fetch Intel
        fetchMarketIntel(j, data.job_title, data.company);
    })
    .catch(e => {
        addMessage('arti', "Error during analysis. Please try again.");
        document.getElementById('inputState').style.display = 'block';
        document.getElementById('dashboardState').style.display = 'none';
    });
}

function renderDashboard(data) {
    document.getElementById('scoreVal').textContent = data.score + '%';
    document.getElementById('roleText').textContent = data.job_title;
    document.getElementById('companyText').textContent = data.company;
    
    // Color coding
    const bg = data.score >= 80 ? 'var(--accent-olive)' : data.score >= 60 ? 'var(--accent-gold)' : 'var(--accent-clay)';
    document.getElementById('scoreBg').style.background = bg;
    
    // Lists
    const matches = data.analysis.filter(a => a.startsWith('Match:'));
    const gaps = data.analysis.filter(a => a.startsWith('Gap:'));
    
    document.getElementById('strengthsList').innerHTML = matches.map(m => 
        `<div class="list-item match">${m.replace('Match:', '')}</div>`
    ).join('');
    
    document.getElementById('gapsList').innerHTML = gaps.map(g => 
        `<div class="list-item gap">${g.replace('Gap:', '')}</div>`
    ).join('');
    
    // Interview
    document.getElementById('interviewQuestions').innerHTML = (data.interview_questions || []).map((q,i) => `
        <div style="margin-bottom:16px;">
            <div style="font-weight:700; margin-bottom:4px;">Q${i+1}: ${q.question}</div>
            <div style="font-size:13px; opacity:0.8;">${q.suggested_answer}</div>
        </div>
    `).join('');
}

function fetchMarketIntel(jd, title, company) {
    fetch(API_ENDPOINT, {
        method: 'POST',
        body: JSON.stringify({request_type: 'market_intel', job_description: jd, job_title: title, company: company})
    })
    .then(r => r.json())
    .then(data => {
        if(data.salary_intel) document.getElementById('salaryVal').textContent = `$${data.salary_intel.mid}k`;
        if(data.competition) document.getElementById('compVal').textContent = data.competition.level;
        if(data.timeline) document.getElementById('timelineVal').textContent = data.timeline.offer_weeks + " wks";
    });
}

function generateEmail() {
    addMessage('arti', "Drafting email...");
    fetch(API_ENDPOINT, {
        method: 'POST',
        body: JSON.stringify({
            request_type: 'generate_intro_email',
            job_description: appState.jd,
            resume_text: appState.resume,
            analysis_data: appState.analysis
        })
    })
    .then(r => r.json())
    .then(data => {
        const out = document.getElementById('emailOutput');
        out.style.display = 'block';
        out.textContent = data.intro_email;
        addMessage('arti', "Email drafted in toolkit.");
    });
}

function triggerEmail() {
    toggleTool('emailContent', true);
    generateEmail();
}

function toggleTool(id, forceOpen=false) {
    const el = document.getElementById(id);
    if(forceOpen) el.classList.add('open');
    else el.classList.toggle('open');
}

function resetApp() {
    document.getElementById('inputState').style.display = 'block';
    document.getElementById('dashboardState').style.display = 'none';
    appState.analysis = null;
    addMessage('arti', "Resetting console. Ready for new inputs.");
}

</script>
</body>
</html>