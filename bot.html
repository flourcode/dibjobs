<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arti // DIB Career Super-App</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ==========================================================================
   NEO-BRUTALIST SYSTEM
   ========================================================================== */
:root {
    --ink: #1a1a2e;
    --paper: #ffffff;
    --cream: #f8f6f1;
    --pale-blue: #c8dae8;
    --mint: #d4e8dc;
    --clay: #e07a5f;
    --gold: #f2cc8f;
    --olive: #81b29a;
    
    --border: 3px solid var(--ink);
    --shadow: 4px 4px 0 var(--ink);
    --radius: 12px;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; padding: 0; font-family: 'DM Sans', sans-serif; background: var(--pale-blue); color: var(--ink); height: 100vh; overflow: hidden; }
h1, h2, h3, .mono { font-family: 'Space Mono', monospace; }

/* APP FRAME */
.app-frame {
    max-width: 600px; margin: 0 auto; height: 100vh;
    background: var(--cream); border-left: var(--border); border-right: var(--border);
    display: flex; flex-direction: column; position: relative;
    box-shadow: 0 0 60px rgba(0,0,0,0.1);
}
@media(max-width: 650px) { .app-frame { border: none; width: 100%; } }

/* HEADER */
.app-header {
    padding: 16px 20px; border-bottom: var(--border); background: var(--paper);
    display: flex; justify-content: space-between; align-items: center; z-index: 10;
    flex-shrink: 0;
}
.brand { font-family: 'Space Mono'; font-weight: 700; font-size: 16px; display: flex; align-items: center; gap: 10px; text-transform: uppercase; }
.brand-avatar { width: 36px; height: 36px; }
.brand-avatar img { width: 100%; height: 100%; object-fit: contain; }

/* ==========================================================================
   VIEW CONTAINER (Swappable Tabs)
   ========================================================================== */
.view-container {
    flex: 1; overflow-y: auto; padding: 20px;
    display: none; /* Hidden by default */
    padding-bottom: 100px; /* Space for Nav */
}
.view-container.active { display: block; }

/* --------------------------------------------------------------------------
   VIEW 1: THE GURU (Chat)
   -------------------------------------------------------------------------- */
.chat-stream { display: flex; flex-direction: column; gap: 16px; }
.msg-row { display: flex; gap: 12px; align-items: flex-start; opacity: 0; animation: slideUp 0.3s forwards; }
.msg-row.user { flex-direction: row-reverse; }
.avatar { width: 32px; height: 32px; flex-shrink: 0; }
.bubble {
    max-width: 85%; padding: 14px 18px; border-radius: 12px;
    font-size: 14px; line-height: 1.5; border: 2px solid var(--ink);
    background: var(--paper); box-shadow: 3px 3px 0 rgba(0,0,0,0.05);
}
.msg-row.user .bubble { background: var(--ink); color: white; box-shadow: 3px 3px 0 rgba(0,0,0,0.2); }

/* Chat Options */
.chat-options { display: flex; flex-wrap: wrap; gap: 8px; margin-left: 44px; margin-top: 4px; }
.chat-btn {
    padding: 8px 14px; background: var(--paper); border: 2px solid var(--ink);
    border-radius: 20px; font-family: 'Space Mono'; font-weight: 700; font-size: 11px;
    cursor: pointer; transition: all 0.1s; box-shadow: 2px 2px 0 rgba(0,0,0,0.1);
}
.chat-btn:hover { transform: translate(-1px, -1px); box-shadow: 3px 3px 0 var(--ink); background: var(--mint); }
.chat-btn.disabled { opacity: 0.5; pointer-events: none; border-color: #ccc; box-shadow: none; }
.chat-btn.selected { background: var(--ink); color: white; opacity: 1; border-color: var(--ink); }

/* --------------------------------------------------------------------------
   VIEW 2: THE LAB (Input)
   -------------------------------------------------------------------------- */
.lab-header { margin-bottom: 24px; text-align: center; }
.lab-title { font-size: 24px; font-weight: 700; margin-bottom: 8px; line-height: 1.1; }
.lab-sub { font-size: 13px; opacity: 0.7; }

.input-card {
    background: var(--paper); border: var(--border); border-radius: var(--radius);
    padding: 20px; box-shadow: var(--shadow); margin-bottom: 20px;
}
.input-label { font-family: 'Space Mono'; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 10px; display: block; }
.chunky-input {
    width: 100%; height: 120px; padding: 14px; border: 2px solid var(--ink);
    border-radius: 8px; font-family: 'DM Sans'; font-size: 13px; resize: none;
    background: #fafafa; transition: all 0.2s;
}
.chunky-input:focus { outline: none; background: #fff; box-shadow: 3px 3px 0 var(--pale-blue); }

.analyze-btn {
    width: 100%; padding: 18px; background: var(--ink); color: white;
    font-family: 'Space Mono'; font-size: 16px; font-weight: 700; text-transform: uppercase;
    border: none; border-radius: 12px; cursor: pointer; box-shadow: var(--shadow);
    display: flex; justify-content: space-between; align-items: center;
    transition: transform 0.1s;
}
.analyze-btn:active { transform: translate(2px, 2px); box-shadow: none; }

/* --------------------------------------------------------------------------
   VIEW 3: THE REPORT (Results Dashboard)
   -------------------------------------------------------------------------- */
/* Score Hero */
.score-card {
    background: var(--ink); color: white; border: var(--border); border-radius: var(--radius);
    padding: 24px; margin-bottom: 20px; box-shadow: var(--shadow);
    display: flex; align-items: center; justify-content: space-between;
}
.score-circle {
    width: 80px; height: 80px; background: var(--olive); color: var(--ink);
    border-radius: 50%; display: grid; place-items: center;
    font-family: 'Space Mono'; font-weight: 700; font-size: 28px; border: 2px solid var(--ink);
}
.score-text { flex: 1; margin-left: 20px; }
.score-title { font-family: 'Space Mono'; font-size: 18px; font-weight: 700; margin-bottom: 4px; }
.score-sub { font-size: 12px; opacity: 0.8; }

/* Stats Grid */
.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
.stat-box {
    background: var(--paper); border: 2px solid var(--ink); border-radius: 8px;
    padding: 16px; text-align: center; box-shadow: 2px 2px 0 rgba(0,0,0,0.1);
}
.stat-num { font-family: 'Space Mono'; font-size: 18px; font-weight: 700; display: block; margin-bottom: 4px; }
.stat-lbl { font-size: 10px; text-transform: uppercase; opacity: 0.6; font-weight: 700; }

/* Keyword Pills */
.pill-area { margin-bottom: 24px; background: var(--paper); padding: 16px; border: 2px solid var(--ink); border-radius: 12px; }
.pill-title { font-family: 'Space Mono'; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 12px; display: block; }
.pills { display: flex; flex-wrap: wrap; gap: 8px; }
.pill {
    padding: 6px 12px; font-family: 'Space Mono'; font-size: 10px; font-weight: 700;
    border: 2px solid var(--ink); border-radius: 20px; background: #fff;
}
.pill.match { background: var(--mint); }
.pill.gap { background: var(--clay); color: white; border-color: var(--ink); }

/* Lists */
.list-group { margin-bottom: 20px; }
.list-item {
    background: var(--paper); border: 2px solid var(--ink); border-radius: 8px;
    padding: 12px; margin-bottom: 8px; font-size: 13px; line-height: 1.4;
    border-left-width: 6px;
}
.list-item.good { border-left-color: var(--olive); }
.list-item.bad { border-left-color: var(--clay); }

/* ==========================================================================
   BOTTOM NAV
   ========================================================================== */
.bottom-nav {
    position: absolute; bottom: 0; left: 0; right: 0;
    background: var(--paper); border-top: var(--border);
    display: flex; padding: 12px; gap: 12px; z-index: 100;
}
.nav-item {
    flex: 1; padding: 12px; text-align: center;
    font-family: 'Space Mono'; font-weight: 700; font-size: 11px; text-transform: uppercase;
    border: 2px solid transparent; border-radius: 8px; cursor: pointer; opacity: 0.5;
    transition: all 0.2s;
}
.nav-item.active { opacity: 1; background: var(--pale-blue); border-color: var(--ink); box-shadow: 2px 2px 0 var(--ink); }

/* Animations */
@keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<div class="app-frame">
    
    <header class="app-header">
        <div class="brand">
            <div class="brand-avatar"><img src="arti.png" alt="A"></div>
            <div>Arti // Super-App</div>
        </div>
        <div class="mono" style="font-size:10px;">BETA</div>
    </header>

    <div id="viewGuru" class="view-container active">
        <div id="chatStream" class="chat-stream">
            </div>
    </div>

    <div id="viewLab" class="view-container">
        <div class="lab-header">
            <div class="lab-title">The Job Lab</div>
            <div class="lab-sub">Paste your data. Get the stats.</div>
        </div>

        <div class="input-card">
            <span class="input-label">1. Job Description</span>
            <textarea id="jdText" class="chunky-input" placeholder="Paste JD text here..."></textarea>
        </div>

        <div class="input-card">
            <span class="input-label">2. Your Resume</span>
            <textarea id="resumeText" class="chunky-input" placeholder="Paste Resume text here..."></textarea>
        </div>

        <button class="analyze-btn" onclick="runFullAnalysis()">
            <span>Analyze Match</span>
            <span>â†’</span>
        </button>
    </div>

    <div id="viewReport" class="view-container">
        <div id="emptyReport" style="text-align:center; padding:40px; opacity:0.6;">
            <div style="font-size:40px; margin-bottom:10px;">ðŸ“Š</div>
            <p>No analysis yet.</p>
            <button class="chat-btn" onclick="switchTab('lab')">Go to Lab</button>
        </div>

        <div id="reportContent" style="display:none;">
            <div class="score-card">
                <div class="score-text">
                    <div class="score-title" id="resRole">Director of Sales</div>
                    <div class="score-sub" id="resCompany">AWS Federal</div>
                </div>
                <div class="score-circle" id="resScore">78%</div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <span class="stat-num" id="resSalary">$250k</span>
                    <span class="stat-lbl">Est. Salary</span>
                </div>
                <div class="stat-box">
                    <span class="stat-num" id="resComp">Med</span>
                    <span class="stat-lbl">Competition</span>
                </div>
            </div>

            <div class="pill-area">
                <span class="pill-title">Keyword Signals</span>
                <div class="pills" id="resPills"></div>
            </div>

            <div class="list-group">
                <span class="pill-title" style="color:var(--olive);">Top Strengths</span>
                <div id="resStrengths"></div>
            </div>
            
            <div class="list-group">
                <span class="pill-title" style="color:var(--clay);">Critical Gaps</span>
                <div id="resGaps"></div>
            </div>
            
            <div style="margin-top:30px; text-align:center;">
                <button class="chat-btn" onclick="switchTab('guru'); addMessage('arti', 'I can help you draft an email for this. Just ask.');">Ask Arti for Help</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" id="tab-guru" onclick="switchTab('guru')">ðŸ§­ Guru</div>
        <div class="nav-item" id="tab-lab" onclick="switchTab('lab')">ðŸ§ª The Lab</div>
        <div class="nav-item" id="tab-report" onclick="switchTab('report')">ðŸ“Š Report</div>
    </nav>

</div>

<script>
// ==========================================================================
// CONFIG
// ==========================================================================
const API_ENDPOINT = 'https://76unm1rlj0.execute-api.us-east-1.amazonaws.com/default/grumpy2';
let appState = {
    quiz: {},
    analysis: null
};

// ==========================================================================
// NAVIGATION
// ==========================================================================
function switchTab(tabName) {
    // Hide all
    document.querySelectorAll('.view-container').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    
    // Show Target
    document.getElementById('view' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
    document.getElementById('tab-' + tabName).classList.add('active');
}

// ==========================================================================
// VIEW 1: THE GURU (Chat Logic)
// ==========================================================================
const chatBox = document.getElementById('chatStream');

document.addEventListener('DOMContentLoaded', () => {
    startGuruFlow();
});

function addMessage(role, text) {
    const div = document.createElement('div');
    div.className = `msg-row ${role}`;
    let avatar = role === 'arti' ? `<div class="avatar"><img src="arti.png" alt="A"></div>` : '';
    div.innerHTML = `${avatar}<div class="bubble">${text}</div>`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function addOptions(options) {
    const div = document.createElement('div');
    div.className = 'chat-options';
    options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'chat-btn';
        btn.textContent = opt.label;
        btn.onclick = () => handleOption(btn, opt);
        div.appendChild(btn);
    });
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function handleOption(btn, opt) {
    // Freeze UI
    const parent = btn.parentElement;
    Array.from(parent.children).forEach(b => {
        b.classList.add('disabled');
        if(b === btn) b.classList.add('selected');
    });

    // Logic
    if (opt.val === 'start_quiz') {
        addMessage('arti', "Great. First question: What drives you most in your career?");
        setTimeout(() => addOptions([
            {label: "Money / Deals", val: "money", next: "q2"},
            {label: "Leadership", val: "people", next: "q2"},
            {label: "Tech / Product", val: "product", next: "q2"},
            {label: "Strategy", val: "puzzle", next: "q2"}
        ]), 600);
    } else if (opt.next === 'q2') {
        appState.quiz.driver = opt.val;
        addMessage('arti', "Got it. And what is your superpower?");
        setTimeout(() => addOptions([
            {label: "Persuasion", val: "talk", next: "q3"},
            {label: "Organization", val: "org", next: "q3"},
            {label: "Coding", val: "code", next: "q3"},
            {label: "Analysis", val: "strat", next: "q3"}
        ]), 600);
    } else if (opt.next === 'q3') {
        appState.quiz.skill = opt.val;
        addMessage('arti', "Final check: What is your clearance status?");
        setTimeout(() => addOptions([
            {label: "None", val: "none", next: "result"},
            {label: "Secret", val: "secret", next: "result"},
            {label: "TS / SCI", val: "ts", next: "result"}
        ]), 600);
    } else if (opt.next === 'result') {
        appState.quiz.clearance = opt.val;
        showArchetype();
    } else if (opt.val === 'goto_lab') {
        switchTab('lab');
    }
}

function startGuruFlow() {
    chatBox.innerHTML = '';
    setTimeout(() => addMessage('arti', "Hi, I'm Arti. I can help you analyze a job match, or help you find your career path."), 500);
    setTimeout(() => {
        addOptions([
            {label: "Analyze a Job", val: "goto_lab"},
            {label: "Find My Path", val: "start_quiz"}
        ]);
    }, 1200);
}

function showArchetype() {
    // Simple logic for demo
    let role = "Program Analyst";
    if (appState.quiz.driver === 'money') role = "Capture Manager";
    if (appState.quiz.driver === 'product') role = "Solutions Architect";
    
    addMessage('arti', `Based on your answers, you are a natural **${role}**.`);
    addMessage('arti', "I've unlocked the Analyzer tab for you. When you find a job description, paste it there.");
    
    // Add visual link
    const div = document.createElement('div');
    div.innerHTML = `<a href="https://www.linkedin.com/jobs/search/?keywords=${role}" target="_blank" style="display:block; margin:10px 0 10px 44px; padding:10px; background:white; border:2px solid #1a1a2e; border-radius:8px; text-decoration:none; color:#1a1a2e; font-family:'Space Mono'; font-size:12px;">Search ${role} Jobs â†—</a>`;
    chatBox.appendChild(div);
}

// ==========================================================================
// VIEW 2 & 3: ANALYZER & REPORT
// ==========================================================================
async function runFullAnalysis() {
    const r = document.getElementById('resumeText').value;
    const j = document.getElementById('jdText').value;
    
    if(!r || !j) { alert("Please paste both Resume and JD."); return; }
    
    const btn = document.querySelector('.analyze-btn');
    const oldText = btn.innerHTML;
    btn.innerHTML = "ANALYZING...";
    btn.disabled = true;
    
    try {
        const res = await fetch(API_ENDPOINT, {
            method: 'POST',
            body: JSON.stringify({
                request_type: 'resume_match',
                job_description: j,
                resume_text: r
            })
        });
        const data = await res.json();
        appState.analysis = data;
        
        // Render Report
        renderReport(data);
        
        // Switch Tab
        switchTab('report');
        
        // Notify in Chat
        addMessage('arti', `I finished the analysis. You scored **${data.score}%**. Check the Report tab.`);
        
        // Background fetch for intel
        fetchIntel(j, data.job_title, data.company);
        
    } catch(e) {
        alert("Error analyzing. Try again.");
    } finally {
        btn.innerHTML = oldText;
        btn.disabled = false;
    }
}

function renderReport(data) {
    document.getElementById('emptyReport').style.display = 'none';
    document.getElementById('reportContent').style.display = 'block';
    
    // Score
    document.getElementById('resScore').textContent = data.score + '%';
    document.getElementById('resRole').textContent = data.job_title;
    document.getElementById('resCompany').textContent = data.company;
    
    // Pills
    const pillBox = document.getElementById('resPills');
    pillBox.innerHTML = '';
    (data.keywords || []).forEach(k => {
        const span = document.createElement('span');
        span.className = `pill ${k.in_resume ? 'match' : 'gap'}`;
        span.textContent = k.term;
        pillBox.appendChild(span);
    });
    
    // Lists
    document.getElementById('resStrengths').innerHTML = data.analysis
        .filter(x => x.startsWith('Match:'))
        .map(x => `<div class="list-item good">${x.replace('Match:', '')}</div>`).join('');
        
    document.getElementById('resGaps').innerHTML = data.analysis
        .filter(x => x.startsWith('Gap:'))
        .map(x => `<div class="list-item bad">${x.replace('Gap:', '')}</div>`).join('');
}

function fetchIntel(jd, title, company) {
    fetch(API_ENDPOINT, {
        method: 'POST',
        body: JSON.stringify({request_type:'market_intel', job_description:jd, job_title:title, company:company})
    })
    .then(r => r.json())
    .then(d => {
        if(d.salary_intel) document.getElementById('resSalary').textContent = `$${d.salary_intel.mid}k`;
        if(d.competition) document.getElementById('resComp').textContent = d.competition.level;
    });
}

</script>
</body>
</html>