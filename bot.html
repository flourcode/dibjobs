<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DIB Jobs // Defense Industrial Base Jobs</title>
    <meta name="description" content="A job matching and application toolkit built for Defense Industrial Base professionals.">
    <link rel="canonical" href="https://dibjobs.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="DIB Jobs - Defense Industrial Base Job Matcher">
    <meta property="og:description" content="A job matching and application toolkit for Defense Industrial Base professionals.">
    <meta property="og:url" content="https://dibjobs.com/">
    <meta property="og:image" content="https://dibjobs.com/dibjobs.png">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ==========================================================================
   DIB JOBS - NEO-BRUTALIST STYLE
   ========================================================================== */

:root {
    --deep-blue: #4a6a8a;
    --soft-blue: #93b5d9;
    --pale-blue: #c8dae8;
    --warm-cream: #f8f6f1;
    --bg-cream: var(--warm-cream);
    --card-white: #FFFFFF;
    --ink-black: #3d4f5f;
    --accent-mint: var(--pale-blue);
    --accent-olive: var(--soft-blue);
    --accent-clay: #d4918a;
    --accent-gold: #e8c992;
    --border-thick: 2px;
    --shadow-hard: 5px 5px 0px var(--ink-black);
    --shadow-hover: 2px 2px 0px var(--ink-black);
    --radius: 6px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    background-color: var(--card-white);
    color: var(--ink-black);
    font-family: 'DM Sans', sans-serif;
    line-height: 1.6;
    min-height: 100vh;
    padding-bottom: 80px;
}

h1, h2, h3, .mono { font-family: 'Space Mono', monospace; }

header { background: var(--card-white); padding: 16px 24px; display: flex; align-items: center; }
.brand { display: flex; align-items: center; gap: 14px; }
.logo-icon { width: 44px; height: 44px; flex-shrink: 0; }
.brand-text { display: flex; flex-direction: column; gap: 2px; }
.app-title { font-family: 'Space Mono', monospace; font-size: 22px; font-weight: 700; text-transform: uppercase; letter-spacing: -0.5px; line-height: 1.1; }
.app-subtitle { font-family: 'Space Mono', monospace; font-size: 9px; text-transform: uppercase; letter-spacing: 0.5px; }

main { max-width: 1200px; margin: 20px auto; padding: 0 20px; }

.card { background: var(--card-white); border: var(--border-thick) solid var(--ink-black); border-radius: var(--radius); box-shadow: var(--shadow-hard); margin-bottom: 32px; overflow: hidden; }
.card-header { background: var(--accent-mint); border-bottom: var(--border-thick) solid var(--ink-black); padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
.card-title { font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; display: flex; align-items: center; gap: 8px; }
.card-title::before { content: ''; display: inline-block; width: 12px; height: 12px; background: var(--ink-black); border-radius: 50%; }
.card-title.has-avatar::before { display: none; }
.card-body { padding: 24px; }

/* STATS BAR */
.stats-bar { display: flex; gap: 16px; padding: 16px 20px; background: var(--bg-cream); border: var(--border-thick) solid var(--ink-black); border-radius: var(--radius); box-shadow: var(--shadow-hard); margin-bottom: 32px; flex-wrap: wrap; justify-content: center; }
.stat-item { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--card-white); border-radius: 4px; border: 1px solid var(--ink-black); }
.stat-value { font-family: 'Space Mono', monospace; font-weight: 700; font-size: 18px; color: var(--deep-blue); }
.stat-label { font-size: 12px; opacity: 0.7; }

/* COACH INTRO */
.coach-intro { background: var(--bg-cream); border: var(--border-thick) solid var(--ink-black); border-radius: var(--radius); box-shadow: var(--shadow-hard); margin-bottom: 32px; padding: 24px; display: flex; gap: 16px; align-items: flex-start; }
.coach-avatar { width: 48px; height: 48px; border-radius: var(--radius); flex-shrink: 0; }
.coach-text { flex: 1; font-size: 14px; line-height: 1.6; }
.coach-text strong { font-family: 'Space Mono', monospace; }

/* WORKFLOW */
.workflow-card { background: var(--card-white); border: var(--border-thick) solid var(--ink-black); border-radius: var(--radius); box-shadow: var(--shadow-hard); margin-bottom: 32px; overflow: hidden; }
.workflow-header { background: var(--accent-mint); border-bottom: var(--border-thick) solid var(--ink-black); padding: 16px 24px; display: flex; align-items: center; gap: 16px; }
.workflow-header-avatar { width: 36px; height: 36px; border-radius: var(--radius); }
.workflow-header h2 { font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 700; text-transform: uppercase; }
.workflow-steps { padding: 24px; }
.workflow-step { display: flex; gap: 16px; padding: 16px 0; border-bottom: 1px dashed rgba(0,0,0,0.15); }
.workflow-step:last-child { border-bottom: none; padding-bottom: 0; }
.workflow-step:first-child { padding-top: 0; }
.step-indicator { width: 36px; height: 36px; background: var(--ink-black); color: var(--card-white); font-family: 'Space Mono', monospace; font-weight: 700; font-size: 16px; display: grid; place-items: center; border-radius: 50%; flex-shrink: 0; }
.step-indicator.completed { background: var(--accent-olive); }
.step-content h3 { font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
.step-content p { font-size: 14px; line-height: 1.5; opacity: 0.8; }

/* FORMS */
textarea { width: 100%; min-height: 150px; padding: 16px; font-family: 'Space Mono', monospace; font-size: 14px; border: var(--border-thick) solid var(--ink-black); border-radius: var(--radius); background: #FAFAFA; resize: vertical; }
textarea:focus { outline: none; background: #FFFFFF; box-shadow: 4px 4px 0 rgba(0,0,0,0.1); }
.resume-controls { display: flex; gap: 8px; align-items: center; }
.resume-controls select { padding: 6px 10px; font-size: 11px; font-family: 'Space Mono', monospace; border: 2px solid var(--ink-black); border-radius: var(--radius); background: var(--card-white); cursor: pointer; max-width: 180px; }

/* BUTTONS */
.btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; font-family: 'Space Mono', monospace; font-weight: 700; font-size: 14px; text-transform: uppercase; color: var(--ink-black); background: var(--card-white); border: var(--border-thick) solid var(--ink-black); border-radius: var(--radius); cursor: pointer; box-shadow: var(--shadow-hard); transition: all 0.1s; }
.btn:hover:not(:disabled) { transform: translate(-2px, -2px); box-shadow: 7px 7px 0 var(--ink-black); }
.btn:active:not(:disabled) { transform: translate(2px, 2px); box-shadow: 1px 1px 0 var(--ink-black); }
.btn-primary { background: var(--accent-olive); color: #fff; }
.btn-secondary { background: var(--card-white); }
.btn:disabled { opacity: 0.6; cursor: not-allowed; box-shadow: none; }
.action-bar { margin-top: 16px; display: flex; gap: 12px; flex-wrap: wrap; }

/* SCORE HERO */
.hero-grid { display: grid; grid-template-columns: 200px 1fr; border-bottom: var(--border-thick) solid var(--ink-black); }
.score-box { background: var(--ink-black); color: var(--card-white); padding: 40px 20px; text-align: center; display: flex; flex-direction: column; justify-content: center; }
.score-val { font-family: 'Space Mono', monospace; font-size: 80px; line-height: 1; font-weight: 700; }
.score-label { font-family: 'Space Mono', monospace; text-transform: uppercase; font-size: 12px; letter-spacing: 2px; opacity: 0.8; margin-top: 10px; }
.verdict-box { padding: 32px; display: flex; flex-direction: column; justify-content: center; background: var(--bg-cream); }
.score-high .score-box { background: var(--accent-olive); color: #fff; }
.score-mid .score-box { background: var(--accent-gold); color: var(--ink-black); }
.score-low .score-box { background: var(--accent-clay); color: #fff; }

/* COACH COMMENTARY */
.coach-commentary { display: flex; gap: 16px; padding: 20px 24px; background: rgba(147, 181, 217, 0.15); border-top: var(--border-thick) solid var(--ink-black); align-items: flex-start; }
.coach-commentary img { width: 40px; height: 40px; border-radius: var(--radius); flex-shrink: 0; }
.coach-commentary p { font-size: 14px; line-height: 1.6; }

/* INTEL */
.intel-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; margin-bottom: 24px; }
.intel-panel { background: var(--bg-cream); border: 2px solid var(--ink-black); padding: 20px; border-radius: var(--radius); }
.intel-panel-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 2px dashed var(--ink-black); }
.intel-panel-title { font-family: 'Space Mono', monospace; font-size: 12px; font-weight: 700; text-transform: uppercase; }
.intel-value { font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 700; margin-bottom: 4px; }
.intel-label { font-size: 12px; opacity: 0.7; }
.intel-badge { font-family: 'Space Mono', monospace; font-size: 10px; padding: 3px 8px; border-radius: 3px; font-weight: 700; }
.intel-badge.green { background: var(--accent-mint); }
.intel-badge.gold { background: var(--accent-gold); }
.intel-badge.clay { background: var(--accent-clay); color: #fff; }

/* SALARY */
.salary-range-bar { height: 24px; background: linear-gradient(90deg, var(--accent-clay) 0%, var(--accent-gold) 50%, var(--accent-mint) 100%); border-radius: 12px; position: relative; margin: 20px 0 30px; border: 2px solid var(--ink-black); }
.salary-marker { position: absolute; top: -8px; width: 4px; height: 40px; background: var(--ink-black); transform: translateX(-50%); }
.salary-marker::after { content: attr(data-label); position: absolute; top: 44px; left: 50%; transform: translateX(-50%); font-family: 'Space Mono', monospace; font-size: 10px; white-space: nowrap; }
.salary-labels { display: flex; justify-content: space-between; font-family: 'Space Mono', monospace; font-size: 12px; }

/* TIMELINE */
.timeline-estimate { display: flex; margin: 16px 0; padding: 0 10px; }
.timeline-step { flex: 1; text-align: center; position: relative; }
.timeline-step::after { content: ''; position: absolute; top: 12px; left: 50%; width: 100%; height: 2px; background: var(--ink-black); }
.timeline-step:last-child::after { display: none; }
.timeline-dot { width: 26px; height: 26px; background: var(--card-white); border: 2px solid var(--ink-black); border-radius: 50%; margin: 0 auto 6px; position: relative; z-index: 1; display: grid; place-items: center; font-size: 12px; font-weight: 700; }
.timeline-label { font-family: 'Space Mono', monospace; font-size: 9px; text-transform: uppercase; }
.timeline-days { font-size: 10px; opacity: 0.6; margin-top: 2px; }

/* CHAT */
.chat-section { background: var(--card-white); border: var(--border-thick) solid var(--ink-black); border-radius: var(--radius); box-shadow: var(--shadow-hard); margin-bottom: 32px; overflow: hidden; }
.chat-header { background: var(--accent-mint); border-bottom: var(--border-thick) solid var(--ink-black); padding: 16px 24px; display: flex; align-items: center; gap: 12px; }
.chat-header img { width: 48px; height: 48px; border-radius: var(--radius); }
.chat-header-text h3 { font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 700; text-transform: uppercase; }
.chat-header-text p { font-size: 12px; opacity: 0.8; }
.chat-messages { max-height: 400px; overflow-y: auto; padding: 20px 24px; background: var(--bg-cream); }
.chat-message { display: flex; gap: 12px; margin-bottom: 16px; }
.chat-message:last-child { margin-bottom: 0; }
.chat-message.user { flex-direction: row-reverse; }
.chat-message-avatar { width: 32px; height: 32px; border-radius: var(--radius); flex-shrink: 0; background: var(--accent-mint); border: 2px solid var(--ink-black); display: flex; align-items: center; justify-content: center; }
.chat-message-bubble { max-width: 80%; padding: 12px 16px; border-radius: var(--radius); font-size: 14px; line-height: 1.5; border: 2px solid var(--ink-black); }
.chat-message.coach .chat-message-bubble { background: white; }
.chat-message.user .chat-message-bubble { background: var(--ink-black); color: white; }
.chat-input-area { padding: 16px 24px; border-top: 2px solid var(--ink-black); display: flex; gap: 12px; }
.chat-input { flex: 1; padding: 12px 16px; border: 2px solid var(--ink-black); border-radius: var(--radius); font-size: 14px; }
.chat-input:focus { outline: none; }
.chat-suggestions { display: flex; gap: 8px; flex-wrap: wrap; padding: 0 24px 16px; background: var(--bg-cream); }
.chat-suggestion { padding: 8px 14px; font-size: 12px; font-family: 'Space Mono', monospace; background: white; border: 1px solid var(--ink-black); border-radius: var(--radius); cursor: pointer; }
.chat-suggestion:hover { background: var(--ink-black); color: white; }

/* ANALYSIS */
.analysis-list { list-style: none; display: flex; flex-direction: column; gap: 16px; }
.analysis-item { padding: 16px 20px; border: 2px solid var(--ink-black); border-radius: var(--radius); font-size: 14px; background: #fff; }
.analysis-item strong { display: block; font-family: 'Space Mono', monospace; font-size: 11px; text-transform: uppercase; margin-bottom: 6px; }
.item-match { background: rgba(107, 155, 122, 0.12); border-left: 8px solid var(--accent-olive); }
.item-match strong { color: var(--deep-blue); }
.item-gap { background: rgba(209, 143, 122, 0.12); border-left: 8px solid var(--accent-clay); }
.item-gap strong { color: #b5705e; }

/* Q&A */
.qa-card { background: #fff; border: 2px solid var(--ink-black); margin-bottom: 20px; box-shadow: 4px 4px 0 rgba(0,0,0,0.05); }
.qa-q { background: var(--accent-mint); padding: 12px 20px; font-family: 'Space Mono', monospace; font-weight: 700; font-size: 13px; border-bottom: 2px solid var(--ink-black); }
.qa-a { padding: 20px; font-size: 14px; line-height: 1.6; }

/* KEYWORDS */
.keyword-cloud { display: flex; flex-wrap: wrap; gap: 8px; }
.keyword-tag { display: inline-flex; padding: 6px 12px; background: var(--card-white); border: 2px solid var(--ink-black); border-radius: 20px; font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 600; cursor: pointer; }
.keyword-tag:hover { background: var(--ink-black); color: var(--card-white); }
.keyword-tag.in-resume { background: var(--accent-mint); border-color: var(--deep-blue); }
.keyword-tag.missing { background: rgba(209, 143, 122, 0.2); border-color: var(--accent-clay); }

/* KIT */
.kit-section { padding: 20px 0; }
.kit-section:first-child { padding-top: 24px; }
.kit-section-title { font-family: 'Space Mono', monospace; font-size: 12px; font-weight: 700; text-transform: uppercase; margin-bottom: 12px; }
.kit-divider { border: none; border-top: 1px dashed rgba(0,0,0,0.2); margin: 0; }
.resume-paper.compact { font-size: 13px; padding: 16px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; background: #fff; border: 1px solid #ddd; }

/* TEMPLATES */
.template-tabs { display: flex; gap: 0; }
.template-tab { padding: 12px 20px; font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 700; text-transform: uppercase; background: var(--bg-cream); border: 2px solid var(--ink-black); border-bottom: none; cursor: pointer; margin-right: -2px; }
.template-tab.active { background: var(--card-white); z-index: 1; }
.template-content { border: 2px solid var(--ink-black); padding: 20px; background: var(--card-white); margin-top: -2px; }
.template-text { font-size: 14px; line-height: 1.7; white-space: pre-wrap; background: #fafafa; padding: 20px; border: 1px dashed var(--ink-black); border-radius: var(--radius); }

/* NETWORK */
.network-links { display: flex; flex-wrap: wrap; gap: 10px; }
.network-link { display: inline-flex; padding: 10px 16px; background: var(--card-white); border: 2px solid var(--ink-black); border-radius: var(--radius); font-family: 'Space Mono', monospace; font-size: 12px; font-weight: 600; text-decoration: none; color: var(--ink-black); box-shadow: 3px 3px 0 rgba(0,0,0,0.1); }
.network-link:hover { transform: translate(-2px, -2px); box-shadow: 5px 5px 0 rgba(0,0,0,0.15); background: var(--accent-mint); }

/* JOB SEARCH */
.job-search-grid { display: flex; flex-wrap: wrap; gap: 8px; }
.job-search-link { display: inline-block; padding: 8px 14px; background: var(--card-white); border: 2px solid var(--ink-black); border-radius: var(--radius); font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 600; text-decoration: none; color: var(--ink-black); }
.job-search-link:hover { background: var(--ink-black); color: var(--card-white); }

/* TRACKER */
.tracker-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.tracker-table th { font-family: 'Space Mono', monospace; font-size: 10px; text-transform: uppercase; text-align: left; padding: 10px 8px; background: var(--bg-cream); border: 2px solid var(--ink-black); }
.tracker-table td { padding: 10px 8px; border: 2px solid var(--ink-black); font-size: 12px; }
.tracker-table tr:hover td { background: rgba(147, 181, 217, 0.1); }
.tracker-actions { display: flex; gap: 6px; }
.tracker-btn { padding: 4px 8px; font-size: 10px; border: 1px solid var(--ink-black); background: var(--card-white); cursor: pointer; border-radius: 3px; font-family: 'Space Mono', monospace; }
.tracker-btn:hover { background: var(--ink-black); color: var(--card-white); }
.empty-tracker { text-align: center; padding: 40px; background: var(--bg-cream); border: 2px dashed var(--ink-black); border-radius: var(--radius); font-size: 14px; opacity: 0.7; }

/* COLLAPSIBLE */
.collapsible-card { overflow: hidden; }
.collapsible-trigger { cursor: pointer; user-select: none; }
.collapsible-trigger:hover { background: rgba(255,255,255,0.5); }
.collapsible-content { border-top: var(--border-thick) solid var(--ink-black); }
.collapsible-card.collapsed .collapsible-content { display: none; }

/* QUICK START CARD */
.stats-compact {
    display: flex;
    gap: 16px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
}

.stats-compact span { opacity: 0.8; }
.stats-compact strong { color: var(--deep-blue); }

.quick-intro {
    padding-bottom: 16px;
    margin-bottom: 16px;
    border-bottom: 1px dashed rgba(0,0,0,0.15);
    font-size: 14px;
    line-height: 1.5;
}

.quick-intro strong { font-family: 'Space Mono', monospace; }

.stats-row {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.stat-box {
    flex: 1;
    min-width: 100px;
    padding: 12px 16px;
    background: var(--bg-cream);
    border: 1px solid var(--ink-black);
    border-radius: var(--radius);
    text-align: center;
}

.stat-box .stat-value {
    font-family: 'Space Mono', monospace;
    font-size: 20px;
    font-weight: 700;
    color: var(--deep-blue);
    display: block;
}

.stat-box .stat-label {
    font-size: 10px;
    text-transform: uppercase;
    opacity: 0.7;
}

.game-plan {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.plan-step {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 12px 16px;
    background: var(--bg-cream);
    border-radius: var(--radius);
}

.step-num {
    width: 32px;
    height: 32px;
    background: var(--ink-black);
    color: white;
    font-family: 'Space Mono', monospace;
    font-weight: 700;
    font-size: 14px;
    display: grid;
    place-items: center;
    border-radius: 50%;
    flex-shrink: 0;
}

.step-num.completed {
    background: var(--accent-olive);
}

.step-info strong {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    text-transform: uppercase;
    display: block;
    margin-bottom: 2px;
}

.step-info span {
    font-size: 13px;
    opacity: 0.75;
}

@media (max-width: 600px) {
    .stats-compact { display: none; }
    .stats-row { flex-direction: column; }
    .stat-box { min-width: auto; }
}

/* LOADING */
@keyframes spin { to { transform: rotate(360deg); } }

/* ERRORS */
.inline-error { background: rgba(209, 143, 122, 0.15); border: 2px solid var(--accent-clay); border-left: 6px solid var(--accent-clay); border-radius: var(--radius); padding: 16px 20px; margin-top: 16px; font-family: 'Space Mono', monospace; font-size: 13px; color: #b5705e; display: none; align-items: center; gap: 12px; }
.inline-error.show { display: flex; }
.error-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--accent-clay); color: var(--ink-black); padding: 16px 24px; font-family: 'Space Mono', monospace; font-weight: 700; font-size: 13px; border-radius: var(--radius); border: var(--border-thick) solid var(--ink-black); box-shadow: var(--shadow-hard); opacity: 0; z-index: 1000; display: flex; align-items: center; gap: 12px; }
.error-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.error-toast-close { background: none; border: none; font-size: 18px; cursor: pointer; font-family: 'Space Mono', monospace; font-weight: 700; }

/* RESPONSIVE */
@media (max-width: 768px) { .hero-grid { grid-template-columns: 1fr; } .score-box { padding: 20px; flex-direction: row; gap: 20px; align-items: center; } .score-val { font-size: 48px; } .card-body { padding: 20px; } }
@media (max-width: 600px) { .stats-bar { flex-direction: column; } .tracker-table th:nth-child(5), .tracker-table td:nth-child(5) { display: none; } .workflow-step { flex-direction: column; text-align: center; } }
@media (max-width: 500px) { .resume-controls { width: 100%; } .brand { gap: 10px; } .logo-icon { width: 36px; height: 36px; } .app-title { font-size: 18px; } }
</style>
</head>
<body>

<header>
    <div class="brand">
        <img src="arti.png" alt="DIB Jobs" class="logo-icon">
        <div class="brand-text">
            <span class="app-title">DIB Jobs</span>
            <span class="app-subtitle">Defense Industrial Base Job Matcher</span>
        </div>
    </div>
</header>

<main>
    <!-- QUICK START (Combined: stats, intro, game plan) -->
    <div class="card collapsible-card" id="quickStartCard">
        <div class="card-header collapsible-trigger" onclick="toggleKit('quickStart')">
            <span class="card-title has-avatar" style="gap: 12px;">
                <img src="arti.png" alt="Arti" style="width: 36px; height: 36px; border-radius: var(--radius);">
                Quick Start
            </span>
            <div style="display: flex; align-items: center; gap: 16px;">
                <div id="statsCompact" class="stats-compact">
                    <span><strong id="statJobsCompact">0</strong> analyzed</span>
                    <span><strong id="statAvgCompact">--</strong> avg</span>
                    <span><strong id="statTrackedCompact">0</strong> tracked</span>
                </div>
                <span id="quickStartToggle" class="mono" style="font-weight: 700; font-size: 20px;">-</span>
            </div>
        </div>
        <div id="quickStartContent" class="collapsible-content">
            <div class="card-body">
                <!-- Arti intro -->
                <div class="quick-intro">
                    <p><strong>Hey, I'm Arti.</strong> Think of me as your career coach for DIB jobs. I'll analyze your fit, prep you for interviews, and help you track applications.</p>
                </div>
                
                <!-- Stats row -->
                <div class="stats-row">
                    <div class="stat-box">
                        <span class="stat-value" id="statJobsAnalyzed">0</span>
                        <span class="stat-label">Jobs Analyzed</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value" id="statAvgScore">--</span>
                        <span class="stat-label">Avg Match</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value" id="statTracked">0</span>
                        <span class="stat-label">Tracked</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-value" id="statApplied">0</span>
                        <span class="stat-label">Applied</span>
                    </div>
                </div>
                
                <!-- Game plan steps -->
                <div class="game-plan">
                    <div class="plan-step">
                        <div class="step-num" id="step1Indicator">1</div>
                        <div class="step-info">
                            <strong>Load Your Resume</strong>
                            <span>Paste your resume text below. Stored locally in your browser only.</span>
                        </div>
                    </div>
                    <div class="plan-step">
                        <div class="step-num" id="step2Indicator">2</div>
                        <div class="step-info">
                            <strong>Target a Job</strong>
                            <span>Paste a job description. I'll analyze your fit and flag gaps.</span>
                        </div>
                    </div>
                    <div class="plan-step">
                        <div class="step-num" id="step3Indicator">3</div>
                        <div class="step-info">
                            <strong>Get Coached</strong>
                            <span>Review your score, prep for interviews, and ask me anything.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JOB BOARDS (Collapsible) -->
    <div class="card collapsible-card collapsed" id="jobSearchCard">
        <div class="card-header collapsible-trigger" onclick="toggleKit('jobSearch')">
            <span class="card-title">Browse DIB Job Boards</span>
            <span id="jobSearchToggle" class="mono" style="font-weight: 700; font-size: 20px;">+</span>
        </div>
        <div id="jobSearchContent" class="collapsible-content">
            <div class="card-body">
                <div style="margin-bottom: 20px;">
                    <div class="kit-section-title">Federal Primes</div>
                    <div class="job-search-grid">
                        <a href="https://www.linkedin.com/company/lockheed-martin/jobs/" target="_blank" class="job-search-link">Lockheed Martin</a>
                        <a href="https://www.linkedin.com/company/rtx/jobs/" target="_blank" class="job-search-link">RTX</a>
                        <a href="https://www.linkedin.com/company/northrop-grumman-corporation/jobs/" target="_blank" class="job-search-link">Northrop Grumman</a>
                        <a href="https://www.linkedin.com/company/boeing/jobs/" target="_blank" class="job-search-link">Boeing</a>
                        <a href="https://www.linkedin.com/company/leidos/jobs/" target="_blank" class="job-search-link">Leidos</a>
                        <a href="https://www.linkedin.com/company/booz-allen-hamilton/jobs/" target="_blank" class="job-search-link">Booz Allen</a>
                        <a href="https://www.linkedin.com/company/anduril/jobs/" target="_blank" class="job-search-link">Anduril</a>
                        <a href="https://www.linkedin.com/company/palantir-technologies/jobs/" target="_blank" class="job-search-link">Palantir</a>
                    </div>
                </div>
                <div>
                    <div class="kit-section-title">Cleared Job Boards</div>
                    <div class="job-search-grid">
                        <a href="https://www.clearancejobs.com/" target="_blank" class="job-search-link">ClearanceJobs</a>
                        <a href="https://www.linkedin.com/jobs/" target="_blank" class="job-search-link">LinkedIn</a>
                        <a href="https://www.indeed.com/jobs?q=federal" target="_blank" class="job-search-link">Indeed</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RESUME INPUT -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">Your Resume</span>
            <div class="resume-controls">
                <select id="resumeSelector" onchange="loadSavedResume()">
                    <option value="">-- Saved Resumes --</option>
                </select>
                <button class="btn btn-secondary" onclick="saveCurrentResume()" style="padding: 6px 12px; font-size: 11px;">Save</button>
                <button class="btn btn-secondary" onclick="clearResume()" style="padding: 6px 12px; font-size: 11px;">Clear</button>
            </div>
        </div>
        <div class="card-body">
            <textarea id="resumeText" placeholder="Paste your resume text here..."></textarea>
            <div style="margin-top: 12px; padding: 12px; background: rgba(0,0,0,0.03); border-radius: 6px; font-size: 12px;">
                <strong style="font-family: 'Space Mono', monospace; font-size: 10px; text-transform: uppercase;">Privacy:</strong>
                Your resume is not stored on our servers. Saved resumes are stored locally in your browser only.
            </div>
        </div>
    </div>

    <!-- JOB DESCRIPTION -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">Job Description</span>
        </div>
        <div class="card-body">
            <textarea id="jobDescription" placeholder="Paste job description text or a URL..."></textarea>
            <div class="action-bar">
                <button id="analyzeBtn" class="btn btn-primary" onclick="analyzeJob()">Analyze Match</button>
                <button class="btn btn-secondary" onclick="clearAll()">Reset</button>
                <button class="btn btn-secondary" onclick="loadSampleData()">Load Sample</button>
            </div>
            <div id="inlineError" class="inline-error"><span id="inlineErrorText"></span></div>
        </div>
    </div>

    <!-- LOADING -->
    <div id="loadingCard" class="card" style="display:none; text-align:center; padding: 48px 24px; background: var(--bg-cream); border: 2px dashed var(--ink-black);">
        <div style="display:inline-block; width: 40px; height: 40px; border: 4px solid var(--ink-black); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <h2 id="loadingStep" style="font-size: 18px; text-transform: uppercase; margin: 20px 0 16px;">Analyzing...</h2>
        <div style="max-width: 400px; margin: 0 auto; border: 2px solid var(--ink-black); height: 24px; border-radius: 12px; background: #fff; overflow: hidden;">
            <div id="loadingProgress" style="width: 5%; height: 100%; background: var(--accent-mint); border-right: 2px solid var(--ink-black); transition: width 0.3s;"></div>
        </div>
    </div>

    <!-- RESULTS -->
    <div id="analysisResults" style="display: none;">

        <!-- SCORE + INTEL COMBINED -->
        <div class="card" style="padding: 0;">
            <div id="matchScoreContainer" class="hero-grid"></div>
            <div id="coachCommentary" class="coach-commentary" style="display: none;">
                <img src="arti.png" alt="Arti">
                <p id="coachCommentaryText"></p>
            </div>
            <div class="card-body">
                <div class="intel-grid">
                    <div class="intel-panel">
                        <div class="intel-panel-header">
                            <div class="intel-panel-title">Salary Estimate</div>
                        </div>
                        <div id="salaryIntel">
                            <div class="intel-value" id="salaryRange">Loading...</div>
                            <div class="intel-label">Based on role level & market</div>
                            <div class="salary-range-bar">
                                <div class="salary-marker" id="salaryMarker" style="left: 50%;" data-label="Target"></div>
                            </div>
                            <div class="salary-labels">
                                <span id="salaryLow">$0K</span>
                                <span id="salaryHigh">$0K</span>
                            </div>
                        </div>
                    </div>
                    <div class="intel-panel">
                        <div class="intel-panel-header">
                            <div class="intel-panel-title">Hiring Timeline</div>
                        </div>
                        <div class="timeline-estimate">
                            <div class="timeline-step">
                                <div class="timeline-dot">1</div>
                                <div class="timeline-label">Apply</div>
                                <div class="timeline-days">Today</div>
                            </div>
                            <div class="timeline-step">
                                <div class="timeline-dot">2</div>
                                <div class="timeline-label">Screen</div>
                                <div class="timeline-days" id="screenDays">...</div>
                            </div>
                            <div class="timeline-step">
                                <div class="timeline-dot">3</div>
                                <div class="timeline-label">Interview</div>
                                <div class="timeline-days" id="interviewDays">...</div>
                            </div>
                            <div class="timeline-step">
                                <div class="timeline-dot">4</div>
                                <div class="timeline-label">Offer</div>
                                <div class="timeline-days" id="offerDays">...</div>
                            </div>
                        </div>
                    </div>
                    <div class="intel-panel">
                        <div class="intel-panel-header">
                            <div class="intel-panel-title">Competition Level</div>
                        </div>
                        <div class="intel-value" id="competitionLevel">Loading...</div>
                        <div class="intel-label" id="competitionDesc">Analyzing...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ASK ARTI -->
        <div class="chat-section">
            <div class="chat-header">
                <img src="arti.png" alt="Arti">
                <div class="chat-header-text">
                    <h3>Ask Arti</h3>
                    <p>Questions about salary, fit, gaps, or strategy</p>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message coach">
                    <div class="chat-message-avatar"><img src="arti.png" alt="" style="width:100%;height:100%;border-radius:var(--radius);"></div>
                    <div class="chat-message-bubble" id="initialChatMessage">I've analyzed this role. What would you like to know?</div>
                </div>
            </div>
            <div class="chat-suggestions" id="chatSuggestions">
                <button class="chat-suggestion" onclick="askSuggestion('What salary should I ask for?')">Salary advice</button>
                <button class="chat-suggestion" onclick="askSuggestion('How do I address my biggest gap?')">Address gaps</button>
                <button class="chat-suggestion" onclick="askSuggestion('Is this role worth pursuing?')">Worth pursuing?</button>
            </div>
            <div class="chat-input-area">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything..." onkeypress="if(event.key==='Enter')sendChatMessage()">
                <button class="btn btn-primary" onclick="sendChatMessage()" style="padding: 12px 20px;">Ask</button>
            </div>
        </div>

        <!-- GAP ANALYSIS -->
        <div class="card">
            <div class="card-header"><span class="card-title">Gap Analysis</span></div>
            <div class="card-body">
                <ul id="analysisList" class="analysis-list"></ul>
            </div>
        </div>

        <!-- APPLICATION KIT -->
        <div class="card collapsible-card collapsed" id="applicationKitCard">
            <div class="card-header collapsible-trigger" onclick="toggleKit('applicationKit')">
                <span class="card-title">Application Kit</span>
                <span id="applicationKitToggle" class="mono" style="font-weight: 700; font-size: 20px;">+</span>
            </div>
            <div id="applicationKitContent" class="collapsible-content">
                <div class="card-body" style="padding-top: 0;">
                    <div class="kit-section">
                        <h4 class="kit-section-title">Keywords to Add</h4>
                        <p style="margin-bottom: 12px; font-size: 13px; opacity: 0.7;"><span style="background: var(--accent-mint); padding: 2px 6px; border-radius: 3px;">Green</span> = in resume. <span style="background: rgba(209, 143, 122, 0.3); padding: 2px 6px; border-radius: 3px;">Orange</span> = missing.</p>
                        <div class="keyword-cloud" id="keywordCloud"></div>
                        <button class="btn btn-secondary" onclick="copyKeywords()" style="margin-top: 12px; padding: 6px 12px; font-size: 11px;">Copy Keywords</button>
                    </div>
                    <hr class="kit-divider">
                    <div class="kit-section">
                        <h4 class="kit-section-title">Tailored Executive Summary</h4>
                        <div id="resumeOutput" class="resume-paper compact"></div>
                        <button class="btn btn-secondary" onclick="copyResume()" style="margin-top: 12px; padding: 6px 12px; font-size: 11px;">Copy Summary</button>
                    </div>
                    <hr class="kit-divider">
                    <div class="kit-section">
                        <h4 class="kit-section-title">Intro Email</h4>
                        <div id="coverLetterPlaceholder">
                            <button class="btn btn-primary" onclick="generateCoverLetter()" id="generateCoverLetterBtn">Generate Intro Email</button>
                        </div>
                        <div id="coverLetterDisplay" style="display:none; white-space: pre-wrap; font-size: 14px; line-height: 1.6; background: #fff; padding: 16px; border: 1px solid #ddd; border-radius: var(--radius);"></div>
                        <button id="copyCLBtn" class="btn btn-secondary" onclick="copyCoverLetter()" style="display:none; margin-top: 12px; padding: 6px 12px; font-size: 11px;">Copy Email</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- INTERVIEW KIT -->
        <div class="card collapsible-card collapsed" id="interviewKitCard">
            <div class="card-header collapsible-trigger" onclick="toggleKit('interviewKit')">
                <span class="card-title">Interview Kit</span>
                <span id="interviewKitToggle" class="mono" style="font-weight: 700; font-size: 20px;">+</span>
            </div>
            <div id="interviewKitContent" class="collapsible-content">
                <div class="card-body" style="padding-top: 0;">
                    <div class="kit-section">
                        <h4 class="kit-section-title">Likely Interview Questions</h4>
                        <div id="interviewQuestionsList"></div>
                    </div>
                    <hr class="kit-divider">
                    <div class="kit-section">
                        <h4 class="kit-section-title">Gap Mitigation Strategies</h4>
                        <div id="gapStrategiesList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- OUTREACH KIT -->
        <div class="card collapsible-card collapsed" id="outreachKitCard">
            <div class="card-header collapsible-trigger" onclick="toggleKit('outreachKit')">
                <span class="card-title">Outreach Kit</span>
                <span id="outreachKitToggle" class="mono" style="font-weight: 700; font-size: 20px;">+</span>
            </div>
            <div id="outreachKitContent" class="collapsible-content">
                <div class="card-body" style="padding-top: 0;">
                    <div class="kit-section">
                        <h4 class="kit-section-title">Find Connections at <span id="networkCompany">This Company</span></h4>
                        <div class="network-links" id="networkLinks"></div>
                    </div>
                    <hr class="kit-divider">
                    <div class="kit-section">
                        <h4 class="kit-section-title">Follow-Up Templates</h4>
                        <div class="template-tabs">
                            <button class="template-tab active" onclick="showTemplate('applied')">After Applying</button>
                            <button class="template-tab" onclick="showTemplate('interview')">Post-Interview</button>
                            <button class="template-tab" onclick="showTemplate('followup')">Check-In</button>
                            <button class="template-tab" onclick="showTemplate('negotiate')">Negotiation</button>
                        </div>
                        <div class="template-content">
                            <div id="templateApplied" class="template-text"></div>
                            <div id="templateInterview" class="template-text" style="display:none;"></div>
                            <div id="templateFollowup" class="template-text" style="display:none;"></div>
                            <div id="templateNegotiate" class="template-text" style="display:none;"></div>
                            <button class="btn btn-secondary" onclick="copyCurrentTemplate()" style="margin-top: 12px; padding: 6px 12px; font-size: 11px;">Copy Template</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SAVE TO TRACKER -->
        <div class="card" style="background: var(--accent-mint);">
            <div class="card-body" style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
                <div>
                    <strong style="font-family: 'Space Mono', monospace; text-transform: uppercase;">Save This Analysis</strong>
                    <p style="font-size: 13px; opacity: 0.8; margin-top: 4px;">Track your application status over time.</p>
                </div>
                <button class="btn btn-primary" onclick="saveToTracker()" id="saveToTrackerBtn">Save to Tracker</button>
            </div>
        </div>
    </div>

    <!-- TRACKER -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">Application Tracker</span>
            <span id="trackerCount" style="font-family: 'Space Mono', monospace; font-size: 12px; opacity: 0.7;">0 jobs tracked</span>
        </div>
        <div class="card-body">
            <div id="trackerEmpty" class="empty-tracker">
                <p>No applications tracked yet. Analyze a job and click "Save to Tracker" to start.</p>
            </div>
            <div id="trackerTableContainer" style="display: none; overflow-x: auto;">
                <table class="tracker-table">
                    <thead>
                        <tr><th>Company</th><th>Role</th><th>Score</th><th>Status</th><th>Date</th><th>Actions</th></tr>
                    </thead>
                    <tbody id="trackerBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<div id="errorToast" class="error-toast">
    <span id="errorToastText"></span>
    <button class="error-toast-close" onclick="hideErrorToast()">x</button>
</div>

<script>
// ==========================================================================
// DIB JOBS - APP.JS
// ==========================================================================

const API_ENDPOINT = 'https://urchin-app-yijtz.ondigitalocean.app/analyze';
const MAX_RETRIES = 3;
const RETRY_DELAY_MS = 2000;
const RESUME_STORAGE_KEY = 'dib_jobs_resumes';
const TRACKER_STORAGE_KEY = 'dibJobsTracker';
const STATS_STORAGE_KEY = 'dibJobsStats';
const LAST_RESUME_KEY = 'dibJobsLastResume';

let analysisData = null;
let chatHistory = [];
let currentTemplate = 'applied';
let trackedJobs = [];
let careerStats = { jobsAnalyzed: 0, scores: [] };

// ==========================================================================
// INIT
// ==========================================================================
document.addEventListener('DOMContentLoaded', () => {
    initTracker();
    initStats();
    updateResumeSelector();
    loadLastUsedResume();
    updateStatsDisplay();
    checkWorkflowProgress();
    document.getElementById('resumeText').addEventListener('input', debounce(checkWorkflowProgress, 500));
});

function debounce(fn, wait) {
    let t;
    return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), wait); };
}

// ==========================================================================
// API HELPER WITH RETRY
// ==========================================================================
async function fetchWithRetry(url, options, retries = MAX_RETRIES) {
    for (let attempt = 1; attempt <= retries; attempt++) {
        try {
            const response = await fetch(url, options);
            if (response.ok) return response;
            
            // Don't retry on client errors (4xx)
            if (response.status >= 400 && response.status < 500) {
                return response;
            }
            
            // Server error - retry
            if (attempt < retries) {
                console.log(`Attempt ${attempt} failed, retrying in ${RETRY_DELAY_MS}ms...`);
                await new Promise(r => setTimeout(r, RETRY_DELAY_MS));
            } else {
                return response;
            }
        } catch (error) {
            if (attempt < retries) {
                console.log(`Attempt ${attempt} failed with error, retrying in ${RETRY_DELAY_MS}ms...`);
                await new Promise(r => setTimeout(r, RETRY_DELAY_MS));
            } else {
                throw error;
            }
        }
    }
}

// ==========================================================================
// STATS
// ==========================================================================
function initStats() {
    const s = localStorage.getItem(STATS_STORAGE_KEY);
    if (s) try { careerStats = JSON.parse(s); } catch(e) {}
}

function saveStats() {
    localStorage.setItem(STATS_STORAGE_KEY, JSON.stringify(careerStats));
}

function updateStatsDisplay() {
    const jobs = careerStats.jobsAnalyzed;
    const avg = careerStats.scores.length 
        ? Math.round(careerStats.scores.reduce((a,b)=>a+b,0)/careerStats.scores.length) + '%' 
        : '--';
    const tracked = trackedJobs.length;
    const applied = trackedJobs.filter(j => j.status !== 'saved').length;
    
    // Full stats
    document.getElementById('statJobsAnalyzed').textContent = jobs;
    document.getElementById('statAvgScore').textContent = avg;
    document.getElementById('statTracked').textContent = tracked;
    document.getElementById('statApplied').textContent = applied;
    
    // Compact stats in header
    const jobsCompact = document.getElementById('statJobsCompact');
    const avgCompact = document.getElementById('statAvgCompact');
    const trackedCompact = document.getElementById('statTrackedCompact');
    if (jobsCompact) jobsCompact.textContent = jobs;
    if (avgCompact) avgCompact.textContent = avg;
    if (trackedCompact) trackedCompact.textContent = tracked;
}

// ==========================================================================
// WORKFLOW
// ==========================================================================
function checkWorkflowProgress() {
    const resume = document.getElementById('resumeText').value;
    const s1 = document.getElementById('step1Indicator');
    if (resume && resume.length > 100) {
        s1.classList.add('completed');
        s1.textContent = 'OK';
    } else {
        s1.classList.remove('completed');
        s1.textContent = '1';
    }
}

// ==========================================================================
// COLLAPSIBLE
// ==========================================================================
function toggleKit(id) {
    const card = document.getElementById(id + 'Card') || document.getElementById(id);
    const toggle = document.getElementById(id + 'Toggle');
    if (card.classList.contains('collapsed')) {
        card.classList.remove('collapsed');
        if (toggle) toggle.textContent = '-';
    } else {
        card.classList.add('collapsed');
        if (toggle) toggle.textContent = '+';
    }
}

// ==========================================================================
// RESUME
// ==========================================================================
function updateResumeSelector() {
    const sel = document.getElementById('resumeSelector');
    const resumes = JSON.parse(localStorage.getItem(RESUME_STORAGE_KEY) || '[]');
    sel.innerHTML = '<option value="">-- Saved Resumes --</option>';
    resumes.forEach((r, i) => {
        sel.innerHTML += `<option value="${i}">${r.name || 'Resume '+(i+1)}</option>`;
    });
}

function loadSavedResume() {
    const i = document.getElementById('resumeSelector').value;
    if (i === '') return;
    const resumes = JSON.parse(localStorage.getItem(RESUME_STORAGE_KEY) || '[]');
    if (resumes[i]) {
        document.getElementById('resumeText').value = resumes[i].text;
        localStorage.setItem(LAST_RESUME_KEY, i);
        checkWorkflowProgress();
    }
}

function loadLastUsedResume() {
    const i = localStorage.getItem(LAST_RESUME_KEY);
    if (i !== null) {
        const resumes = JSON.parse(localStorage.getItem(RESUME_STORAGE_KEY) || '[]');
        if (resumes[i]) {
            document.getElementById('resumeText').value = resumes[i].text;
            document.getElementById('resumeSelector').value = i;
            checkWorkflowProgress();
        }
    }
}

function saveCurrentResume() {
    const text = document.getElementById('resumeText').value.trim();
    if (!text) { showToast('Enter your resume first'); return; }
    const name = prompt('Name this resume:');
    if (!name) return;
    const resumes = JSON.parse(localStorage.getItem(RESUME_STORAGE_KEY) || '[]');
    resumes.push({ name, text, date: new Date().toISOString() });
    localStorage.setItem(RESUME_STORAGE_KEY, JSON.stringify(resumes));
    localStorage.setItem(LAST_RESUME_KEY, resumes.length - 1);
    updateResumeSelector();
    document.getElementById('resumeSelector').value = resumes.length - 1;
    showToast('Resume saved!');
}

function clearResume() {
    document.getElementById('resumeText').value = '';
    document.getElementById('resumeSelector').value = '';
    checkWorkflowProgress();
}

// ==========================================================================
// MAIN ANALYSIS
// ==========================================================================
async function analyzeJob() {
    const resumeText = document.getElementById('resumeText').value.trim();
    const jobDescription = document.getElementById('jobDescription').value.trim();
    
    if (!resumeText || resumeText.length < 100) {
        showInlineError('Please paste your resume first.');
        return;
    }
    if (!jobDescription || jobDescription.length < 50) {
        showInlineError('Please paste a job description.');
        return;
    }
    
    hideInlineError();
    document.getElementById('loadingCard').style.display = 'block';
    document.getElementById('analysisResults').style.display = 'none';
    document.getElementById('analyzeBtn').disabled = true;
    
    const steps = [
        { text: 'Reading job requirements...', progress: 15 },
        { text: 'Analyzing your experience...', progress: 35 },
        { text: 'Identifying matches and gaps...', progress: 55 },
        { text: 'Preparing coaching...', progress: 75 },
        { text: 'Almost there...', progress: 90 }
    ];
    
    let stepIndex = 0;
    const loadingInterval = setInterval(() => {
        if (stepIndex < steps.length) {
            document.getElementById('loadingStep').textContent = steps[stepIndex].text;
            document.getElementById('loadingProgress').style.width = steps[stepIndex].progress + '%';
            stepIndex++;
        }
    }, 1500);
    
    try {
        const response = await fetchWithRetry(API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ request_type: 'resume_match', job_description: jobDescription, resume_text: resumeText })
        });
        
        clearInterval(loadingInterval);
        
        if (!response.ok) {
            const err = await response.json();
            throw new Error(err.error || 'Analysis failed');
        }
        
        analysisData = await response.json();
        
        careerStats.jobsAnalyzed++;
        careerStats.scores.push(analysisData.score || 0);
        saveStats();
        updateStatsDisplay();
        
        document.getElementById('step2Indicator').classList.add('completed');
        document.getElementById('step2Indicator').textContent = 'OK';
        
        renderResults(analysisData);
        fetchMarketIntel(jobDescription, analysisData.job_title, analysisData.company);
        
        document.getElementById('loadingCard').style.display = 'none';
        document.getElementById('analysisResults').style.display = 'block';
        
        chatHistory = [];
        document.getElementById('chatMessages').innerHTML = `
            <div class="chat-message coach">
                <div class="chat-message-avatar"><img src="arti.png" alt="" style="width:100%;height:100%;border-radius:var(--radius);"></div>
                <div class="chat-message-bubble">${getInitialChatMessage(analysisData.score)}</div>
            </div>`;
        document.getElementById('chatSuggestions').style.display = 'flex';
        
        document.getElementById('matchScoreContainer').scrollIntoView({ behavior: 'smooth' });
        
    } catch (error) {
        clearInterval(loadingInterval);
        document.getElementById('loadingCard').style.display = 'none';
        showToast(error.message || 'Something went wrong.');
    } finally {
        document.getElementById('analyzeBtn').disabled = false;
    }
}

function getInitialChatMessage(score) {
    if (score >= 80) return "Strong match. You're well positioned for this role. What would you like to know?";
    if (score >= 65) return "Solid opportunity. You meet most requirements with a few gaps to address. How can I help?";
    if (score >= 50) return "This is a stretch, but achievable. Want to discuss strategy?";
    return "Tough fit based on your resume. Want to talk through whether it's worth pursuing?";
}

// ==========================================================================
// RENDER RESULTS
// ==========================================================================
function renderResults(data) {
    const score = data.score || 0;
    
    // Score card
    let scoreClass = score >= 75 ? 'score-high' : score >= 50 ? 'score-mid' : 'score-low';
    document.getElementById('matchScoreContainer').className = 'hero-grid ' + scoreClass;
    document.getElementById('matchScoreContainer').innerHTML = `
        <div class="score-box">
            <div class="score-val">${score}</div>
            <div class="score-label">Match Score</div>
        </div>
        <div class="verdict-box">
            <h2 style="font-size: 20px; margin-bottom: 8px;">${esc(data.job_title || 'Role')} at ${esc(data.company || 'Company')}</h2>
            <p style="font-size: 14px; opacity: 0.85;">${esc(data.one_liner || '')}</p>
        </div>
    `;
    
    // Coach commentary
    const commentary = document.getElementById('coachCommentary');
    const commentaryText = document.getElementById('coachCommentaryText');
    if (score >= 80) {
        commentaryText.textContent = "This is a great fit. You have the experience they're looking for. I'd prioritize this application.";
    } else if (score >= 65) {
        commentaryText.textContent = "Solid match. The gaps aren't deal-breakers. Check the Interview Kit for strategies to address them.";
    } else if (score >= 50) {
        commentaryText.textContent = "This is a reach, but not impossible. You'll need to work harder to stand out. Consider networking.";
    } else {
        commentaryText.textContent = "Significant gaps here. Consider using this as a target to work toward, or focus on transferable skills.";
    }
    commentary.style.display = 'flex';
    
    // Analysis list
    const list = document.getElementById('analysisList');
    list.innerHTML = '';
    (data.analysis || []).forEach(item => {
        if (item.startsWith('Match:')) {
            const parts = item.replace('Match:', '').trim().split(' - ');
            list.innerHTML += `<li class="analysis-item item-match"><strong>${esc(parts[0])}</strong>${parts[1] ? esc(parts[1]) : ''}</li>`;
        } else if (item.startsWith('Gap:')) {
            const parts = item.replace('Gap:', '').trim().split(' - ');
            list.innerHTML += `<li class="analysis-item item-gap"><strong>${esc(parts[0])}</strong>${parts[1] ? esc(parts[1]) : ''}</li>`;
        }
    });
    
    // Keywords
    const cloud = document.getElementById('keywordCloud');
    cloud.innerHTML = (data.keywords || []).map(kw => {
        // Handle both object format {term, in_resume} and string format
        const term = typeof kw === 'string' ? kw : (kw.term || kw.keyword || '');
        const inResume = typeof kw === 'object' ? (kw.in_resume || kw.matched) : false;
        return `<span class="keyword-tag ${inResume ? 'in-resume' : 'missing'}">${esc(term)}</span>`;
    }).join('');
    
    // Resume output
    document.getElementById('resumeOutput').innerHTML = esc(data.tailored_summary || '').replace(/\n/g, '<br>');
    
    // Interview questions
    document.getElementById('interviewQuestionsList').innerHTML = (data.interview_questions || []).map(q => `
        <div class="qa-card">
            <div class="qa-q">${esc(q.question)}</div>
            <div class="qa-a">${esc(q.suggested_answer || q.answer || '')}</div>
        </div>
    `).join('');
    
    // Gap strategies
    document.getElementById('gapStrategiesList').innerHTML = (data.gap_strategies || []).map(s => `
        <div class="qa-card">
            <div class="qa-q">${esc(s.gap)}</div>
            <div class="qa-a">${esc(s.strategy)}</div>
        </div>
    `).join('');
    
    // Network links
    document.getElementById('networkCompany').textContent = data.company || 'This Company';
    const enc = encodeURIComponent(data.company || '');
    document.getElementById('networkLinks').innerHTML = `
        <a href="https://www.linkedin.com/search/results/people/?keywords=${enc}" target="_blank" class="network-link">LinkedIn People</a>
        <a href="https://www.linkedin.com/search/results/people/?keywords=${enc}%20recruiter" target="_blank" class="network-link">Recruiters</a>
        <a href="https://www.linkedin.com/search/results/people/?keywords=${enc}%20hiring%20manager" target="_blank" class="network-link">Hiring Managers</a>
    `;
    
    // Templates
    generateTemplates(data);
}

function generateTemplates(data) {
    const role = data.job_title || 'the position';
    const company = data.company || 'your company';
    const highlights = (data.analysis || []).filter(a => a.startsWith('Match:')).slice(0, 2).map(a => a.replace('Match:', '').split(' - ')[0].trim()).join(' and ') || 'relevant experience';
    const salary = data.salary_intel ? '$' + data.salary_intel.mid + 'K' : 'competitive market rate';
    
    document.getElementById('templateApplied').textContent = `Subject: Following Up - ${role} Application

Hi [Recruiter Name],

I recently submitted my application for the ${role} position at ${company} and wanted to follow up.

My background in ${highlights} aligns well with what you're looking for.

Would you have 15-20 minutes for a brief call this week?

Best regards,
[Your Name]
[Your Phone]`;

    document.getElementById('templateInterview').textContent = `Subject: Thank You - ${role} Interview

Hi [Interviewer Name],

Thank you for meeting with me today. Our conversation reinforced my enthusiasm for this opportunity.

I'm confident my experience with ${highlights} would allow me to contribute immediately.

Best regards,
[Your Name]`;

    document.getElementById('templateFollowup').textContent = `Subject: Checking In - ${role} Position

Hi [Recruiter Name],

I wanted to check in on the status of the ${role} position at ${company}.

Is there an updated timeline for next steps?

Best regards,
[Your Name]`;

    document.getElementById('templateNegotiate').textContent = `Subject: RE: ${role} Offer Discussion

Hi [Hiring Manager],

Thank you for the offer. I'm excited about joining ${company}.

Based on my background, I believe a base salary around ${salary} would be appropriate.

I'm committed to making this work.

Best regards,
[Your Name]`;

    showTemplate('applied');
}

function showTemplate(type) {
    currentTemplate = type;
    ['applied', 'interview', 'followup', 'negotiate'].forEach((t, i) => {
        const el = document.getElementById('template' + t.charAt(0).toUpperCase() + t.slice(1));
        if (el) el.style.display = t === type ? 'block' : 'none';
        document.querySelectorAll('.template-tab')[i]?.classList.toggle('active', t === type);
    });
}

// ==========================================================================
// MARKET INTEL
// ==========================================================================
async function fetchMarketIntel(jobDescription, jobTitle, company) {
    try {
        const response = await fetchWithRetry(API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ request_type: 'market_intel', job_description: jobDescription, job_title: jobTitle, company })
        });
        if (!response.ok) return;
        const intel = await response.json();
        
        if (intel.salary_intel) {
            const s = intel.salary_intel;
            document.getElementById('salaryRange').textContent = '$' + s.low + 'K - $' + s.high + 'K';
            document.getElementById('salaryLow').textContent = '$' + s.low + 'K';
            document.getElementById('salaryHigh').textContent = '$' + s.high + 'K';
            document.getElementById('salaryMarker').style.left = ((s.mid - s.low) / (s.high - s.low) * 100) + '%';
            document.getElementById('salaryMarker').setAttribute('data-label', '$' + s.mid + 'K Target');
            if (analysisData) analysisData.salary_intel = s;
        }
        
        if (intel.timeline) {
            document.getElementById('screenDays').textContent = intel.timeline.screen || '1-2 wks';
            document.getElementById('interviewDays').textContent = intel.timeline.interview || '2-4 wks';
            document.getElementById('offerDays').textContent = intel.timeline.offer || '4-8 wks';
        }
        
        if (intel.competition) {
            document.getElementById('competitionLevel').textContent = intel.competition.level || 'Medium';
            document.getElementById('competitionDesc').textContent = intel.competition.reasoning || '';
        }
    } catch (e) {
        console.error('Market intel error:', e);
    }
}

// ==========================================================================
// CHAT
// ==========================================================================
function askSuggestion(q) {
    document.getElementById('chatInput').value = q;
    sendChatMessage();
}

async function sendChatMessage() {
    const input = document.getElementById('chatInput');
    const msg = input.value.trim();
    if (!msg) return;
    if (!analysisData) { showToast('Analyze a job first'); return; }
    
    const container = document.getElementById('chatMessages');
    container.innerHTML += `<div class="chat-message user"><div class="chat-message-avatar">You</div><div class="chat-message-bubble">${esc(msg)}</div></div>`;
    
    const loadingId = 'load-' + Date.now();
    container.innerHTML += `<div class="chat-message coach" id="${loadingId}"><div class="chat-message-avatar"><img src="arti.png" alt="" style="width:100%;height:100%;border-radius:var(--radius);"></div><div class="chat-message-bubble">Thinking...</div></div>`;
    container.scrollTop = container.scrollHeight;
    input.value = '';
    document.getElementById('chatSuggestions').style.display = 'none';
    
    try {
        const response = await fetchWithRetry(API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                request_type: 'ask_expert',
                question: msg,
                job_description: document.getElementById('jobDescription').value,
                resume_text: document.getElementById('resumeText').value,
                analysis_data: analysisData,
                chat_history: chatHistory
            })
        });
        if (!response.ok) throw new Error('Failed');
        const data = await response.json();
        chatHistory.push({ role: 'user', content: msg }, { role: 'assistant', content: data.response });
        document.getElementById(loadingId).querySelector('.chat-message-bubble').innerHTML = esc(data.response).replace(/\n/g, '<br>');
        container.scrollTop = container.scrollHeight;
    } catch (e) {
        document.getElementById(loadingId).querySelector('.chat-message-bubble').textContent = 'Sorry, please try again.';
    }
}

// ==========================================================================
// COVER LETTER
// ==========================================================================
async function generateCoverLetter() {
    if (!analysisData) return;
    const btn = document.getElementById('generateCoverLetterBtn');
    btn.disabled = true;
    btn.textContent = 'Generating...';
    try {
        const response = await fetchWithRetry(API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                request_type: 'generate_intro_email',
                job_description: document.getElementById('jobDescription').value,
                resume_text: document.getElementById('resumeText').value,
                analysis_data: analysisData
            })
        });
        if (!response.ok) throw new Error('Failed');
        const data = await response.json();
        document.getElementById('coverLetterPlaceholder').style.display = 'none';
        document.getElementById('coverLetterDisplay').style.display = 'block';
        document.getElementById('coverLetterDisplay').textContent = data.intro_email;
        document.getElementById('copyCLBtn').style.display = 'inline-flex';
    } catch (e) {
        showToast('Failed to generate email.');
        btn.disabled = false;
        btn.textContent = 'Generate Intro Email';
    }
}

// ==========================================================================
// COPY
// ==========================================================================
function copyKeywords() {
    const missing = Array.from(document.querySelectorAll('.keyword-tag.missing')).map(el => el.textContent).join(', ');
    if (missing) {
        navigator.clipboard.writeText(missing).then(() => showToast('Copied!'));
    } else {
        showToast('No missing keywords to copy');
    }
}

function copyResume() {
    navigator.clipboard.writeText(document.getElementById('resumeOutput').textContent).then(() => showToast('Copied!'));
}

function copyCoverLetter() {
    navigator.clipboard.writeText(document.getElementById('coverLetterDisplay').textContent).then(() => showToast('Copied!'));
}

function copyCurrentTemplate() {
    const el = document.getElementById('template' + currentTemplate.charAt(0).toUpperCase() + currentTemplate.slice(1));
    if (el) navigator.clipboard.writeText(el.textContent).then(() => showToast('Copied!'));
}

// ==========================================================================
// TRACKER
// ==========================================================================
function initTracker() {
    const s = localStorage.getItem(TRACKER_STORAGE_KEY);
    if (s) try { trackedJobs = JSON.parse(s); renderTracker(); } catch(e) {}
}

function saveToTracker() {
    if (!analysisData) return;
    const job = {
        id: Date.now(),
        company: analysisData.company || 'Unknown',
        role: analysisData.job_title || 'Unknown Role',
        score: analysisData.score || 0,
        status: 'saved',
        date: new Date().toLocaleDateString(),
        jd: document.getElementById('jobDescription').value.substring(0, 500),
        analysis: analysisData
    };
    if (trackedJobs.some(j => j.company === job.company && j.role === job.role)) {
        showToast('Already tracked!');
        return;
    }
    trackedJobs.unshift(job);
    localStorage.setItem(TRACKER_STORAGE_KEY, JSON.stringify(trackedJobs));
    renderTracker();
    updateStatsDisplay();
    const btn = document.getElementById('saveToTrackerBtn');
    btn.textContent = 'Saved!';
    btn.disabled = true;
    setTimeout(() => { btn.textContent = 'Save to Tracker'; btn.disabled = false; }, 2000);
}

function renderTracker() {
    document.getElementById('trackerCount').textContent = trackedJobs.length + ' job' + (trackedJobs.length !== 1 ? 's' : '') + ' tracked';
    if (trackedJobs.length === 0) {
        document.getElementById('trackerEmpty').style.display = 'block';
        document.getElementById('trackerTableContainer').style.display = 'none';
        return;
    }
    document.getElementById('trackerEmpty').style.display = 'none';
    document.getElementById('trackerTableContainer').style.display = 'block';
    document.getElementById('trackerBody').innerHTML = trackedJobs.map(job => `
        <tr>
            <td><strong>${esc(job.company)}</strong></td>
            <td>${esc(job.role)}</td>
            <td><span class="intel-badge ${job.score >= 75 ? 'green' : job.score >= 50 ? 'gold' : 'clay'}">${job.score}%</span></td>
            <td><select onchange="updateJobStatus(${job.id}, this.value)" style="padding:4px;font-size:11px;border:1px solid var(--ink-black);border-radius:3px;">
                <option value="saved" ${job.status==='saved'?'selected':''}>Saved</option>
                <option value="applied" ${job.status==='applied'?'selected':''}>Applied</option>
                <option value="interviewing" ${job.status==='interviewing'?'selected':''}>Interviewing</option>
                <option value="offered" ${job.status==='offered'?'selected':''}>Offered</option>
                <option value="rejected" ${job.status==='rejected'?'selected':''}>Rejected</option>
            </select></td>
            <td>${job.date}</td>
            <td><div class="tracker-actions"><button class="tracker-btn" onclick="loadTrackedJob(${job.id})">Load</button><button class="tracker-btn" onclick="deleteTrackedJob(${job.id})">X</button></div></td>
        </tr>
    `).join('');
}

function updateJobStatus(id, status) {
    const job = trackedJobs.find(j => j.id === id);
    if (job) { job.status = status; localStorage.setItem(TRACKER_STORAGE_KEY, JSON.stringify(trackedJobs)); updateStatsDisplay(); }
}

function loadTrackedJob(id) {
    const job = trackedJobs.find(j => j.id === id);
    if (job && job.analysis) {
        document.getElementById('jobDescription').value = job.jd || '';
        analysisData = job.analysis;
        renderResults(job.analysis);
        document.getElementById('analysisResults').style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function deleteTrackedJob(id) {
    if (confirm('Remove this job?')) {
        trackedJobs = trackedJobs.filter(j => j.id !== id);
        localStorage.setItem(TRACKER_STORAGE_KEY, JSON.stringify(trackedJobs));
        renderTracker();
        updateStatsDisplay();
    }
}

// ==========================================================================
// UTILITIES
// ==========================================================================
function esc(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function showInlineError(msg) {
    document.getElementById('inlineErrorText').textContent = msg;
    document.getElementById('inlineError').classList.add('show');
}

function hideInlineError() {
    document.getElementById('inlineError').classList.remove('show');
}

function showToast(msg) {
    document.getElementById('errorToastText').textContent = msg;
    document.getElementById('errorToast').classList.add('show');
    setTimeout(() => document.getElementById('errorToast').classList.remove('show'), 3000);
}

function hideErrorToast() {
    document.getElementById('errorToast').classList.remove('show');
}

function clearAll() {
    document.getElementById('jobDescription').value = '';
    document.getElementById('analysisResults').style.display = 'none';
    analysisData = null;
    chatHistory = [];
    hideInlineError();
}

function loadSampleData() {
    document.getElementById('resumeText').value = `SARAH JOHNSON
Director of Federal Sales | TS/SCI Cleared | 15+ Years in Defense

EXECUTIVE SUMMARY
Results-driven federal sales leader with 15+ years driving revenue growth across the Intelligence Community and Department of Defense. Proven track record of winning $500M+ in contract awards through strategic capture leadership.

EXPERIENCE

Director of Federal Sales | ACME Defense Technologies | 2019-Present
- Lead $150M annual quota team selling cloud and cybersecurity solutions to IC and DoD
- Won $200M IDIQ contract with NGA through strategic capture
- Built executive relationships with CIOs across 12 agencies

Senior Account Executive | CloudTech Federal | 2014-2019
- Exceeded quota 5 consecutive years selling AWS GovCloud solutions
- Closed $75M in new business across DIA, NSA, and CIA accounts

CLEARANCE: TS/SCI with Full Scope Polygraph
EDUCATION: MBA, Georgetown University | BS Computer Science, Virginia Tech`;

    document.getElementById('jobDescription').value = `Director of Federal Sales - Intelligence Community

Location: Reston, VA (Hybrid)
Clearance: TS/SCI with Polygraph Required

We're seeking a Director of Federal Sales to lead our IC business unit with a $100M+ quota.

Requirements:
- 10+ years federal sales, 5+ in IC
- Track record exceeding $75M+ quotas
- Cloud, cybersecurity, or AI/ML experience
- Active TS/SCI with polygraph
- MBA preferred

Compensation: $200-250K base + commission`;

    checkWorkflowProgress();
}
</script>
</body>
</html>