<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arti // DIB Career Coach</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ==========================================================================
   NEO-BRUTALIST TOKENS
   ========================================================================== */
:root {
    --ink: #1a1a2e;
    --paper: #ffffff;
    --cream: #f8f6f1;
    --pale-blue: #c8dae8;
    --soft-blue: #93b5d9;
    --mint: #d4e8dc;
    --clay: #e07a5f;
    --gold: #f2cc8f;
    
    --border: 3px solid var(--ink);
    --shadow: 4px 4px 0 var(--ink);
    --radius: 12px;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; padding: 0; font-family: 'DM Sans', sans-serif; background: var(--pale-blue); color: var(--ink); height: 100vh; overflow: hidden; }
h1, h2, h3, .mono { font-family: 'Space Mono', monospace; }

/* APP FRAME */
.app-frame {
    max-width: 600px; margin: 0 auto; height: 100vh;
    background: var(--cream); border-left: var(--border); border-right: var(--border);
    display: flex; flex-direction: column; position: relative;
    box-shadow: 0 0 60px rgba(0,0,0,0.1);
}
@media(max-width: 650px) { .app-frame { border: none; width: 100%; } }

/* HEADER */
.app-header {
    padding: 16px 20px; border-bottom: var(--border); background: var(--paper);
    display: flex; justify-content: space-between; align-items: center; z-index: 10;
}
.brand { font-family: 'Space Mono'; font-weight: 700; font-size: 15px; display: flex; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: -0.5px; }
.brand-avatar { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; }
.brand-avatar img { width: 100%; height: 100%; object-fit: contain; }

/* ==========================================================================
   CHAT STREAM (The Core UI)
   ========================================================================== */
.chat-container {
    flex: 1; overflow-y: auto; padding: 20px;
    display: flex; flex-direction: column; gap: 16px;
    scroll-behavior: smooth;
    padding-bottom: 40px;
}

/* Messages */
.msg-row { display: flex; gap: 12px; align-items: flex-start; opacity: 0; animation: slideUp 0.3s forwards; }
.msg-row.user { flex-direction: row-reverse; }

.avatar { width: 32px; height: 32px; flex-shrink: 0; }
.avatar img { width: 100%; height: 100%; object-fit: contain; }

.bubble {
    max-width: 85%; padding: 14px 18px; border-radius: 12px;
    font-size: 14px; line-height: 1.5; border: 2px solid var(--ink);
    position: relative; box-shadow: 3px 3px 0 rgba(0,0,0,0.05);
}
.msg-row.arti .bubble { background: var(--paper); border-top-left-radius: 2px; }
.msg-row.user .bubble { background: var(--ink); color: white; border-top-right-radius: 2px; box-shadow: 3px 3px 0 rgba(0,0,0,0.2); }

/* Option Buttons (Chat Choices) */
.chat-options {
    display: flex; flex-wrap: wrap; gap: 8px; margin-left: 44px; /* Align with text */
    animation: fadeIn 0.5s forwards;
}
.chat-btn {
    padding: 10px 16px; background: var(--paper); border: 2px solid var(--ink);
    border-radius: 20px; font-family: 'Space Mono'; font-weight: 700; font-size: 12px;
    cursor: pointer; transition: all 0.1s; box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
}
.chat-btn:hover { transform: translate(-2px, -2px); box-shadow: 5px 5px 0 var(--ink); background: var(--mint); }
.chat-btn:active { transform: translate(1px, 1px); box-shadow: 2px 2px 0 var(--ink); }

/* Rich Widgets (Archetype Card inside Chat) */
.chat-widget {
    width: 100%; max-width: 320px; margin-left: 44px;
    background: var(--paper); border: 2px solid var(--ink); border-radius: 12px;
    overflow: hidden; box-shadow: 4px 4px 0 var(--ink); margin-bottom: 8px;
}
.widget-header { background: var(--pale-blue); padding: 20px; text-align: center; border-bottom: 2px solid var(--ink); }
.widget-icon { font-size: 40px; display: block; margin-bottom: 8px; }
.widget-title { font-family: 'Space Mono'; font-weight: 700; font-size: 18px; text-transform: uppercase; }
.widget-body { padding: 16px; font-size: 13px; line-height: 1.5; }
.widget-link {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px; margin-top: 8px; background: var(--cream);
    border: 2px solid var(--ink); border-radius: 8px; text-decoration: none;
    color: var(--ink); font-weight: 700; font-size: 11px; font-family: 'Space Mono';
    transition: all 0.1s;
}
.widget-link:hover { background: var(--mint); transform: translate(-1px,-1px); box-shadow: 2px 2px 0 var(--ink); }

/* INPUT AREA (Sticky Footer) */
.input-area {
    padding: 16px; background: var(--paper); border-top: var(--border);
    display: flex; gap: 10px; align-items: flex-end;
}
.chat-input {
    flex: 1; padding: 14px; border: 2px solid var(--ink); border-radius: 8px;
    font-family: 'DM Sans'; font-size: 14px; resize: none; height: 52px; max-height: 120px;
    transition: box-shadow 0.2s;
}
.chat-input:focus { outline: none; box-shadow: 4px 4px 0 var(--pale-blue); }
.send-btn {
    width: 52px; height: 52px; background: var(--ink); color: white;
    border: none; border-radius: 8px; cursor: pointer; font-weight: 700;
    display: grid; place-items: center; box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
}
.send-btn:active { transform: scale(0.95); box-shadow: none; }

/* Animations */
@keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* Typing Dot */
.typing { display: flex; gap: 4px; padding: 4px 0; }
.dot { width: 6px; height: 6px; background: var(--ink); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out; }
.dot:nth-child(1) { animation-delay: -0.32s; }
.dot:nth-child(2) { animation-delay: -0.16s; }
@keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

</style>
</head>
<body>

<div class="app-frame">
    <header class="app-header">
        <div class="brand">
            <div class="brand-avatar"><img src="arti.png" alt="Arti"></div>
            <div>Arti // Career Bot</div>
        </div>
        <button class="mono" onclick="resetChat()" style="background:none; border:none; text-decoration:underline; font-size:11px; cursor:pointer;">Restart</button>
    </header>

    <div id="chatContainer" class="chat-container">
        </div>

    <div class="input-area">
        <textarea id="userInput" class="chat-input" placeholder="Type a message..." onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault(); handleSend();}"></textarea>
        <button class="send-btn" onclick="handleSend()">‚Üí</button>
    </div>
</div>

<script>
// ==========================================================================
// CLIENT LOGIC
// ==========================================================================
const API_ENDPOINT = 'https://76unm1rlj0.execute-api.us-east-1.amazonaws.com/default/grumpy2';
let chatState = { step: 'INIT', quizData: {} };
const chatBox = document.getElementById('chatContainer');

// INIT
document.addEventListener('DOMContentLoaded', () => {
    startGuruFlow();
});

// FLOW CONTROL
function startGuruFlow() {
    chatBox.innerHTML = '';
    chatState = { step: 'Q1', quizData: {} };
    
    // Greeting
    setTimeout(() => addMessage('arti', "Hi! I'm Arti. I help people find their path in the Defense Industrial Base."), 500);
    setTimeout(() => addMessage('arti', "If you have a resume, paste it below. If not, I can help you find your role. **What drives you most?**"), 1200);
    
    // Question 1 Options
    setTimeout(() => {
        addOptions([
            { label: "üí∞ Money / Deals", val: "money", next: "Q2" },
            { label: "ü§ù People / Leadership", val: "people", next: "Q2" },
            { label: "üõ†Ô∏è Tech / Building", val: "product", next: "Q2" },
            { label: "üß© Solving Puzzles", val: "puzzle", next: "Q2" }
        ]);
    }, 1800);
}

function handleOptionClick(btnElement, label, value, nextStep) {
    // Remove options
    btnElement.parentElement.remove();
    
    // Add User Bubble
    addMessage('user', label);
    
    // Save Data
    if(chatState.step === 'Q1') chatState.quizData.driver = value;
    if(chatState.step === 'Q2') chatState.quizData.skill = value;
    if(chatState.step === 'Q3') chatState.quizData.clearance = value;
    
    // Trigger Next Step
    showTyping();
    setTimeout(() => {
        removeTyping();
        
        if (nextStep === 'Q2') {
            chatState.step = 'Q2';
            addMessage('arti', "Got it. And what would you say is your **strongest skill**?");
            addOptions([
                { label: "üó£Ô∏è Persuasion", val: "talk", next: "Q3" },
                { label: "üìã Organization", val: "org", next: "Q3" },
                { label: "üíª Coding/Technical", val: "code", next: "Q3" },
                { label: "‚ôüÔ∏è Strategy", val: "strat", next: "Q3" }
            ]);
        } 
        else if (nextStep === 'Q3') {
            chatState.step = 'Q3';
            addMessage('arti', "Last question: Do you have a **Security Clearance**?");
            addOptions([
                { label: "No / Public Trust", val: "none", next: "RESULT" },
                { label: "Secret", val: "secret", next: "RESULT" },
                { label: "TS / SCI", val: "ts", next: "RESULT" }
            ]);
        } 
        else if (nextStep === 'RESULT') {
            chatState.step = 'DONE';
            calculateArchetype();
        }
    }, 1000);
}

function calculateArchetype() {
    const { driver, skill, clearance } = chatState.quizData;
    let title = "The Generalist";
    let icon = "üõ°Ô∏è";
    let desc = "You have broad skills useful across the DIB.";
    let roles = ["Program Analyst"];

    // Simple Logic
    if (driver === 'money' || skill === 'talk') {
        title = "The Rainmaker"; icon = "ü¶Å";
        desc = "You belong in **Growth**. In the DIB, this means Capture Management or Federal Sales.";
        roles = ["Capture Manager", "Federal Sales"];
    } else if (driver === 'people' && skill === 'org') {
        title = "The Commander"; icon = "ü¶Ö";
        desc = "You are a natural **Program Manager**. You keep the mission on track.";
        roles = ["Program Manager", "Project Lead"];
    } else if (driver === 'product' || skill === 'code') {
        title = "The Builder"; icon = "‚ö°";
        desc = "You belong in **Technical Delivery**. Building the tools that protect the mission.";
        roles = ["Solutions Architect", "Systems Engineer"];
    } else if (driver === 'puzzle' || skill === 'strat') {
        title = "The Strategist"; icon = "üß†";
        desc = "You belong in **Operations & Intel**. Analyzing data to drive decisions.";
        roles = ["Strategy Consultant", "Intelligence Analyst"];
    }

    addMessage('arti', "I've analyzed your profile. Here is where you fit:");
    
    // Render Widget
    const div = document.createElement('div');
    div.className = 'chat-widget';
    div.innerHTML = `
        <div class="widget-header">
            <span class="widget-icon">${icon}</span>
            <div class="widget-title">${title}</div>
        </div>
        <div class="widget-body">
            <p style="margin-top:0;">${desc}</p>
            <div class="mono" style="font-size:10px; font-weight:700; margin-top:12px; opacity:0.5;">LIVE JOB FEEDS</div>
            ${roles.map(r => `
                <a href="https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(r)}" target="_blank" class="widget-link">
                    <span>${r}</span><span>‚Üó</span>
                </a>
            `).join('')}
        </div>
    `;
    chatBox.appendChild(div);
    scrollToBottom();
    
    setTimeout(() => {
        addMessage('arti', "You can click those links to see live jobs. Or, **paste a job description** below and I can help you tailor your resume for it.");
    }, 1500);
}

// ==========================================================================
// UI HELPERS
// ==========================================================================
function addMessage(role, text) {
    const div = document.createElement('div');
    div.className = `msg-row ${role}`;
    
    let avatar = role === 'arti' ? 
        `<div class="avatar"><img src="arti.png" alt="A"></div>` : '';
        
    div.innerHTML = `
        ${avatar}
        <div class="bubble">
            ${text.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')}
        </div>
    `;
    chatBox.appendChild(div);
    scrollToBottom();
}

function addOptions(options) {
    const div = document.createElement('div');
    div.className = 'chat-options';
    options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'chat-btn';
        btn.textContent = opt.label;
        btn.onclick = () => handleOptionClick(btn, opt.label, opt.val, opt.next);
        div.appendChild(btn);
    });
    chatBox.appendChild(div);
    scrollToBottom();
}

function showTyping() {
    const div = document.createElement('div');
    div.id = 'typingIndicator';
    div.className = 'msg-row arti';
    div.innerHTML = `
        <div class="avatar"><img src="arti.png" alt="A"></div>
        <div class="bubble">
            <div class="typing"><div class="dot"></div><div class="dot"></div></div>
        </div>
    `;
    chatBox.appendChild(div);
    scrollToBottom();
}

function removeTyping() {
    const el = document.getElementById('typingIndicator');
    if(el) el.remove();
}

function scrollToBottom() {
    chatBox.scrollTop = chatBox.scrollHeight;
}

function resetChat() {
    startGuruFlow();
}

// ==========================================================================
// TEXT INPUT LOGIC (The "Expert" Mode)
// ==========================================================================
async function handleSend() {
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if(!text) return;
    
    // Clear options if they exist (user chose to type instead)
    const existingOpts = document.querySelector('.chat-options');
    if(existingOpts) existingOpts.remove();
    
    input.value = '';
    addMessage('user', text);
    showTyping();
    
    try {
        // If text is long, assume Resume/JD context
        let type = 'ask_expert';
        if(text.length > 200) type = 'resume_match'; // Heuristic
        
        // This simulates the backend call - Connect to your Lambda URL
        const res = await fetch(API_ENDPOINT, {
            method: 'POST',
            body: JSON.stringify({
                request_type: type,
                question: text, // treated as resume/jd if long
                job_description: text, // naive pass-through for demo
                resume_text: text
            })
        });
        const data = await res.json();
        removeTyping();
        
        if(type === 'resume_match') {
            addMessage('arti', `I see you pasted a resume/JD. **Match Score: ${data.score || 75}%**.`);
            addMessage('arti', data.verdict || "This looks like a decent fit.");
        } else {
            addMessage('arti', data.response || "I can help with that. Could you provide the Job Description first?");
        }
        
    } catch(e) {
        removeTyping();
        // Fallback for demo if API isn't live
        setTimeout(() => addMessage('arti', "I'm analyzing that text... (Connect Lambda to see real results)"), 500);
    }
}
</script>
</body>
</html>