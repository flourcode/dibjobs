<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DIB Jobs // Defense Industrial Base</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* ==========================================================================
   NEO-BRUTALIST THEME (Polished)
   ========================================================================== */
:root {
    --ink: #1a1a2e;
    --paper: #ffffff;
    --cream: #f8f6f1;
    
    /* Your Palette */
    --pale-blue: #c8dae8;
    --soft-blue: #93b5d9;
    --mint: #d4e8dc;
    --clay: #e07a5f;
    --gold: #f2cc8f;
    
    /* Construction */
    --border: 3px solid var(--ink);
    --shadow: 5px 5px 0 var(--ink);
    --shadow-active: 2px 2px 0 var(--ink);
    --radius: 12px;
}

* { box-sizing: border-box; }
body { 
    margin: 0; padding: 0; 
    font-family: 'DM Sans', sans-serif; 
    background: var(--pale-blue); 
    color: var(--ink); 
    line-height: 1.6;
    padding-bottom: 80px;
}

h1, h2, h3, .mono { font-family: 'Space Mono', monospace; }

/* HEADER */
header {
    background: var(--paper);
    border-bottom: var(--border);
    padding: 18px 24px;
    position: sticky; top: 0; z-index: 100;
    display: flex; justify-content: space-between; align-items: center;
}
.brand { 
    display: flex; align-items: center; gap: 12px; 
    font-family: 'Space Mono'; font-weight: 700; font-size: 18px; 
    text-transform: uppercase; letter-spacing: -0.5px;
}
.brand-icon { width: 32px; height: 32px; background: var(--ink); color: white; display: grid; place-items: center; border-radius: 6px; }

/* LAYOUT */
main { max-width: 1000px; margin: 40px auto; padding: 0 20px; }

/* CARDS */
.card {
    background: var(--paper);
    border: var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin-bottom: 32px;
    overflow: hidden;
}
.card-header {
    background: var(--cream);
    border-bottom: var(--border);
    padding: 16px 24px;
    display: flex; justify-content: space-between; align-items: center;
}
.card-title {
    font-family: 'Space Mono'; font-weight: 700; font-size: 14px; 
    text-transform: uppercase; letter-spacing: 0.5px;
    display: flex; align-items: center; gap: 10px;
}
.card-body { padding: 32px; }

/* INPUTS */
textarea, input[type="text"], select {
    width: 100%; padding: 16px;
    border: 2px solid var(--ink);
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif; font-size: 14px;
    background: #fafafa;
    transition: all 0.2s;
}
textarea:focus, input:focus, select:focus {
    outline: none; background: #fff;
    box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
}
textarea { min-height: 150px; resize: vertical; }

/* BUTTONS */
.btn {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 14px 24px;
    font-family: 'Space Mono'; font-weight: 700; font-size: 13px; text-transform: uppercase;
    color: var(--ink); background: var(--paper);
    border: var(--border); border-radius: 8px;
    cursor: pointer; box-shadow: var(--shadow);
    transition: all 0.1s;
}
.btn:hover { transform: translate(-2px, -2px); box-shadow: 7px 7px 0 var(--ink); }
.btn:active { transform: translate(2px, 2px); box-shadow: var(--shadow-active); }
.btn-primary { background: var(--mint); }
.btn-secondary { background: var(--paper); }

/* DASHBOARD GRID */
.hero-grid {
    display: grid; grid-template-columns: 220px 1fr;
    border-bottom: var(--border);
}
.score-box {
    background: var(--ink); color: white;
    padding: 40px; text-align: center;
    display: flex; flex-direction: column; justify-content: center;
}
.score-val { font-family: 'Space Mono'; font-size: 80px; font-weight: 700; line-height: 1; }
.score-label { font-family: 'Space Mono'; font-size: 12px; letter-spacing: 2px; opacity: 0.7; margin-top: 10px; text-transform: uppercase; }
.verdict-box { padding: 32px; display: flex; flex-direction: column; justify-content: center; background: var(--cream); }

/* LISTS */
.analysis-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 12px; }
.analysis-item {
    padding: 16px 20px; border: 2px solid var(--ink); border-radius: 8px;
    background: #fff; font-size: 14px; position: relative;
}
.item-match { border-left: 8px solid var(--mint); }
.item-gap { border-left: 8px solid var(--clay); }

/* CHAT INTERFACE (Polished) */
.recruiter-chat {
    background: #f9f9f9; border: 2px solid var(--ink); border-radius: 8px;
    padding: 20px; max-height: 400px; overflow-y: auto; margin-bottom: 20px;
}
.chat-msg {
    margin-bottom: 16px; padding: 14px 18px; border-radius: 12px; font-size: 14px; line-height: 1.5; max-width: 85%;
    border: 2px solid var(--ink); box-shadow: 2px 2px 0 rgba(0,0,0,0.05);
}
.chat-msg.user { background: var(--ink); color: white; margin-left: auto; border-radius: 12px 12px 0 12px; }
.chat-msg.expert { background: white; margin-right: auto; border-radius: 12px 12px 12px 0; }

/* UTILS */
.hidden { display: none; }
.tag { display: inline-block; padding: 4px 10px; border: 1px solid var(--ink); border-radius: 20px; font-size: 11px; font-family: 'Space Mono'; font-weight: 700; margin: 0 4px 4px 0; background: white; }
.tag.missing { background: rgba(224, 122, 95, 0.2); border-color: var(--clay); }
.tag.match { background: var(--mint); }

/* RESPONSIVE */
@media(max-width: 768px) {
    .hero-grid { grid-template-columns: 1fr; }
    .score-box { padding: 20px; flex-direction: row; gap: 20px; align-items: center; }
    .score-val { font-size: 48px; }
    main { margin: 20px auto; padding: 0 16px; }
}
</style>
</head>
<body>

<header>
    <div class="brand">
        <div class="brand-icon">D</div>
        <span>DIB Jobs</span>
    </div>
</header>

<main>
    <div class="card">
        <div class="card-header">
            <span class="card-title">Job Data</span>
            <div>
                <button class="btn btn-secondary" onclick="loadSample()" style="padding: 8px 12px; font-size: 10px;">Load Sample</button>
            </div>
        </div>
        <div class="card-body">
            <div style="display:grid; gap:20px;">
                <div>
                    <label class="mono" style="font-size:12px; font-weight:700; display:block; margin-bottom:8px;">JOB DESCRIPTION</label>
                    <textarea id="jdInput" placeholder="Paste JD or URL..."></textarea>
                </div>
                <div>
                    <label class="mono" style="font-size:12px; font-weight:700; display:block; margin-bottom:8px;">YOUR RESUME</label>
                    <textarea id="resumeInput" placeholder="Paste Resume text..." style="min-height:100px;"></textarea>
                </div>
            </div>
            <div style="margin-top:24px; display:flex; gap:12px;">
                <button id="analyzeBtn" class="btn btn-primary" style="flex:1;" onclick="runAnalysis()">Analyze Match</button>
            </div>
        </div>
    </div>

    <div id="loadingView" class="card" style="display:none; text-align:center; padding:60px;">
        <div class="mono" style="font-size:24px; font-weight:700; animation:blink 1s infinite;">ANALYZING...</div>
    </div>

    <div id="resultsView" style="display:none;">
        
        <div class="card" style="padding:0;">
            <div class="hero-grid">
                <div class="score-box">
                    <div id="scoreVal" class="score-val">--</div>
                    <div class="score-label">Fit Score</div>
                </div>
                <div class="verdict-box">
                    <h2 id="jobRole" style="margin:0 0 8px 0; font-size:20px;">Role Title</h2>
                    <p id="jobCompany" style="margin:0 0 16px 0; opacity:0.7; font-family:'Space Mono'; font-size:12px;">Company</p>
                    <p id="verdictText" style="margin:0; font-size:15px; font-weight:500;">Analysis verdict...</p>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><span class="card-title">Intel & Keywords</span></div>
            <div class="card-body">
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:16px; margin-bottom:24px;">
                    <div style="border:2px solid var(--ink); padding:12px; border-radius:8px; text-align:center;">
                        <div class="mono" style="font-size:10px; opacity:0.6;">SALARY</div>
                        <div id="intelSalary" style="font-weight:700; font-size:18px;">--</div>
                    </div>
                    <div style="border:2px solid var(--ink); padding:12px; border-radius:8px; text-align:center;">
                        <div class="mono" style="font-size:10px; opacity:0.6;">COMPETITION</div>
                        <div id="intelComp" style="font-weight:700; font-size:18px;">--</div>
                    </div>
                    <div style="border:2px solid var(--ink); padding:12px; border-radius:8px; text-align:center;">
                        <div class="mono" style="font-size:10px; opacity:0.6;">CLEARANCE</div>
                        <div id="intelClearance" style="font-weight:700; font-size:18px;">--</div>
                    </div>
                </div>
                <div id="keywordCloud"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><span class="card-title">Gap Analysis</span></div>
            <div class="card-body">
                <ul id="analysisList" class="analysis-list"></ul>
            </div>
        </div>

        <div class="card" style="border-color:var(--ink);">
            <div class="card-header" style="background:var(--gold);">
                <span class="card-title">Ask an Expert (Arti)</span>
            </div>
            <div class="card-body">
                <p style="font-size:13px; margin-bottom:16px; opacity:0.8;">
                    I can help you <strong>negotiate salary</strong>, <strong>rewrite bullets</strong>, or <strong>mock interview</strong> you.
                </p>
                <div id="chatHistory" class="recruiter-chat" style="display:none;"></div>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="chatInput" placeholder="e.g. 'Help me fix my resume gap' or 'Practice interview question'" onkeydown="if(event.key==='Enter') sendChat()">
                    <button class="btn btn-primary" onclick="sendChat()">Ask</button>
                </div>
            </div>
        </div>

    </div>
</main>

<script>
const API_ENDPOINT = 'https://76unm1rlj0.execute-api.us-east-1.amazonaws.com/default/grumpy2';
let analysisData = null;
let chatLog = [];

async function runAnalysis() {
    const jd = document.getElementById('jdInput').value;
    const resume = document.getElementById('resumeInput').value;
    
    if(!jd || !resume) { alert("Please enter both JD and Resume."); return; }
    
    document.getElementById('loadingView').style.display = 'block';
    document.getElementById('resultsView').style.display = 'none';
    document.getElementById('analyzeBtn').disabled = true;
    
    try {
        const res = await fetch(API_ENDPOINT, {
            method: 'POST',
            body: JSON.stringify({
                request_type: 'resume_match',
                job_description: jd,
                resume_text: resume
            })
        });
        const data = await res.json();
        analysisData = data;
        renderResults(data);
        
        // Fetch Intel in background
        fetchIntel(jd, data.job_title, data.company);
        
    } catch(e) {
        alert("Error: " + e.message);
    } finally {
        document.getElementById('loadingView').style.display = 'none';
        document.getElementById('analyzeBtn').disabled = false;
    }
}

function renderResults(data) {
    document.getElementById('resultsView').style.display = 'block';
    
    // Hero
    document.getElementById('scoreVal').innerText = data.score + '%';
    document.getElementById('jobRole').innerText = data.job_title || 'Role';
    document.getElementById('jobCompany').innerText = data.company || 'Company';
    document.getElementById('verdictText').innerText = data.verdict;
    
    // Style Score
    const box = document.querySelector('.score-box');
    box.style.background = data.score >= 80 ? 'var(--mint)' : data.score >= 60 ? 'var(--gold)' : 'var(--clay)';
    box.style.color = 'var(--ink)';

    // List
    const list = document.getElementById('analysisList');
    list.innerHTML = '';
    
    // Sort gaps first
    const items = [...data.analysis].sort((a,b) => a.startsWith('Gap') ? -1 : 1);
    
    items.forEach(item => {
        const isGap = item.startsWith('Gap') || item.startsWith('Risk');
        const li = document.createElement('li');
        li.className = `analysis-item ${isGap ? 'item-gap' : 'item-match'}`;
        li.innerHTML = `<strong>${isGap ? 'GAP / RISK' : 'MATCH'}</strong> ${item.replace(/^(Match:|Gap:|Risk:)/, '')}`;
        list.appendChild(li);
    });

    // Keywords
    const cloud = document.getElementById('keywordCloud');
    cloud.innerHTML = '';
    (data.keywords || []).forEach(k => {
        cloud.innerHTML += `<span class="tag ${k.in_resume ? 'match' : 'missing'}">${k.term}</span>`;
    });
}

function fetchIntel(jd, title, company) {
    fetch(API_ENDPOINT, {
        method: 'POST',
        body: JSON.stringify({request_type:'market_intel', job_description:jd, job_title:title, company:company})
    })
    .then(r => r.json())
    .then(d => {
        if(d.salary_intel) document.getElementById('intelSalary').innerText = `$${d.salary_intel.mid}k`;
        if(d.competition) document.getElementById('intelComp').innerText = d.competition.level;
    });
}

async function sendChat() {
    const input = document.getElementById('chatInput');
    const text = input.value.trim();
    if(!text) return;
    
    // UI Update
    input.value = '';
    const chatDiv = document.getElementById('chatHistory');
    chatDiv.style.display = 'block';
    chatDiv.innerHTML += `<div class="chat-msg user">${text}</div>`;
    chatDiv.scrollTop = chatDiv.scrollHeight;
    
    // Add temporary loading bubble
    const loadId = 'load-' + Date.now();
    chatDiv.innerHTML += `<div id="${loadId}" class="chat-msg expert">Thinking...</div>`;
    
    try {
        const res = await fetch(API_ENDPOINT, {
            method: 'POST',
            body: JSON.stringify({
                request_type: 'ask_expert',
                question: text,
                job_description: document.getElementById('jdInput').value,
                resume_text: document.getElementById('resumeInput').value,
                analysis_data: analysisData,
                chat_history: chatLog
            })
        });
        const data = await res.json();
        
        document.getElementById(loadId).remove();
        chatDiv.innerHTML += `<div class="chat-msg expert">${data.response.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')}</div>`;
        
        chatLog.push({role:'user', content:text});
        chatLog.push({role:'assistant', content:data.response});
        chatDiv.scrollTop = chatDiv.scrollHeight;
        
    } catch(e) {
        document.getElementById(loadId).innerText = "Error connecting.";
    }
}

function loadSample() {
    document.getElementById('jdInput').value = "Director of Federal Sales\n\nWe need a leader with TS/SCI clearance and 10 years of DoD sales experience...";
    document.getElementById('resumeInput').value = "John Doe\nFederal Sales Manager with 12 years experience selling to Army and Navy...";
}
</script>
</body>
</html>