<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Doug-O-Matic // Job Analyzer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    :root {
        /* Palette - Optimized Job Hunter Green */
        --deep-green: #3d6b4c;
        --sage-green: #6b9b7a;
        --fresh-green: #a8c9a0;
        --warm-cream: #f9f7f2;
        /* Mapped Colors */
        --bg-cream: var(--warm-cream);
        --card-white: #FFFFFF;
        --ink-black: #2d4a35;
        /* Accents */
        --accent-mint: var(--fresh-green);
        --accent-olive: var(--sage-green);
        --accent-clay: #d18f7a;
        --accent-gold: #e2bb6e;
        --accent-blue: var(--sage-green);
        /* Spacing & Layout */
        --border-thick: 2px;
        --shadow-hard: 5px 5px 0px var(--ink-black);
        --shadow-hover: 2px 2px 0px var(--ink-black);
        --radius: 6px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        background-color: var(--bg-cream);
        color: var(--ink-black);
        font-family: 'DM Sans', sans-serif;
        line-height: 1.6;
        min-height: 100vh;
        padding-bottom: 80px;
    }
    /* TYPOGRAPHY */
    h1, h2, h3, .mono { font-family: 'Space Mono', monospace; }
    /* HEADER */
    header {
        background: var(--card-white);
        border-bottom: var(--border-thick) solid var(--ink-black);
        padding: 24px 40px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        z-index: 100;
    }
    .brand {
        display: flex;
        align-items: center;
        gap: 16px;
    }
    .logo-box {
        width: 48px;
        height: 48px;
        background: var(--ink-black);
        color: var(--bg-cream);
        display: grid;
        place-items: center;
        font-family: 'Space Mono', monospace;
        font-weight: 700;
        font-size: 28px;
        border-radius: var(--radius);
    }
    .app-title {
        font-size: 20px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: -0.5px;
    }
    .app-version {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
        background: var(--accent-mint);
        padding: 4px 8px;
        border-radius: 4px;
        border: 1px solid var(--ink-black);
    }
    /* MAIN CONTAINER */
    main {
        max-width: 1200px;
        margin: 20px auto; /* Reduced from 40px */
        padding: 0 20px;
    }
    /* CARDS */
    .card {
        background: var(--card-white);
        border: var(--border-thick) solid var(--ink-black);
        border-radius: var(--radius);
        box-shadow: var(--shadow-hard);
        margin-bottom: 32px;
        overflow: hidden;
        transition: transform 0.2s ease;
    }
    .card-header {
        background: var(--bg-cream);
        border-bottom: var(--border-thick) solid var(--ink-black);
        padding: 16px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .card-title {
        font-size: 14px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .card-title::before {
        content: '';
        display: inline-block;
        width: 12px;
        height: 12px;
        background: var(--ink-black);
        border-radius: 50%;
    }
    .card-title.has-avatar::before {
        display: none;
    }
    .card-body {
        padding: 32px;
    }
    /* FORMS & INPUTS */
    textarea {
        width: 100%;
        min-height: 160px;
        padding: 20px;
        font-family: 'Space Mono', monospace;
        font-size: 16px;
        border: var(--border-thick) solid var(--ink-black);
        border-radius: var(--radius);
        background: #FAFAFA;
        resize: vertical;
        transition: all 0.2s;
    }
    textarea:focus {
        outline: none;
        background: #FFFFFF;
        box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
        border-color: var(--ink-black);
    }
    /* BUTTONS */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 12px 24px;
        font-family: 'Space Mono', monospace;
        font-weight: 700;
        font-size: 14px;
        text-transform: uppercase;
        color: var(--ink-black);
        background: var(--card-white);
        border: var(--border-thick) solid var(--ink-black);
        border-radius: var(--radius);
        cursor: pointer;
        box-shadow: var(--shadow-hard);
        transition: all 0.1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        transform: translate(0, 0);
    }
    .btn:hover:not(:disabled) {
        transform: translate(-2px, -2px);
        box-shadow: 7px 7px 0 var(--ink-black);
    }
    .btn:active:not(:disabled) {
        transform: translate(2px, 2px);
        box-shadow: 1px 1px 0 var(--ink-black);
    }
    .btn-primary { background: var(--accent-mint); }
    .btn-primary:hover:not(:disabled) { background: #96bb8d; }
    .btn-secondary { background: var(--card-white); }
    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        background: #eee;
        box-shadow: none;
        transform: none;
    }
    .action-bar {
        margin-top: 20px;
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
    }
    /* INPUT GRID (for Hunter-Killer search) */
    .input-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }
    .input-grid input {
        width: 100%;
        padding: 10px;
        border: 2px solid var(--ink-black);
        border-radius: 4px;
        font-family: 'Space Mono', monospace;
        font-size: 14px;
        background: #FAFAFA;
        transition: all 0.2s;
    }
    .input-grid input:focus {
        outline: none;
        background: #FFFFFF;
        box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
    }
    @media (max-width: 768px) {
        .input-grid {
            grid-template-columns: 1fr;
        }
    }
    /* SEARCH SECTION STYLES */
    .section-label {
        font-family: 'Space Mono', monospace;
        font-size: 13px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 4px;
    }
    .section-desc {
        font-size: 13px;
        opacity: 0.7;
        margin-bottom: 8px;
    }
    .section-divider {
        border: none;
        border-top: 2px dashed var(--ink-black);
        margin: 28px 0;
        opacity: 0.3;
    }
    /* JOB SEARCH PANEL (Tag Cloud) */
    .tag-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .job-tag {
        display: inline-block;
        padding: 6px 14px;
        font-size: 12px;
        font-weight: 600;
        text-decoration: none;
        color: var(--ink-black);
        background: var(--bg-cream);
        border: 1px solid var(--ink-black);
        border-radius: 20px;
        transition: all 0.15s;
        box-shadow: 2px 2px 0 rgba(0,0,0,0.1);
    }
    .job-tag:hover {
        background: var(--ink-black);
        color: var(--card-white);
        transform: translateY(-2px);
        box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
    }
    .category-group { margin-bottom: 24px; }
    .category-label {
        font-family: 'Space Mono', monospace;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1px;
        opacity: 0.6;
        margin-bottom: 12px;
        display: block;
    }
    /* SCORE HERO */
    .hero-grid {
        display: grid;
        grid-template-columns: 200px 1fr;
        border-bottom: var(--border-thick) solid var(--ink-black);
    }
    .score-box {
        background: var(--ink-black);
        color: var(--card-white);
        padding: 40px 20px;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .score-val {
        font-family: 'Space Mono', monospace;
        font-size: 80px;
        line-height: 1;
        font-weight: 700;
    }
    .score-label {
        font-family: 'Space Mono', monospace;
        text-transform: uppercase;
        font-size: 12px;
        letter-spacing: 2px;
        opacity: 0.8;
        margin-top: 10px;
    }
    .verdict-box {
        padding: 32px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        background: var(--bg-cream);
    }
        .score-high .score-box { background: var(--accent-olive); color: #fff; }
    .score-high .score-label { opacity: 0.9; }
    .score-mid .score-box { background: var(--accent-gold); color: var(--ink-black); }
    .score-low .score-box { background: var(--accent-clay); color: #fff; }
    /* LISTS (Matches & Gaps) */
    .analysis-list { list-style: none; display: flex; flex-direction: column; gap: 16px; }
    .analysis-item {
        padding: 16px 20px;
        border: 2px solid var(--ink-black);
        border-radius: var(--radius);
        font-size: 14px;
        background: #fff;
        position: relative;
    }
    .analysis-item strong {
        display: block;
        font-family: 'Space Mono', monospace;
        font-size: 11px;
        text-transform: uppercase;
        margin-bottom: 6px;
    }
    .item-match {
        background: rgba(107, 155, 122, 0.12);
        border-left: 8px solid var(--accent-olive);
    }
    .item-match strong { color: #3d6b4c; }
    .item-gap {
        background: rgba(209, 143, 122, 0.12);
        border-left: 8px solid var(--accent-clay);
    }
    .item-gap strong { color: #b5705e; }
    /* Q&A STYLES */
    .qa-card {
        background: #fff;
        border: 2px solid var(--ink-black);
        margin-bottom: 20px;
        box-shadow: 4px 4px 0 rgba(0,0,0,0.05);
    }
    .qa-q {
        background: var(--accent-mint);
        padding: 12px 20px;
        font-family: 'Space Mono', monospace;
        font-weight: 700;
        font-size: 13px;
        border-bottom: 2px solid var(--ink-black);
    }
    .qa-a {
        padding: 20px;
        font-size: 14px;
        line-height: 1.6;
    }
    /* RESUME PREVIEW */
    .resume-paper {
        background: #fff;
        padding: 40px;
        border: 1px solid #ddd;
        font-size: 14px;
        line-height: 1.6;
        box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
    }
    .resume-paper h2 {
        font-size: 14px;
        border-bottom: 2px solid #000;
        margin: 24px 0 12px 0;
        padding-bottom: 4px;
        text-transform: uppercase;
    }
    /* COPY TOAST */
    .copy-notice {
        position: fixed; 
        bottom: 30px; 
        right: 30px; 
        background: var(--ink-black); 
        color: var(--card-white); 
        padding: 16px 24px; 
        font-family: 'Space Mono'; 
        font-weight: 700; 
        border-radius: 6px; 
        transform: translateY(100px); 
        opacity: 0; 
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        z-index: 999;
    }
    /* ERROR TOAST */
    .error-toast {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: var(--accent-clay);
        color: var(--ink-black);
        padding: 16px 24px;
        font-family: 'Space Mono', monospace;
        font-weight: 700;
        font-size: 13px;
        border-radius: var(--radius);
        border: var(--border-thick) solid var(--ink-black);
        box-shadow: var(--shadow-hard);
        opacity: 0;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 1000;
        max-width: 90%;
        text-align: center;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .error-toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
    .error-toast::before {
        content: '⚠';
        font-size: 18px;
    }
    .error-toast-close {
        background: none;
        border: none;
        color: var(--ink-black);
        font-size: 18px;
        cursor: pointer;
        padding: 0 0 0 12px;
        font-family: 'Space Mono', monospace;
        font-weight: 700;
        opacity: 0.7;
        transition: opacity 0.2s;
    }
    .error-toast-close:hover {
        opacity: 1;
    }
    /* INLINE ERROR MESSAGE (for form validation) */
    .inline-error {
        background: rgba(209, 143, 122, 0.15);
        border: 2px solid var(--accent-clay);
        border-left: 6px solid var(--accent-clay);
        border-radius: var(--radius);
        padding: 16px 20px;
        margin-top: 16px;
        font-family: 'Space Mono', monospace;
        font-size: 13px;
        color: #b5705e;
        display: none;
        align-items: center;
        gap: 12px;
        animation: shake 0.4s ease-in-out;
    }
    .inline-error.show {
        display: flex;
    }
    .inline-error::before {
        content: '✕';
        font-size: 16px;
        font-weight: 700;
        flex-shrink: 0;
    }
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-6px); }
        40%, 80% { transform: translateX(6px); }
    }
    /* COPY BUTTON SUCCESS STATE */
    .btn.copy-success {
        background: var(--accent-olive) !important;
        color: var(--ink-black);
        pointer-events: none;
    }
    /* HOW TO STEPS (used in Quick Start card) */
    .how-to-steps {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
    }
    .how-to-step {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    .step-number {
        width: 36px;
        height: 36px;
        background: var(--ink-black);
        color: var(--card-white);
        font-family: 'Space Mono', monospace;
        font-weight: 700;
        font-size: 16px;
        display: grid;
        place-items: center;
        border-radius: 50%;
        flex-shrink: 0;
    }
    .step-content h3 {
        font-family: 'Space Mono', monospace;
        font-size: 13px;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 6px;
    }
    .step-content p {
        font-size: 14px;
        line-height: 1.5;
        opacity: 0.8;
    }
    .how-to-tip {
        margin-top: 20px;
        padding: 16px 20px;
        background: rgba(168, 201, 160, 0.3);
        border-left: 4px solid var(--accent-mint);
        border-radius: 0 var(--radius) var(--radius) 0;
        font-size: 13px;
    }
    .how-to-tip strong {
        font-family: 'Space Mono', monospace;
        text-transform: uppercase;
        font-size: 11px;
        letter-spacing: 0.5px;
    }
    /* COLLAPSIBLE CARDS */
    .collapsible-card {
        overflow: hidden;
    }
    .collapsible-trigger {
        cursor: pointer;
        user-select: none;
        transition: background 0.2s;
    }
    .collapsible-trigger:hover {
        background: #fff;
    }
    .collapsible-content {
        border-top: var(--border-thick) solid var(--ink-black);
    }
    .collapsible-card.collapsed .collapsible-content {
        display: none;
    }
    .collapsible-card.collapsed .collapsible-trigger {
        border-bottom: none;
    }
    @media (max-width: 768px) {
        .how-to-steps {
            grid-template-columns: 1fr;
            gap: 20px;
        }
        .how-to-step {
            flex-direction: row;
            align-items: flex-start;
        }
        .step-content {
            flex: 1;
        }
    }
    /* RESPONSIVE & MOBILE */
    @media (max-width: 768px) {
        /* General Mobile Adjustments */
        .hero-grid { grid-template-columns: 1fr; }
        .score-box { padding: 20px; flex-direction: row; gap: 20px; align-items: center; }
        .score-val { font-size: 48px; }
        .card-body { padding: 20px; }
        /* HEADER MOBILE LAYOUT */
        header { 
            padding: 16px; 
            position: static; /* Unstick header */
            justify-content: center; /* Center horizontally */
        }
        .brand {
            justify-content: center;
            text-align: center;
            width: 100%;
        }
    }
    /* ANIMATIONS */
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    /* INTEL PANELS */
    .intel-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }
    .intel-panel {
        background: var(--bg-cream);
        border: 2px solid var(--ink-black);
        padding: 20px;
        border-radius: var(--radius);
    }
    .intel-panel-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 2px dashed var(--ink-black);
    }
    .intel-panel-icon {
        width: 32px;
        height: 32px;
        background: var(--ink-black);
        color: var(--bg-cream);
        display: grid;
        place-items: center;
        border-radius: 4px;
        font-size: 16px;
    }
    .intel-panel-title {
        font-family: 'Space Mono', monospace;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .intel-value {
        font-family: 'Space Mono', monospace;
        font-size: 24px;
        font-weight: 700;
        color: var(--ink-black);
        margin-bottom: 4px;
    }
    .intel-label {
        font-size: 12px;
        opacity: 0.7;
    }
    .intel-list {
        list-style: none;
        font-size: 13px;
    }
    .intel-list li {
        padding: 6px 0;
        border-bottom: 1px dashed rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .intel-list li:last-child { border-bottom: none; }
    .intel-badge {
        font-family: 'Space Mono', monospace;
        font-size: 10px;
        padding: 3px 8px;
        border-radius: 3px;
        font-weight: 700;
    }
    .intel-badge.green { background: var(--accent-mint); color: var(--ink-black); }
    .intel-badge.gold { background: var(--accent-gold); color: var(--ink-black); }
    .intel-badge.clay { background: var(--accent-clay); color: #fff; }
    /* KEYWORD EXTRACTION */
    .keyword-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    .keyword-tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: var(--card-white);
        border: 2px solid var(--ink-black);
        border-radius: 20px;
        font-family: 'Space Mono', monospace;
        font-size: 11px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.15s;
    }
    .keyword-tag:hover {
        background: var(--ink-black);
        color: var(--card-white);
    }
    .keyword-tag.in-resume {
        background: var(--accent-mint);
        border-color: #3d6b4c;
    }
    .keyword-tag.missing {
        background: rgba(209, 143, 122, 0.2);
        border-color: var(--accent-clay);
    }
    /* KIT SECTIONS (collapsible grouped content) */
    .kit-section {
        padding: 20px 0;
    }
    .kit-section:first-child { padding-top: 24px; }
    .kit-section-title {
        font-family: 'Space Mono', monospace;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 12px;
        color: var(--ink-black);
    }
    .kit-divider {
        border: none;
        border-top: 1px dashed rgba(0,0,0,0.2);
        margin: 0;
    }
    .resume-paper.compact {
        font-size: 13px;
        padding: 16px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
    }
    /* NETWORK FINDER */
    .network-links {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .network-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 16px;
        background: var(--card-white);
        border: 2px solid var(--ink-black);
        border-radius: var(--radius);
        font-family: 'Space Mono', monospace;
        font-size: 12px;
        font-weight: 600;
        text-decoration: none;
        color: var(--ink-black);
        box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
        transition: all 0.15s;
    }
    .network-link:hover {
        transform: translate(-2px, -2px);
        box-shadow: 5px 5px 0 rgba(0,0,0,0.15);
        background: var(--accent-mint);
    }
    /* APPLICATION TRACKER */
    .tracker-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
    }
    .tracker-table th {
        font-family: 'Space Mono', monospace;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        text-align: left;
        padding: 10px 8px;
        background: var(--bg-cream);
        border: 2px solid var(--ink-black);
        white-space: nowrap;
    }
    .tracker-table td {
        padding: 10px 8px;
        border: 2px solid var(--ink-black);
        vertical-align: middle;
        font-size: 12px;
    }
    .tracker-table tr:hover td { background: rgba(168, 201, 160, 0.1); }
    /* Hide less important columns on mobile */
    @media (max-width: 600px) {
        .tracker-table th:nth-child(5),
        .tracker-table td:nth-child(5) { display: none; } /* Hide Date */
        .tracker-table th, .tracker-table td { padding: 8px 6px; font-size: 11px; }
        .tracker-table th { font-size: 9px; }
    }
    .status-pill {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 12px;
        font-family: 'Space Mono', monospace;
        font-size: 9px;
        font-weight: 700;
        text-transform: uppercase;
    }
    .status-saved { background: var(--bg-cream); border: 1px solid var(--ink-black); }
    .status-applied { background: var(--accent-mint); color: var(--ink-black); }
    .status-interviewing { background: var(--accent-gold); color: var(--ink-black); }
    .status-offered { background: var(--accent-olive); color: #fff; }
    .status-rejected { background: var(--accent-clay); color: #fff; }
    .tracker-actions { display: flex; gap: 6px; }
    .tracker-btn {
        padding: 4px 8px;
        font-size: 10px;
        border: 1px solid var(--ink-black);
        background: var(--card-white);
        cursor: pointer;
        border-radius: 3px;
        font-family: 'Space Mono', monospace;
    }
    .tracker-btn:hover { background: var(--ink-black); color: var(--card-white); }
    /* FOLLOW-UP TEMPLATES */
    .template-tabs { display: flex; gap: 0; border-bottom: none; }
    .template-tab {
        padding: 12px 20px;
        font-family: 'Space Mono', monospace;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        background: var(--bg-cream);
        border: 2px solid var(--ink-black);
        border-bottom: none;
        cursor: pointer;
        margin-right: -2px;
        position: relative;
    }
    .template-tab.active { background: var(--card-white); z-index: 1; }
    .template-content {
        border: 2px solid var(--ink-black);
        padding: 20px;
        background: var(--card-white);
        margin-top: -2px;
    }
    .template-text {
        font-family: 'DM Sans', sans-serif;
        font-size: 14px;
        line-height: 1.7;
        white-space: pre-wrap;
        background: #fafafa;
        padding: 20px;
        border: 1px dashed var(--ink-black);
        border-radius: var(--radius);
    }
    /* SALARY INTEL */
    .salary-range-bar {
        height: 24px;
        background: linear-gradient(90deg, var(--accent-clay) 0%, var(--accent-gold) 50%, var(--accent-mint) 100%);
        border-radius: 12px;
        position: relative;
        margin: 20px 0 30px;
        border: 2px solid var(--ink-black);
    }
    .salary-marker {
        position: absolute;
        top: -8px;
        width: 4px;
        height: 40px;
        background: var(--ink-black);
        transform: translateX(-50%);
    }
    .salary-marker::after {
        content: attr(data-label);
        position: absolute;
        top: 44px;
        left: 50%;
        transform: translateX(-50%);
        font-family: 'Space Mono', monospace;
        font-size: 10px;
        white-space: nowrap;
    }
    .salary-labels {
        display: flex;
        justify-content: space-between;
        font-family: 'Space Mono', monospace;
        font-size: 12px;
        margin-top: 8px;
    }
    /* TIMELINE */
    .timeline-estimate {
        display: flex;
        align-items: flex-start;
        gap: 0;
        margin: 16px 0;
        padding: 0 10px;
    }
    .timeline-step {
        flex: 1;
        text-align: center;
        position: relative;
    }
    .timeline-step::after {
        content: '';
        position: absolute;
        top: 12px;
        left: 50%;
        width: 100%;
        height: 2px;
        background: var(--ink-black);
    }
    .timeline-step:last-child::after { display: none; }
    .timeline-dot {
        width: 26px;
        height: 26px;
        background: var(--card-white);
        border: 2px solid var(--ink-black);
        border-radius: 50%;
        margin: 0 auto 6px;
        position: relative;
        z-index: 1;
        display: grid;
        place-items: center;
        font-size: 12px;
        font-weight: 700;
    }
    .timeline-label {
        font-family: 'Space Mono', monospace;
        font-size: 9px;
        text-transform: uppercase;
        letter-spacing: -0.5px;
    }
    .timeline-days { font-size: 10px; opacity: 0.6; margin-top: 2px; }
    /* EMPTY STATE */
    .empty-tracker {
        text-align: center;
        padding: 40px;
        background: var(--bg-cream);
        border: 2px dashed var(--ink-black);
        border-radius: var(--radius);
    }
    .empty-tracker p { font-size: 14px; opacity: 0.7; margin-bottom: 16px; }
    @media (max-width: 768px) {
        .intel-grid { grid-template-columns: 1fr; }
        /* Timeline stays horizontal but smaller */
        .timeline-estimate { padding: 0 5px; margin: 12px 0; }
        .timeline-dot { width: 22px; height: 22px; font-size: 10px; }
        .timeline-label { font-size: 8px; }
        .timeline-days { font-size: 9px; }
        .timeline-step::after { top: 10px; }
    }
    /* ASK A RECRUITER CHAT - Neo Brutalist Style */
    .recruiter-message {
        padding: 20px;
        margin-bottom: 20px;
        font-size: 14px;
        line-height: 1.7;
        border: var(--border-thick) solid var(--ink-black);
        border-radius: var(--radius);
        box-shadow: var(--shadow-hard);
    }
    .recruiter-message p {
        margin-bottom: 12px;
    }
    .recruiter-message p:last-child {
        margin-bottom: 0;
    }
    .recruiter-message.user {
        background: var(--card-white);
        margin-left: 60px;
    }
    .user-label {
        display: inline-block;
        font-family: 'Space Mono', monospace;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        background: var(--ink-black);
        color: var(--card-white);
        padding: 4px 10px;
        border-radius: 3px;
        margin-bottom: 12px;
    }
    .recruiter-message.assistant {
        background: var(--card-white);
        margin-right: 60px;
    }
    .recruiter-header {
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 16px;
        padding-bottom: 16px;
        border-bottom: var(--border-thick) solid var(--ink-black);
    }
    .recruiter-avatar {
        width: 56px;
        height: 56px;
        object-fit: cover;
    }
    .recruiter-info {
        flex: 1;
    }
    .recruiter-name {
        font-family: 'Space Mono', monospace;
        font-size: 13px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--ink-black);
    }
    .recruiter-title {
        font-size: 11px;
        opacity: 0.7;
        margin-top: 3px;
    }
    .recruiter-badge {
        display: inline-block;
        font-family: 'Space Mono', monospace;
        font-size: 9px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: var(--accent-mint);
        color: var(--ink-black);
        padding: 4px 8px;
        border-radius: 3px;
        border: 1px solid var(--ink-black);
    }
    .recruiter-thinking {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 20px;
        background: var(--bg-cream);
        border: var(--border-thick) dashed var(--ink-black);
        border-radius: var(--radius);
        margin-right: 60px;
        margin-bottom: 20px;
        font-family: 'Space Mono', monospace;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--ink-black);
    }
    .recruiter-thinking::before {
        content: '';
        width: 20px;
        height: 20px;
        border: 3px solid var(--ink-black);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }
    @media (max-width: 768px) {
        .recruiter-message.user {
            margin-left: 20px;
        }
        .recruiter-message.assistant {
            margin-right: 20px;
        }
        .recruiter-thinking {
            margin-right: 20px;
        }
        .recruiter-avatar {
            width: 48px;
            height: 48px;
        }
    }
</style>
</head>
<body>
<header>
    <div class="brand">
        <div>
            <div class="app-title">Super Doug-O-Matic '76</div>
            <div class="app-version">v2.5 // Flournoy-Yutani Corporation</div>
        </div>
    </div>
</header>
<main>
    <!-- QUICK START CARD (Collapsible, starts collapsed) -->
    <div id="quickStartCard" class="card collapsible-card collapsed">
        <div class="card-header collapsible-trigger" onclick="toggleQuickStart()" role="button" tabindex="0" aria-expanded="false" aria-controls="quickStartContent" aria-label="Toggle quick start guide" onkeydown="if(event.key==='Enter'||event.key===' '){toggleQuickStart();event.preventDefault();}">
            <span class="card-title">Quick Start</span>
            <span id="quickStartToggleIcon" class="mono" style="font-weight: 700; font-size: 20px;" aria-hidden="true">+</span>
        </div>
        <div id="quickStartContent" class="collapsible-content">
            <div class="card-body">
                <div class="how-to-steps">
                    <div class="how-to-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Find a Job</h3>
                            <p>Use the <strong>Job Search</strong> tab to find fresh listings on job boards or browse LinkedIn company pages.</p>
                        </div>
                    </div>
                    <div class="how-to-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>Grab the Posting</h3>
                            <p>Copy the full job description text <em>or</em> just paste the URL directly — Doug-O-Matic will fetch it for you.</p>
                        </div>
                    </div>
                    <div class="how-to-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Analyze & Prep</h3>
                            <p>Hit <strong>Analyze Match</strong> to get your fit score, tailored resume, interview prep, and a custom intro email.</p>
                        </div>
                    </div>
                </div>
                <div class="how-to-tip">
                    <strong>Hey, Doug! Welcome to your custom job search engine.</strong> Here's what this thing does for you:
                    <ul style="margin: 12px 0 0 20px; line-height: 1.8;">
                        <li><strong>Job Search:</strong> Google-dork hidden ATS platforms (Greenhouse, Lever, Workday, etc.) to find jobs before they hit LinkedIn. Also quick links to aggregators and company pages.</li>
                        <li><strong>Match Score:</strong> AI analyzes the JD against your full resume and gives you a realistic 0-100 fit score.</li>
                        <li><strong>Gap Analysis:</strong> Shows your strongest matches AND flags gaps/risks so you know what to address.</li>
                        <li><strong>Job Intel:</strong> AI-generated salary estimates, hiring timeline, competition level, and company intel.</li>
                        <li><strong>Red/Green Flags:</strong> AI analyzes the job posting itself for warning signs or positive indicators.</li>
                        <li><strong>Keywords:</strong> Important terms from the JD with a check on which ones are already in your resume.</li>
                        <li><strong>Tailored Resume:</strong> Rewrites your executive summary with keywords from the JD. Copy and paste into your resume.</li>
                        <li><strong>Intro Email:</strong> One-click generation of a confident, no-BS email to the recruiter or hiring manager.</li>
                        <li><strong>Interview Prep:</strong> Generates likely interview questions with suggested answers pulled from your actual experience.</li>
                        <li><strong>Gap Strategies:</strong> Tactical talking points for spinning or mitigating any weaknesses.</li>
                        <li><strong>Ask a Recruiter:</strong> Chat with "Arti" — a grumpy-but-helpful senior federal recruiter who gives you straight talk on salary, gaps, company intel, and how to actually land the job.</li>
                        <li><strong>Network Intel:</strong> LinkedIn search links to find recruiters, executives, and veterans at the target company.</li>
                        <li><strong>Follow-up Templates:</strong> Pre-written emails for after applying, post-interview, check-ins, and negotiation.</li>
                        <li><strong>Application Tracker:</strong> Save jobs locally and track your application status over time.</li>
                    </ul>
                    <p style="margin-top: 12px;">Paste a JD (or just the URL) and hit <strong>Analyze Match</strong>. Let me know if you want to tweak anything!</p>
                </div>
            </div>
        </div>
    </div>
    <!-- JOB DESCRIPTION CARD -->
    <div class="card">
        <div class="card-header">
            <span class="card-title">Paste Job Description or URL</span>
        </div>
        <div class="card-body">
            <textarea id="jobDescription" placeholder="Paste JD content or a URL to the JD here..." aria-label="Job description input"></textarea>
            <div class="action-bar">
                <button id="analyzeBtn" class="btn btn-primary" onclick="analyzeJob()" aria-label="Analyze job match">
                    <span id="btnText">Analyze Match</span>
                </button>
                <button class="btn btn-secondary" onclick="clearAll()" aria-label="Reset form and clear results">Reset</button>
                <button class="btn btn-secondary" onclick="loadSampleJD()" aria-label="Load sample job description">Load Sample</button>
            </div>
            <!-- Inline error message for form validation -->
            <div id="inlineError" class="inline-error" role="alert" aria-live="polite">
                <span id="inlineErrorText"></span>
            </div>
        </div>
    </div>
    <!-- JOB SEARCH CARD (Collapsible, starts open) -->
    <div id="jobSearchCard" class="card collapsible-card">
        <div class="card-header collapsible-trigger" onclick="toggleJobSearch()" role="button" tabindex="0" aria-expanded="true" aria-controls="jobSearchContent" aria-label="Toggle job search tools" onkeydown="if(event.key==='Enter'||event.key===' '){toggleJobSearch();event.preventDefault();}">
            <span class="card-title">Job Search</span>
            <span id="jobSearchToggleIcon" class="mono" style="font-weight: 700; font-size: 20px;" aria-hidden="true">−</span>
        </div>
        <div id="jobSearchContent" class="collapsible-content">
            <div class="card-body">
                <!-- HUNTER-KILLER SECTION -->
                <div class="search-section">
                    <h3 class="section-label">Cyberdyne T-1000 Job Hunter</h3>
                    <p class="section-desc">Google-dork ATS platforms to find jobs before they hit the aggregators.</p>
                    <div class="input-grid" style="margin: 16px 0;">
                        <div>
                            <label class="category-label">Target Role</label>
                            <input type="text" id="targetRole" value="Director" placeholder="e.g. Director, VP, Capture Manager">
                        </div>
                        <div>
                            <label class="category-label">Keyword</label>
                            <input type="text" id="targetKeyword" value="TS/SCI" placeholder="e.g. TS/SCI, Company, Polygraph, Remote">
                        </div>
                    </div>
<div class="category-label" style="margin-bottom: 8px;">Job Boards & Aggregators</div>
                    <div class="action-bar" style="margin-top:0; margin-bottom: 16px;">
                        <button class="btn btn-secondary" onclick="runLinkedIn()">LinkedIn (7 Days)</button>
                        <button class="btn btn-secondary" onclick="runClearanceJobs()">ClearanceJobs</button>
                        <button class="btn btn-secondary" onclick="runDork('myworkdayjobs.com')">Workday</button>
                    </div>
                </div>
                <!-- DIVIDER -->
                <hr class="section-divider">
                <!-- BROWSE BY COMPANY SECTION -->
                <div class="search-section" style="background: #fafafa; margin: -32px; margin-top: 0; padding: 24px 32px;">
                    <h3 class="section-label">Browse by Company</h3>
                    <p class="section-desc">Direct links to company career pages on LinkedIn.</p>
                    <div class="category-group">
                        <span class="category-label">Federal Primes</span>
                        <div class="tag-cloud">
                            <a href="https://www.linkedin.com/company/lockheed-martin/jobs/" target="_blank" class="job-tag">Lockheed Martin</a>
                            <a href="https://www.linkedin.com/company/rtx/jobs/" target="_blank" class="job-tag">RTX (Raytheon)</a>
                            <a href="https://www.linkedin.com/company/gdit/jobs/" target="_blank" class="job-tag">GDIT</a>
                            <a href="https://www.linkedin.com/company/northrop-grumman-corporation/jobs/" target="_blank" class="job-tag">Northrop Grumman</a>
                            <a href="https://www.linkedin.com/company/boeing/jobs/" target="_blank" class="job-tag">Boeing</a>
                            <a href="https://www.linkedin.com/company/leidos/jobs/" target="_blank" class="job-tag">Leidos</a>
                            <a href="https://www.linkedin.com/company/bae-systems/jobs/" target="_blank" class="job-tag">BAE Systems</a>
                            <a href="https://www.linkedin.com/company/l3harris-technologies/jobs/" target="_blank" class="job-tag">L3Harris</a>
                            <a href="https://www.linkedin.com/company/mission-technologies-a-division-of-hii/jobs/" target="_blank" class="job-tag">HII</a>
                            <a href="https://www.linkedin.com/company/booz-allen-hamilton/jobs/" target="_blank" class="job-tag">Booz Allen Hamilton</a>
                            <a href="https://www.linkedin.com/company/saicinc/jobs/" target="_blank" class="job-tag">SAIC</a>
                            <a href="https://www.linkedin.com/company/caci-international-inc/jobs/" target="_blank" class="job-tag">CACI</a>
                            <a href="https://www.linkedin.com/company/mantech/jobs/" target="_blank" class="job-tag">ManTech</a>
                            <a href="https://www.linkedin.com/company/peraton/jobs/" target="_blank" class="job-tag">Peraton</a>
                            <a href="https://www.linkedin.com/company/parsons/jobs/" target="_blank" class="job-tag">Parsons</a>
                            <a href="https://www.linkedin.com/company/amentumcorp/jobs/" target="_blank" class="job-tag">Amentum</a>
                            <a href="https://www.linkedin.com/company/kbr-inc/jobs/" target="_blank" class="job-tag">KBR</a>
                            <a href="https://www.linkedin.com/company/maxar-technologies-ltd/jobs/" target="_blank" class="job-tag">Maxar</a>
                            <a href="https://www.linkedin.com/company/anduril/jobs/" target="_blank" class="job-tag">Anduril</a>
                            <a href="https://www.linkedin.com/company/palantir-technologies/jobs/" target="_blank" class="job-tag">Palantir</a>
                            <a href="https://www.linkedin.com/company/shield-ai/jobs/" target="_blank" class="job-tag">Shield AI</a>
                            <a href="https://www.linkedin.com/company/sierra-nevada-corporation/jobs/" target="_blank" class="job-tag">SNC</a>
                            <a href="https://www.linkedin.com/company/jacobs/jobs/" target="_blank" class="job-tag">Jacobs</a>
                            <a href="https://www.linkedin.com/company/mitre/jobs/" target="_blank" class="job-tag">MITRE</a>
                            <a href="https://www.linkedin.com/company/battelle/jobs/" target="_blank" class="job-tag">Battelle</a>
                            <a href="https://www.linkedin.com/company/guidehouse/jobs/" target="_blank" class="job-tag">Guidehouse</a>
                            <a href="https://www.linkedin.com/company/spacex/jobs/" target="_blank" class="job-tag">SpaceX</a>
                        </div>
                    </div>
                    <div class="category-group">
                        <span class="category-label">Cloud Service Providers</span>
                        <div class="tag-cloud">
                            <a href="https://www.linkedin.com/company/amazon-web-services/jobs/" target="_blank" class="job-tag">Amazon / AWS</a>
                            <a href="https://www.linkedin.com/company/microsoft/jobs/" target="_blank" class="job-tag">Microsoft / Azure</a>
                            <a href="https://www.linkedin.com/company/google-cloud/jobs/" target="_blank" class="job-tag">Google Cloud</a>
                            <a href="https://www.linkedin.com/company/oracle/jobs/" target="_blank" class="job-tag">Oracle Cloud</a>
                            <a href="https://www.linkedin.com/company/ibm/jobs/" target="_blank" class="job-tag">IBM Cloud</a>
                        </div>
                    </div>
                    <div class="category-group">
                        <span class="category-label">SaaS & Platforms</span>
                        <div class="tag-cloud">
                            <a href="https://www.linkedin.com/company/salesforce/jobs/" target="_blank" class="job-tag">Salesforce</a>
                            <a href="https://www.linkedin.com/company/servicenow/jobs/" target="_blank" class="job-tag">ServiceNow</a>
                            <a href="https://www.linkedin.com/company/snowflake-computing/jobs/" target="_blank" class="job-tag">Snowflake</a>
                            <a href="https://www.linkedin.com/company/databricks/jobs/" target="_blank" class="job-tag">Databricks</a>
                            <a href="https://www.linkedin.com/company/atlassian/jobs/" target="_blank" class="job-tag">Atlassian</a>
                            <a href="https://www.linkedin.com/company/palo-alto-networks/jobs/" target="_blank" class="job-tag">Palo Alto Networks</a>
                            <a href="https://www.linkedin.com/company/crowdstrike/jobs/" target="_blank" class="job-tag">CrowdStrike</a>
                            <a href="https://www.linkedin.com/company/zscaler/jobs/" target="_blank" class="job-tag">Zscaler</a>
                            <a href="https://www.linkedin.com/company/tenableinc/jobs/" target="_blank" class="job-tag">Tenable</a>
                            <a href="https://www.linkedin.com/company/okta-inc-/jobs/" target="_blank" class="job-tag">Okta</a>
                            <a href="https://www.linkedin.com/company/splunk/jobs/" target="_blank" class="job-tag">Splunk (Cisco)</a>
                        </div>
                    </div>
                    <div class="category-group">
                        <span class="category-label">Systems Integrators</span>
                        <div class="tag-cloud">
                            <a href="https://www.linkedin.com/company/accenturefederalservices/jobs/" target="_blank" class="job-tag">Accenture Federal</a>
                            <a href="https://www.linkedin.com/company/deloitte/jobs/" target="_blank" class="job-tag">Deloitte</a>
                            <a href="https://www.linkedin.com/company/pwc/jobs/" target="_blank" class="job-tag">PwC</a>
                            <a href="https://www.linkedin.com/company/ernstandyoung/jobs/" target="_blank" class="job-tag">EY</a>
                            <a href="https://www.linkedin.com/company/kpmg-us/jobs/" target="_blank" class="job-tag">KPMG</a>
                            <a href="https://www.linkedin.com/company/capgemini/jobs/" target="_blank" class="job-tag">Capgemini</a>
                        </div>
                    </div>
                    <div class="category-group" style="margin-bottom: 0;">
                        <span class="category-label">VARs & Resellers</span>
                        <div class="tag-cloud">
                            <a href="https://www.linkedin.com/company/cdw/jobs/" target="_blank" class="job-tag">CDW-G</a>
                            <a href="https://www.linkedin.com/company/carahsoft/jobs/" target="_blank" class="job-tag">Carahsoft</a>
                            <a href="https://www.linkedin.com/company/world-wide-technology/jobs/" target="_blank" class="job-tag">WWT</a>
                            <a href="https://www.linkedin.com/company/iron-bow-technologies/jobs/" target="_blank" class="job-tag">Iron Bow</a>
                            <a href="https://www.linkedin.com/company/presidio-/jobs/" target="_blank" class="job-tag">Presidio</a>
                            <a href="https://www.linkedin.com/company/dxctechnology/jobs/" target="_blank" class="job-tag">DXC Technology</a>
                            <a href="https://www.linkedin.com/company/cgi/jobs/" target="_blank" class="job-tag">CGI Federal</a>
                            <a href="https://www.linkedin.com/company/red-river-technology/jobs/" target="_blank" class="job-tag">Red River</a>
                            <a href="https://www.linkedin.com/company/thundercat-technology/jobs/" target="_blank" class="job-tag">ThunderCat</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<div id="loadingCard" class="card" style="display:none; text-align:center; padding: 48px 24px; background: var(--bg-cream); border: 2px dashed var(--ink-black);">
        <div class="spinner-box" style="margin-bottom: 24px;">
            <div style="display:inline-block; width: 40px; height: 40px; border: 4px solid var(--ink-black); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
        </div>
        <h2 id="loadingStep" style="font-size: 18px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px;">
            Initializing Neural Net...
        </h2>
        <div style="max-width: 400px; margin: 0 auto; border: 2px solid var(--ink-black); height: 24px; border-radius: 12px; background: #fff; overflow: hidden; position: relative;">
            <div id="loadingProgress" style="width: 5%; height: 100%; background: var(--accent-mint); border-right: 2px solid var(--ink-black); transition: width 0.3s ease;"></div>
        </div>
        <p style="margin-top: 16px; font-family: 'Space Mono'; font-size: 11px; opacity: 0.6;">
            Analyzing 25+ years of experience against job requirements...
        </p>
    </div>
    <div id="analysisResults" style="display: none;">
        <!-- 1. SCORE/VERDICT -->
        <div class="card" style="padding:0;">
            <div id="matchScoreContainer" class="hero-grid">
                </div>
        </div>
        
       
        
        <!-- 3. JOB INTEL (Combined: salary, timeline, competition, flags, company) -->
        <div id="jobIntelSection" class="card" style="display:none;">
            <div class="card-header">
                <span class="card-title">Job Intel</span>
            </div>
            <div class="card-body">
                <div class="intel-grid">
                    <div class="intel-panel">
                        <div class="intel-panel-header">
                            <div class="intel-panel-title">Salary Estimate</div>
                        </div>
                        <div id="salaryIntel">
                            <div class="intel-value" id="salaryRange">Loading...</div>
                            <div class="intel-label">Based on role level & market</div>
                            <div class="salary-range-bar">
                                <div class="salary-marker" style="left: 60%;" data-label="Target"></div>
                            </div>
                            <div class="salary-labels">
                                <span id="salaryLow">$0K</span>
                                <span id="salaryHigh">$0K</span>
                            </div>
                        </div>
                    </div>
                    <div class="intel-panel">
                        <div class="intel-panel-header">
                            <div class="intel-panel-title">Hiring Timeline</div>
                        </div>
                        <div class="timeline-estimate" id="hiringTimeline">
                            <div class="timeline-step">
                                <div class="timeline-dot">1</div>
                                <div class="timeline-label">Apply</div>
                                <div class="timeline-days">Today</div>
                            </div>
                            <div class="timeline-step">
                                <div class="timeline-dot">2</div>
                                <div class="timeline-label">Screen</div>
                                <div class="timeline-days">...</div>
                            </div>
                            <div class="timeline-step">
                                <div class="timeline-dot">3</div>
                                <div class="timeline-label">Interview</div>
                                <div class="timeline-days">...</div>
                            </div>
                            <div class="timeline-step">
                                <div class="timeline-dot">4</div>
                                <div class="timeline-label">Offer</div>
                                <div class="timeline-days">...</div>
                            </div>
                        </div>
                    </div>
                    <div class="intel-panel">
                        <div class="intel-panel-header">
                            <div class="intel-panel-title">Competition Level</div>
                        </div>
                        <div id="competitionIntel">
                            <div class="intel-value" id="competitionLevel">Loading...</div>
                            <div class="intel-label" id="competitionDesc">Analyzing competition...</div>
                        </div>
                    </div>
                </div>
                <!-- Company Intel (rendered by JS if available) -->
                <div id="companyIntelContainer" style="margin-top: 24px;"></div>
            </div>
        </div>
        
        <!-- 4. ASK A RECRUITER (high for decision support) -->
        <div id="askRecruiterSection" class="card">
            <div class="card-header">
                <span class="card-title has-avatar" style="gap: 12px;">
                    <img src="arti.png" alt="Arti" style="width: 48px; height: 48px; border-radius: var(--radius);">
                    Ask a Grumpy Recruiter
                </span>
            </div>
            <div class="card-body">
                <p style="margin-bottom: 16px; font-size: 14px; opacity: 0.8;">Questions about salary, fit, red flags, or how to position yourself? Get straight answers.</p>
                <textarea id="recruiterQuestion" placeholder="e.g. 'Is this salary competitive?' or 'Should I be worried about that gap?'" style="min-height: 80px;" aria-label="Your question for the recruiter"></textarea>
                <div class="action-bar">
                    <button id="askRecruiterBtn" class="btn btn-primary" onclick="askRecruiter()" aria-label="Ask the recruiter">
                        <span id="askRecruiterBtnText">Ask</span>
                    </button>
                    <button class="btn btn-secondary" onclick="clearRecruiterChat()" aria-label="Clear conversation">Clear</button>
                </div>
                <div id="recruiterChatHistory" style="margin-top: 24px; display: none;"></div>
            </div>
        </div>
         <!-- 2. GAP ANALYSIS -->
        <div class="card">
            <div class="card-header"><span class="card-title">Gap Analysis</span></div>
            <div class="card-body">
                <ul id="analysisList" class="analysis-list"></ul>
            </div>
        </div>
        <!-- 5. APPLICATION KIT (Collapsible: keywords, resume, intro email) -->
        <div id="applicationKitCard" class="card collapsible-card collapsed">
            <div class="card-header collapsible-trigger" onclick="toggleKit('application')" role="button" tabindex="0" aria-expanded="false">
                <span class="card-title">Application Kit</span>
                <span id="applicationKitToggle" class="mono" style="font-weight: 700; font-size: 20px;">+</span>
            </div>
            <div id="applicationKitContent" class="collapsible-content">
                <div class="card-body" style="padding-top: 0;">
                    <!-- Keywords -->
                    <div id="keywordSection" class="kit-section">
                        <h4 class="kit-section-title">Keywords to Add</h4>
                        <p style="margin-bottom: 12px; font-size: 13px; opacity: 0.7;"><span style="background: var(--accent-mint); padding: 2px 6px; border-radius: 3px;">Green</span> = in resume. <span style="background: rgba(209, 143, 122, 0.3); padding: 2px 6px; border-radius: 3px;">Orange</span> = missing.</p>
                        <div class="keyword-cloud" id="keywordCloud"></div>
                        <button class="btn btn-secondary" onclick="copyKeywords()" style="margin-top: 12px; padding: 6px 12px; font-size: 11px;">Copy Keywords</button>
                    </div>
                    
                    <hr class="kit-divider">
                    
                    <!-- Tailored Resume -->
                    <div class="kit-section">
                        <h4 class="kit-section-title">Tailored Executive Summary</h4>
                        <div id="resumeOutput" class="resume-paper compact" role="region" aria-label="Tailored resume preview"></div>
                        <button class="btn btn-secondary" onclick="copyResume()" style="margin-top: 12px; padding: 6px 12px; font-size: 11px;">Copy Summary</button>
                    </div>
                    
                    <hr class="kit-divider">
                    
                    <!-- Intro Email -->
                    <div class="kit-section">
                        <h4 class="kit-section-title">Intro Email</h4>
                        <div id="coverLetterPlaceholder">
                            <button class="btn btn-primary" onclick="generateCoverLetter()" id="generateCoverLetterBtn" aria-label="Generate intro email">
                                Generate Intro Email
                            </button>
                        </div>
                        <div id="coverLetterDisplay" style="display:none; white-space: pre-wrap; font-family: 'DM Sans'; font-size: 14px; line-height: 1.6; background: #fff; padding: 16px; border: 1px solid #ddd; border-radius: var(--radius);" role="region"></div>
                        <button id="copyCLBtn" class="btn btn-secondary" onclick="copyCoverLetter()" style="display:none; margin-top: 12px; padding: 6px 12px; font-size: 11px;">Copy Email</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 6. INTERVIEW KIT (Collapsible: interview prep, gap strategies) -->
        <div id="interviewKitCard" class="card collapsible-card collapsed">
            <div class="card-header collapsible-trigger" onclick="toggleKit('interview')" role="button" tabindex="0" aria-expanded="false">
                <span class="card-title">Interview Kit</span>
                <span id="interviewKitToggle" class="mono" style="font-weight: 700; font-size: 20px;">+</span>
            </div>
            <div id="interviewKitContent" class="collapsible-content">
                <div class="card-body" style="padding-top: 0;">
                    <!-- Interview Questions -->
                    <div id="interviewQuestionsSection" class="kit-section">
                        <h4 class="kit-section-title">Likely Interview Questions</h4>
                        <div id="interviewQuestionsList"></div>
                    </div>
                    
                    <hr class="kit-divider">
                    
                    <!-- Gap Strategies -->
                    <div id="gapStrategiesSection" class="kit-section">
                        <h4 class="kit-section-title">Gap Mitigation Strategies</h4>
                        <div id="gapStrategiesList"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 7. OUTREACH KIT (Collapsible: network, templates) -->
        <div id="outreachKitCard" class="card collapsible-card collapsed">
            <div class="card-header collapsible-trigger" onclick="toggleKit('outreach')" role="button" tabindex="0" aria-expanded="false">
                <span class="card-title">Outreach Kit</span>
                <span id="outreachKitToggle" class="mono" style="font-weight: 700; font-size: 20px;">+</span>
            </div>
            <div id="outreachKitContent" class="collapsible-content">
                <div class="card-body" style="padding-top: 0;">
                    <!-- Network Intel -->
                    <div id="networkSection" class="kit-section">
                        <h4 class="kit-section-title">Find Connections at <span id="networkCompany">This Company</span></h4>
                        <div class="network-links" id="networkLinks"></div>
                    </div>
                    
                    <hr class="kit-divider">
                    
                    <!-- Follow-up Templates -->
                    <div id="templatesSection" class="kit-section">
                        <h4 class="kit-section-title">Follow-Up Templates</h4>
                        <div class="template-tabs">
                            <button class="template-tab active" onclick="showTemplate('applied')">After Applying</button>
                            <button class="template-tab" onclick="showTemplate('interview')">Post-Interview</button>
                            <button class="template-tab" onclick="showTemplate('followup')">Check-In</button>
                            <button class="template-tab" onclick="showTemplate('negotiate')">Negotiation</button>
                        </div>
                        <div class="template-content">
                            <div id="templateApplied" class="template-text"></div>
                            <div id="templateInterview" class="template-text" style="display:none;"></div>
                            <div id="templateFollowup" class="template-text" style="display:none;"></div>
                            <div id="templateNegotiate" class="template-text" style="display:none;"></div>
                            <button class="btn btn-secondary" onclick="copyCurrentTemplate()" style="margin-top: 12px; padding: 6px 12px; font-size: 11px;">Copy Template</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 8. SAVE TO TRACKER -->
        <div id="saveToTrackerSection" class="card" style="display:none; background: var(--accent-mint);">
            <div class="card-body" style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
                <div>
                    <strong style="font-family: 'Space Mono', monospace; text-transform: uppercase; letter-spacing: 0.5px;">Save This Analysis</strong>
                    <p style="font-size: 13px; opacity: 0.8; margin-top: 4px;">Track your application status over time.</p>
                </div>
                <button class="btn btn-primary" onclick="saveToTracker()" id="saveToTrackerBtn">Save to Tracker</button>
            </div>
        </div>
    </div>
    
    <!-- APPLICATION TRACKER - NEW (Always visible) -->
    <div id="trackerCard" class="card">
        <div class="card-header">
            <span class="card-title">Application Tracker</span>
            <span id="trackerCount" style="font-family: 'Space Mono', monospace; font-size: 12px; opacity: 0.7;">0 jobs tracked</span>
        </div>
        <div class="card-body">
            <div id="trackerEmpty" class="empty-tracker">
                <p>No applications tracked yet. Analyze a job and click "Save to Tracker" to start tracking.</p>
            </div>
            <div id="trackerTableContainer" style="display: none; overflow-x: auto;">
                <table class="tracker-table">
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Role</th>
                            <th>Score</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trackerBody"></tbody>
                </table>
            </div>
        </div>
    </div>
</main>
<script>
    // ==========================================================================
    // CONFIGURATION
    // ==========================================================================
    const API_ENDPOINT = 'https://76unm1rlj0.execute-api.us-east-1.amazonaws.com/default/grumpy';
    const MAX_RETRIES = 3;
    const RETRY_DELAY_MS = 2000;
    let analysisData = null;
    let loadingInterval = null;
    // ==========================================================================
    // DOUG'S FULL PROFILE (Single Source of Truth)
    // ==========================================================================
    const dougProfile = {
        clearances: "Top Secret/SCI with Full Scope Polygraph | SAP Cleared",
        certifications: "PMP | AWS Certified Cloud Practitioner | Security+ | Network+ | ISSA Member | Northrop Grumman PM Level I/II",
        education: { 
            institution: "United States Military Academy at West Point", 
            degree: "Bachelor of Science, Management and Engineering" 
        },
        military: { 
            rank: "Major", 
            branch: "United States Army", 
            unit: "Special Operations Command — Delta Force (1st SFOD-D)",
            decorations: ["Bronze Star", "Defense Meritorious Service Medal"],
            training: [
                "Delta Operator Training Course",
                "Special Forces Qualification Course (18-Series)",
                "Ranger School",
                "Airborne",
                "Military Free Fall (HALO/HAHO)",
                "Pathfinder",
                "Air Assault",
                "Jungle Warfare School"
            ]
        },
        expertise: {
            contracts: ["GWAC", "IDIQ/IDOA", "8(a)", "HUBZone", "SDVOSB", "GSA Schedule"],
            customers: ["DoD (Army, Navy, Air Force, USSOCOM)", "Intelligence Community (All 18 Agencies)", "DHS", "DoS", "DoE", "NASA"],
            capture: ["FAR/DFARS", "CPARS", "Past Performance", "Price-to-Win", "Color Team Reviews", "Orals Coaching"],
            security: ["TS/SCI", "SAP", "SCIF Operations", "Compartmented Programs", "Polygraph"],
            compliance: ["ISO 9001", "AS9100", "PSC.1", "ICoCA", "OSHA", "ITAR"]
        },
        experiences: [
            { 
                company: "Centre Support Services LLC", 
                location: "Fairfax, VA", 
                title: "Chief Operating Officer", 
                period: "2024–Present", 
                summary: "Executive operational leader for six geographically dispersed operating companies serving Intelligence Community, Department of Defense, federal law enforcement, and commercial customers. Portfolio: $110M+ annual revenue, 190 staff.", 
                bullets: [
                    "Assumed COO role following sustained financial losses, quality failures, and leadership gaps.",
                    "Restored profitability and stakeholder confidence within one year.",
                    "Increased revenue from $6.4M (2023) to $8.9M (2024); tracking $16M+ in 2025.",
                    "Reduced staff turnover by 30% and passed two OSHA audits.",
                    "Implemented formal operating cadence, quality controls, and executive reporting."
                ] 
            },
            { 
                company: "PTR Industries Inc.", 
                location: "Aynor, SC", 
                title: "Chief Operating Officer (Interim)", 
                period: "2024", 
                summary: "Stabilized manufacturing operations following prolonged losses and morale issues.", 
                bullets: [
                    "Implemented quality control programs reducing test failures by 12% and material scrap by 23%."
                ] 
            },
            { 
                company: "Revolutionary Technologies Inc.", 
                location: "Columbia, SC", 
                title: "Operating Executive", 
                period: "2024", 
                summary: "Led additive manufacturing and CNC operations producing complex titanium and Inconel components.", 
                bullets: [
                    "Managed 18+ staff across five 3D printing platforms, lathe, mill, and wire EDM operations.",
                    "Achieved AS9100 certification in 2025."
                ] 
            },
            { 
                company: "Amazon Web Services", 
                location: "Arlington, VA", 
                title: "Principal, Partner Sales Manager / Senior Partner Account Manager", 
                period: "2018–2023", 
                summary: "Led National Security partner sales strategy driving classified cloud adoption across Intelligence Community. Strategic partnerships with defense primes: GDIT, Northrop Grumman, Raytheon/RTX, Lockheed Martin, SAIC, BAE Systems.", 
                bullets: [
                    "Managed portfolio of $1B+ in annual cloud revenue through partner-led delivery model.",
                    "Directly engaged CIOs, CTOs, and program executives on mission-critical workload migration.",
                    "Led team of 25 sales and technical leaders delivering partner-led cloud revenue at scale.",
                    "2023: Delivered $1.4B in AWS revenue (117% of goal) across IC customers.",
                    "2022: Delivered $580.1M across 156 partners (107% of goal).",
                    "Closed $97.5M in committed AWS contracts with Northrop Grumman within first year (largest partner-led deal in AWS Public Sector).",
                    "Architected capture strategies where AWS served as prime cloud provider for SAP and SCI environments.",
                    "Selected Top 1% of Amazon employees (2019, 2020); promoted to Level 7 ahead of peers.",
                    "Certified Amazon Bar Raiser; conducted 195 executive and technical interviews."
                ] 
            },
            { 
                company: "Chenega Corporation", 
                location: "Chantilly, VA", 
                title: "President and Program Director", 
                period: "2015–2018", 
                summary: "President of two Chenega subsidiaries managing $29M in annual prime contracts and 500+ personnel across NASA, DoD, and DoS CONUS and OCONUS locations. Led complete business development lifecycle from capture through contract execution.", 
                bullets: [
                    "Senior capture leader on the $12B+ Worldwide Protective Services II (WPS II) IDIQ win (Department of State).",
                    "Directed operations at NASA Cape Kennedy, NASA Johnson Space Center, NASA White Sands, Walter Reed Medical Center, and Naval facilities in Japan.",
                    "Achieved 100% CPARS \"Exceptional\" ratings across all task orders.",
                    "Negotiated and managed high-risk insurance strategies and threat mitigation for OCONUS operations.",
                    "Built strategic relationships with NASA, DoD, and DoS contracting officers and program managers."
                ] 
            },
            { 
                company: "Northrop Grumman Corporation", 
                location: "Chantilly, VA", 
                title: "Program Director, CNTPO and Classified Programs", 
                period: "2009–2015", 
                summary: "Program Director for the Counter Narco-Terrorism Technology Program Office, a five-year $15B IDIQ supporting global counter-narcotics and counter-terrorism missions.", 
                bullets: [
                    "Managed 82 task orders totaling $1.01B across 34 countries with 372 personnel.",
                    "Led PMO of 35 staff and 25 subcontractor companies; oversaw $135M+ in recurring contracts.",
                    "Submitted 114 proposals; won 46 totaling $682M (40% win rate).",
                    "Directed aviation training programs for Afghan Army across seven bases with zero casualties over five years.",
                    "Managed multiple Special Access Programs for USSOCOM and USG customers."
                ] 
            },
            { 
                company: "Osen-Hunter Group, LLC", 
                location: "Madison, VA", 
                title: "Vice President, Operations", 
                period: "2008–2009", 
                summary: "Managed operations for a $7M+ SDVOSB supporting Intelligence Community missions.", 
                bullets: [
                    "Served as Proposal Manager on 15 submissions, winning six awards totaling $4.9M."
                ] 
            },
            { 
                company: "Triple Canopy Inc.", 
                location: "Herndon, VA", 
                title: "Director of Operations / Program Director / Director of Training", 
                period: "2004–2008", 
                summary: "Led growth of international security operations from startup to $198M+ in revenue.", 
                bullets: [
                    "Scaled international security operations from startup to more than $198M in revenue in under 20 months.",
                    "Led 120-day mobilization for Department of State's largest contract at the time (U.S. Embassy Baghdad).",
                    "Recruited, trained, cleared, and deployed 1,100 personnel."
                ] 
            }
        ]
    };
    // ==========================================================================
    // UTILITIES
    // ==========================================================================
    const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));
    function escapeHtml(str) {
        if (!str) return '';
        return str.replace(/[&<>"']/g, m => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' })[m]);
    }
    function startLoadingAnim() {
        const card = document.getElementById('loadingCard');
        const stepText = document.getElementById('loadingStep');
        const bar = document.getElementById('loadingProgress');
        // Show Card, Hide Results
        card.style.display = 'block';
        document.getElementById('analysisResults').style.display = 'none';
        // --- NEW: Scroll the loading card into view (centered) ---
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        // Animation Sequence
        let progress = 5;
        const steps = [
            { pct: 15, msg: "Reading Job Description..." },
            { pct: 35, msg: "Extracting Key Requirements..." },
            { pct: 55, msg: "Comparing Against Profile..." },
            { pct: 75, msg: "Identifying Strategic Gaps..." },
            { pct: 90, msg: "Drafting Interview Questions..." },
            { pct: 95, msg: "Finalizing Strategy..." }
        ];
        let stepIndex = 0;
        bar.style.width = '5%';
        stepText.innerText = steps[0].msg;
        loadingInterval = setInterval(() => {
            if (stepIndex < steps.length) {
                const step = steps[stepIndex];
                progress = step.pct;
                bar.style.width = `${progress}%`;
                stepText.innerText = step.msg;
                stepIndex++;
            }
        }, 800);
    }
    function stopLoadingAnim() {
        clearInterval(loadingInterval);
        const bar = document.getElementById('loadingProgress');
        const stepText = document.getElementById('loadingStep');
        bar.style.width = '100%';
        stepText.innerText = "Analysis Complete!";
        setTimeout(() => {
            document.getElementById('loadingCard').style.display = 'none';
        }, 500);
    }
    function showCopyNotice() {
        const el = document.getElementById('copyNotice');
        if(el) {
            el.style.opacity = '1';
            el.style.transform = 'translateY(0)';
            setTimeout(() => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(100px)';
            }, 2000);
        }
    }
    // ==========================================================================
    // ERROR HANDLING (Styled inline messages instead of alert())
    // ==========================================================================
    let errorToastTimeout = null;
    /**
     * Show inline error (for form validation errors - appears below the form)
     */
    function showInlineError(message) {
        const errorDiv = document.getElementById('inlineError');
        const errorText = document.getElementById('inlineErrorText');
        errorText.textContent = message;
        errorDiv.classList.remove('show');
        // Force reflow to restart animation
        void errorDiv.offsetWidth;
        errorDiv.classList.add('show');
        // Auto-hide after 8 seconds
        setTimeout(() => {
            hideInlineError();
        }, 8000);
    }
    function hideInlineError() {
        const errorDiv = document.getElementById('inlineError');
        errorDiv.classList.remove('show');
    }
    /**
     * Show error toast (for API/network errors - appears at bottom of screen)
     */
    function showErrorToast(message, duration = 6000) {
        const toast = document.getElementById('errorToast');
        const toastText = document.getElementById('errorToastText');
        // Clear any existing timeout
        if (errorToastTimeout) {
            clearTimeout(errorToastTimeout);
        }
        toastText.textContent = message;
        toast.classList.add('show');
        // Auto-hide after duration
        errorToastTimeout = setTimeout(() => {
            hideErrorToast();
        }, duration);
    }
    function hideErrorToast() {
        const toast = document.getElementById('errorToast');
        toast.classList.remove('show');
        if (errorToastTimeout) {
            clearTimeout(errorToastTimeout);
            errorToastTimeout = null;
        }
    }
    function toggleQuickStart() {
        const card = document.getElementById('quickStartCard');
        const icon = document.getElementById('quickStartToggleIcon');
        const trigger = card.querySelector('.collapsible-trigger');
        if (card.classList.contains('collapsed')) {
            card.classList.remove('collapsed');
            icon.textContent = '−';
            trigger.setAttribute('aria-expanded', 'true');
        } else {
            card.classList.add('collapsed');
            icon.textContent = '+';
            trigger.setAttribute('aria-expanded', 'false');
        }
    }
    function toggleJobSearch() {
        const card = document.getElementById('jobSearchCard');
        const icon = document.getElementById('jobSearchToggleIcon');
        const trigger = card.querySelector('.collapsible-trigger');
        if (card.classList.contains('collapsed')) {
            card.classList.remove('collapsed');
            icon.textContent = '−';
            trigger.setAttribute('aria-expanded', 'true');
        } else {
            card.classList.add('collapsed');
            icon.textContent = '+';
            trigger.setAttribute('aria-expanded', 'false');
        }
    }
    function collapseAllCards() {
        // Collapse Quick Start
        const quickStartCard = document.getElementById('quickStartCard');
        const quickStartIcon = document.getElementById('quickStartToggleIcon');
        if (quickStartCard && !quickStartCard.classList.contains('collapsed')) {
            quickStartCard.classList.add('collapsed');
            quickStartIcon.textContent = '+';
            quickStartCard.querySelector('.collapsible-trigger').setAttribute('aria-expanded', 'false');
        }
        // Collapse Job Search
        const jobSearchCard = document.getElementById('jobSearchCard');
        const jobSearchIcon = document.getElementById('jobSearchToggleIcon');
        if (jobSearchCard && !jobSearchCard.classList.contains('collapsed')) {
            jobSearchCard.classList.add('collapsed');
            jobSearchIcon.textContent = '+';
            jobSearchCard.querySelector('.collapsible-trigger').setAttribute('aria-expanded', 'false');
        }
    }
    
    // Toggle kit cards (Application Kit, Interview Kit, Outreach Kit)
    function toggleKit(kitName) {
        const card = document.getElementById(kitName + 'KitCard');
        const icon = document.getElementById(kitName + 'KitToggle');
        const trigger = card.querySelector('.collapsible-trigger');
        if (card.classList.contains('collapsed')) {
            card.classList.remove('collapsed');
            icon.textContent = '−';
            trigger.setAttribute('aria-expanded', 'true');
        } else {
            card.classList.add('collapsed');
            icon.textContent = '+';
            trigger.setAttribute('aria-expanded', 'false');
        }
    }
// ==========================================================================
// SEARCH UTILITIES (HUNTER-KILLER)
// ==========================================================================
function runDork(site) {
    const role = document.getElementById('targetRole').value.trim() || "Director";
    const kw = document.getElementById('targetKeyword').value.trim() || "TS/SCI";
    // Construct a Google Dork query: site:greenhouse.io "Director" "TS/SCI"
    // Added tbs=qdr:m to restrict results to past month (fresher postings)
    const query = `site:${site} "${role}" "${kw}"`;
    const url = `https://www.google.com/search?q=${encodeURIComponent(query)}&tbs=qdr:m`;
    window.open(url, '_blank');
}
function runLinkedIn() {
    const role = document.getElementById('targetRole').value.trim() || "Director";
    const kw = document.getElementById('targetKeyword').value.trim() || "TS/SCI";
    // LinkedIn Search URL with "Date Posted: Past 24 hours" filter (f_TPR=r86400)
    const url = `https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(role + " " + kw)}&f_TPR=r604800`;
    window.open(url, '_blank');
}
function runClearanceJobs() {
    const role = document.getElementById('targetRole').value.trim() || "Director";
    const kw = document.getElementById('targetKeyword').value.trim() || "TS/SCI";
    // ClearanceJobs query format - include keyword for clearance filtering
    const url = `https://www.clearancejobs.com/jobs?keywords=${encodeURIComponent(role + " " + kw)}`;
    window.open(url, '_blank');
}
function runIndeed() {
    const role = document.getElementById('targetRole').value.trim() || "Director";
    const kw = document.getElementById('targetKeyword').value.trim() || "TS/SCI";
    // Indeed search - fromage=7 restricts to last 7 days
    const url = `https://www.indeed.com/jobs?q=${encodeURIComponent(role + " " + kw)}&fromage=7`;
    window.open(url, '_blank');
}
function runUSAJobs() {
    const role = document.getElementById('targetRole').value.trim() || "Director";
    // USAJobs federal job search - gs=15 filters for GS-15 level (executive)
    const url = `https://www.usajobs.gov/Search/Results?k=${encodeURIComponent(role)}&p=1`;
    window.open(url, '_blank');
}
    // ==========================================================================
    // MAIN ANALYSIS LOGIC (Two-call architecture)
    // ==========================================================================
    async function analyzeJob() {
        const jd = document.getElementById('jobDescription').value.trim();
        // Hide any previous inline error
        hideInlineError();
        // Collapse both helper cards
        collapseAllCards();
        if (!jd) { 
            showInlineError("Please paste a Job Description first.");
            return; 
        }
        // UI Reset
        document.getElementById('analysisResults').style.display = 'none';
        const btn = document.getElementById('analyzeBtn');
        const btnText = document.getElementById('btnText');
        btn.disabled = true;
        btnText.textContent = "Analyzing...";
        // START THE NEW ANIMATION (Auto-Scrolls now!)
        startLoadingAnim(); 
        let lastError = null;
        
        // === CALL 1: Resume Fit Analysis ===
        for (let attempt = 1; attempt <= MAX_RETRIES; attempt++) {
            try {
                if (attempt > 1) {
                    btnText.textContent = `Retry ${attempt}/${MAX_RETRIES}...`;
                    await sleep(RETRY_DELAY_MS);
                }
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        situation: jd, 
                        request_type: 'resume_match' 
                    })
                });
                const data = await response.json();
                // Handle rate limiting (429) - don't retry, just inform user
                if (response.status === 429) {
                    stopLoadingAnim();
                    const retryMinutes = data.retryAfter ? Math.ceil(data.retryAfter / 60) : 5;
                    showErrorToast(data.error || `Rate limit exceeded. Please try again in ${retryMinutes} minutes.`, 10000);
                    btn.disabled = false;
                    btnText.textContent = "Analyze Match";
                    return;
                }
                if (!response.ok) {
                    throw new Error(data.error || `Server Error ${response.status}`);
                }
                // Success - Call 1 complete
                analysisData = data;
                // STOP ANIMATION
                stopLoadingAnim();
                // Wait 500ms for the animation to finish closing, then show results
                setTimeout(() => {
                    renderResults(data);
                }, 500);
                btn.disabled = false;
                btnText.textContent = "Analyze Match";
                
                // === CALL 2: Market Intel (runs in background, non-blocking) ===
                fetchMarketIntel(jd, data.job_title, data.company);
                
                return;
            } catch (error) {
                console.error(`Attempt ${attempt} failed:`, error);
                lastError = error;
                // Don't retry for non-transient errors
                if (!error.message.includes('fetch') && !error.message.includes('timed out') && !error.message.includes('unavailable')) {
                    break;
                }
            }
        }
        // Failure
        stopLoadingAnim();
        showErrorToast(`Analysis failed after ${MAX_RETRIES} attempts: ${lastError?.message || 'Unknown error'}`, 8000);
        btn.disabled = false;
        btnText.textContent = "Analyze Match";
    }
    
    // === CALL 2: Market Intel (Background fetch) ===
    async function fetchMarketIntel(jobDescription, jobTitle, company) {
        // Show loading state in intel panels
        const intelSection = document.getElementById('jobIntelSection');
        if (intelSection) {
            intelSection.style.display = 'block';
            document.getElementById('salaryRange').textContent = 'Loading...';
            document.getElementById('competitionLevel').textContent = 'Loading...';
        }
        
        try {
            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    request_type: 'market_intel',
                    job_description: jobDescription,
                    job_title: jobTitle,
                    company: company
                })
            });
            
            if (!response.ok) {
                throw new Error('Market intel request failed');
            }
            
            const intelData = await response.json();
            
            // Merge intel data into analysisData
            if (analysisData) {
                analysisData.salary_intel = intelData.salary_intel;
                analysisData.competition = intelData.competition;
                analysisData.flags = intelData.flags;
                analysisData.company_intel = intelData.company_intel;
                analysisData.timeline = intelData.timeline;
            }
            
            // Render the intel sections
            renderJobIntel(analysisData);
            renderCompanyIntel(analysisData);
            
            console.log('[MARKET INTEL] Successfully loaded');
        } catch (error) {
            console.error('[MARKET INTEL] Failed:', error.message);
            // Hide intel section on failure - don't show fake data
            if (intelSection) {
                intelSection.style.display = 'none';
            }
        }
    }
    // ==========================================================================
    // RENDER RESULTS
    // ==========================================================================
    function renderResults(data) {
        document.getElementById('analysisResults').style.display = 'block';
        // 1. Score Hero
        const scoreClass = data.score >= 80 ? 'score-high' : (data.score >= 60 ? 'score-mid' : 'score-low');
        const scoreHTML = `
            <div class="score-box">
                <div class="score-val">${data.score}%</div>
                <div class="score-label">Match Score</div>
            </div>
            <div class="verdict-box">
                <h3 style="margin-bottom: 8px;">${escapeHtml(data.verdict)}</h3>
                <p style="opacity: 0.7; font-size: 14px;">
                    <strong>Role:</strong> ${escapeHtml(data.job_title)}<br>
                    <strong>Company:</strong> ${escapeHtml(data.company)}
                </p>
            </div>
        `;
        const scoreContainer = document.getElementById('matchScoreContainer');
        scoreContainer.className = `hero-grid ${scoreClass}`;
        scoreContainer.innerHTML = scoreHTML;
        // 2. Analysis List
        const list = document.getElementById('analysisList');
        list.innerHTML = '';
        const gaps = data.analysis.filter(x => /gap|risk|missing/i.test(x));
        const matches = data.analysis.filter(x => !/gap|risk|missing/i.test(x));
        [...gaps, ...matches].forEach(item => {
            const isGap = /gap|risk|missing/i.test(item);
            const li = document.createElement('li');
            li.className = `analysis-item ${isGap ? 'item-gap' : 'item-match'}`;
            li.innerHTML = `<strong>${isGap ? 'Gap / Risk' : 'Strategic Match'}</strong> ${escapeHtml(item.replace(/^(Match:|Gap:|Risk:)/i, ''))}`;
            list.appendChild(li);
        });
        // 3. Interview Questions
        const qList = document.getElementById('interviewQuestionsList');
        qList.innerHTML = '';
        if (data.interview_questions && data.interview_questions.length > 0) {
            data.interview_questions.forEach((q, i) => {
                qList.innerHTML += `
                    <div class="qa-card">
                        <div class="qa-q">Q${i+1}: ${escapeHtml(q.question)}</div>
                        <div class="qa-a">${escapeHtml(q.suggested_answer)}</div>
                    </div>`;
            });
        } else {
             document.getElementById('interviewQuestionsSection').style.display = 'none';
        }
        // 4. Gap Strategies
        const gList = document.getElementById('gapStrategiesList');
        gList.innerHTML = '';
        if (data.gap_strategies && data.gap_strategies.length > 0) {
            document.getElementById('gapStrategiesSection').style.display = 'block';
            data.gap_strategies.forEach(s => {
                gList.innerHTML += `
                    <div class="qa-card" style="border-left: 6px solid var(--accent-clay);">
                        <div class="qa-q" style="background:#fff; border-bottom:1px solid #eee;">Gap: ${escapeHtml(s.gap)}</div>
                        <div class="qa-a">
                            <strong>Strategy:</strong> ${escapeHtml(s.strategy)}<br><br>
                            <em>"${escapeHtml(s.talking_points)}"</em>
                        </div>
                    </div>`;
            });
        } else {
            document.getElementById('gapStrategiesSection').style.display = 'none';
        }
        // 5. Generate Resume Preview (now inside Application Kit)
        generateResumeHTML(data.tailored_summary);
        // Reset Intro Email
        document.getElementById('coverLetterDisplay').style.display = 'none';
        document.getElementById('coverLetterPlaceholder').style.display = 'block';
        document.getElementById('copyCLBtn').style.display = 'none';
        
        // 6. Render Keywords (inside Application Kit)
        renderKeywords(data);
        
        // 7. Render Network Finder (inside Outreach Kit)
        renderNetworkFinder(data);
        
        // 8. Render Follow-up Templates (inside Outreach Kit)
        renderTemplates(data);
        
        // 9. Show save to tracker button
        document.getElementById('saveToTrackerSection').style.display = 'block';
        
        // NOTE: Job Intel (salary, competition, timeline) and Flags are rendered 
        // by fetchMarketIntel() when Call 2 completes (runs in background)
        // Hide intel section initially - it'll show when data arrives
        document.getElementById('jobIntelSection').style.display = 'none';
    }
    // ==========================================================================
    // RESUME GENERATION (FULL DETAIL)
    // ==========================================================================
    function generateResumeHTML(aiSummary) {
        const out = document.getElementById('resumeOutput');
        let html = `<h2>Doug Datka</h2>`;
        html += `<p>Centreville, Virginia | 312.399.0776 | DougDatka@mac.com</p>`;
        html += `<p><strong>${dougProfile.clearances}</strong><br>`;
        html += `${dougProfile.certifications}</p>`;
        html += `<h2>Executive Summary</h2>`;
        html += `<p>${escapeHtml(aiSummary)}</p>`;
        html += `<h2>Professional Experience</h2>`;
        dougProfile.experiences.forEach(exp => {
            html += `<div style="margin-bottom: 24px;">`;
            html += `<h3 style="font-size:15px; margin-bottom:4px;">${escapeHtml(exp.company)} — ${escapeHtml(exp.location)}</h3>`;
            html += `<div style="font-size:13px; font-weight:700; margin-bottom:8px;">${escapeHtml(exp.title)} | ${escapeHtml(exp.period)}</div>`;
            html += `<p><em>${escapeHtml(exp.summary)}</em></p>`;
            html += `<ul style="margin-top:8px; padding-left:20px;">`;
            exp.bullets.forEach(b => {
                html += `<li style="margin-bottom:4px;">${escapeHtml(b)}</li>`;
            });
            html += `</ul></div>`;
        });
        html += `<h2>Military Service</h2>`;
        html += `<p><strong>${dougProfile.military.rank}, ${dougProfile.military.branch}</strong><br>`;
        html += `${dougProfile.military.unit}<br>`;
        html += `Decorations: ${dougProfile.military.decorations.join(', ')}</p>`;
        html += `<p>Training: ${dougProfile.military.training.join(', ')}</p>`;
        html += `<h2>Education</h2>`;
        html += `<p><strong>${dougProfile.education.institution}</strong><br>${dougProfile.education.degree}</p>`;
        html += `<h2>Federal Market Expertise</h2>`;
        html += `<p><strong>Contract Vehicles:</strong> ${dougProfile.expertise.contracts.join(', ')}<br>`;
        html += `<strong>Customers:</strong> ${dougProfile.expertise.customers.join(', ')}<br>`;
        html += `<strong>Capture:</strong> ${dougProfile.expertise.capture.join(', ')}<br>`;
        html += `<strong>Security:</strong> ${dougProfile.expertise.security.join(', ')}</p>`;
        out.innerHTML = html;
    }
    // ==========================================================================
    // INTRO EMAIL & UTILS
    // ==========================================================================
    async function generateCoverLetter() {
        if (!analysisData) return;
        const btn = document.getElementById('generateCoverLetterBtn');
        const originalText = btn.innerHTML;
        btn.innerHTML = "Writing Email..."; 
        btn.disabled = true;
        try {
            const res = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    request_type: "generate_cover_letter", 
                    job_description: document.getElementById("jobDescription").value, 
                    analysis_data: analysisData 
                })
            });
            const data = await res.json();
            if(data.cover_letter) {
                // Clean up any potential markdown or placeholders
                let cleanLetter = data.cover_letter.replace(/\[.*?\]/g, '').trim();
                document.getElementById('coverLetterDisplay').textContent = cleanLetter;
                document.getElementById('coverLetterDisplay').style.display = 'block';
                document.getElementById('coverLetterPlaceholder').style.display = 'none';
                document.getElementById('copyCLBtn').style.display = 'inline-block';
            } else {
                throw new Error("No intro email returned");
            }
        } catch(e) { 
            showErrorToast("Error generating letter: " + e.message); 
        } finally { 
            btn.innerHTML = originalText; 
            btn.disabled = false; 
        }
    }
    function copyResume() { 
        const btn = event.currentTarget;
        const originalText = btn.textContent;
        const text = document.getElementById('resumeOutput').innerText;
        navigator.clipboard.writeText(text).then(() => {
            btn.textContent = '✓ Copied!';
            btn.classList.add('copy-success');
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('copy-success');
            }, 1500);
        });
    }
    function copyCoverLetter() { 
        const btn = event.currentTarget;
        const originalText = btn.textContent;
        const text = document.getElementById('coverLetterDisplay').innerText;
        navigator.clipboard.writeText(text).then(() => {
            btn.textContent = '✓ Copied!';
            btn.classList.add('copy-success');
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('copy-success');
            }, 1500);
        });
    }
    function clearAll() { 
        document.getElementById('jobDescription').value = ''; 
        document.getElementById('analysisResults').style.display = 'none';
        analysisData = null;
        clearRecruiterChat();
    }
    function loadSampleJD() {
        document.getElementById('jobDescription').value = `Director of Federal Sales\nCompany: Palantir\n\nRequirements:\n- 10+ years selling to IC/DoD\n- TS/SCI Polygraph required\n- Experience identifying $50M+ opportunities\n- Technical background in data/software preferred.`;
    }
    // ==========================================================================
    // ASK A RECRUITER
    // ==========================================================================
    let recruiterChatHistory = [];
    async function askRecruiter() {
        const questionInput = document.getElementById('recruiterQuestion');
        const question = questionInput.value.trim();
        if (!question) {
            showErrorToast('Please enter a question.');
            return;
        }
        if (!analysisData) {
            showErrorToast('Please analyze a job first before asking questions.');
            return;
        }
        const btn = document.getElementById('askRecruiterBtn');
        const btnText = document.getElementById('askRecruiterBtnText');
        const originalText = btnText.textContent;
        const chatContainer = document.getElementById('recruiterChatHistory');
        // Show chat container
        chatContainer.style.display = 'block';
        // Add user message to UI
        const userMsg = document.createElement('div');
        userMsg.className = 'recruiter-message user';
        userMsg.innerHTML = `<span class="user-label">Doug</span><p>${escapeHtml(question)}</p>`;
        chatContainer.appendChild(userMsg);
        // Add to history
        recruiterChatHistory.push({ role: 'user', content: question });
        // Clear input
        questionInput.value = '';
        // Show thinking indicator
        const thinkingEl = document.createElement('div');
        thinkingEl.className = 'recruiter-thinking';
        thinkingEl.textContent = 'Thinking...';
        chatContainer.appendChild(thinkingEl);
        // Scroll to bottom
        chatContainer.scrollTop = chatContainer.scrollHeight;
        // Disable button
        btnText.textContent = 'Asking...';
        btn.disabled = true;
        try {
            const res = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    request_type: 'ask_recruiter',
                    question: question,
                    job_description: document.getElementById('jobDescription').value,
                    analysis_data: analysisData,
                    chat_history: recruiterChatHistory.slice(-10) // Last 10 messages for context
                })
            });
            const data = await res.json();
            // Remove thinking indicator
            thinkingEl.remove();
            if (data.error) {
                throw new Error(data.error);
            }
            if (data.response) {
                // Add recruiter response to UI
                const assistantMsg = document.createElement('div');
                assistantMsg.className = 'recruiter-message assistant';
                assistantMsg.innerHTML = formatRecruiterResponse(data.response);
                chatContainer.appendChild(assistantMsg);
                // Add to history
                recruiterChatHistory.push({ role: 'assistant', content: data.response });
                // Scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            } else {
                throw new Error('No response received');
            }
        } catch (e) {
            thinkingEl.remove();
            showErrorToast('Error: ' + e.message);
        } finally {
            btnText.textContent = originalText;
            btn.disabled = false;
        }
    }
    function formatRecruiterResponse(text) {
        // Convert markdown-style formatting to HTML with proper paragraphs
        let formatted = escapeHtml(text)
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>');
        // Split into paragraphs and wrap each
        const paragraphs = formatted.split(/\n\n+/).filter(p => p.trim());
        const bodyHtml = paragraphs.map(p => `<p>${p.replace(/\n/g, '<br>')}</p>`).join('');
        // Create header with avatar - neo brutalist style
        const headerHtml = `
            <div class="recruiter-header">
                <img src="arti.png" alt="Arti" class="recruiter-avatar">
                <div class="recruiter-info">
                    <div class="recruiter-name">Arti</div>
                    <div class="recruiter-title">Senior Federal Recruiter</div>
                </div>
                <span class="recruiter-badge">25+ Years Grumpy</span>
            </div>
        `;
        return headerHtml + bodyHtml;
    }
    function clearRecruiterChat() {
        recruiterChatHistory = [];
        const chatContainer = document.getElementById('recruiterChatHistory');
        if (chatContainer) {
            chatContainer.innerHTML = '';
            chatContainer.style.display = 'none';
        }
        const questionInput = document.getElementById('recruiterQuestion');
        if (questionInput) {
            questionInput.value = '';
        }
    }
    
    // ==========================================================================
    // NEW: JOB INTEL DASHBOARD (Using AI-generated data)
    // ==========================================================================
    function renderJobIntel(data) {
        // Only show if we have the new AI-generated intel fields
        if (!data.salary_intel && !data.competition && !data.timeline) {
            document.getElementById('jobIntelSection').style.display = 'none';
            return;
        }
        
        document.getElementById('jobIntelSection').style.display = 'block';
        
        // Salary Intelligence (from AI)
        if (data.salary_intel) {
            const sal = data.salary_intel;
            document.getElementById('salaryRange').textContent = `$${sal.low}K - $${sal.high}K`;
            document.getElementById('salaryLow').textContent = `$${sal.low}K`;
            document.getElementById('salaryHigh').textContent = `$${sal.high}K`;
            
            // Position the target marker
            const range = sal.high - sal.low;
            const targetPos = ((sal.mid - sal.low) / range) * 100;
            const marker = document.querySelector('.salary-marker');
            if (marker) {
                marker.style.left = `${targetPos}%`;
                marker.setAttribute('data-label', `Target: $${sal.mid}K`);
            }
            
            // Add notes if available
            const salaryIntel = document.getElementById('salaryIntel');
            const existingNotes = salaryIntel.querySelector('.salary-notes');
            if (existingNotes) existingNotes.remove();
            if (sal.notes) {
                const notesDiv = document.createElement('div');
                notesDiv.className = 'salary-notes';
                notesDiv.style.cssText = 'font-size: 12px; opacity: 0.7; margin-top: 8px; font-style: italic;';
                notesDiv.textContent = sal.notes;
                salaryIntel.appendChild(notesDiv);
            }
        }
        
        // Competition Level (from AI)
        if (data.competition) {
            document.getElementById('competitionLevel').textContent = data.competition.level;
            document.getElementById('competitionDesc').textContent = data.competition.reasoning;
            
            // Update the intel list based on competition analysis
            const competitionIntel = document.getElementById('competitionIntel');
            const existingList = competitionIntel.querySelector('.intel-list');
            if (existingList) existingList.remove();
        }
        
        // Hiring Timeline (from AI)
        if (data.timeline) {
            const tl = data.timeline;
            const timelineContainer = document.getElementById('hiringTimeline');
            timelineContainer.innerHTML = `
                <div class="timeline-step">
                    <div class="timeline-dot">1</div>
                    <div class="timeline-label">Apply</div>
                    <div class="timeline-days">Today</div>
                </div>
                <div class="timeline-step">
                    <div class="timeline-dot">2</div>
                    <div class="timeline-label">Screen</div>
                    <div class="timeline-days">${tl.screen_weeks} wks</div>
                </div>
                <div class="timeline-step">
                    <div class="timeline-dot">3</div>
                    <div class="timeline-label">Interview</div>
                    <div class="timeline-days">${tl.interview_weeks} wks</div>
                </div>
                <div class="timeline-step">
                    <div class="timeline-dot">4</div>
                    <div class="timeline-label">Offer</div>
                    <div class="timeline-days">${tl.offer_weeks} wks</div>
                </div>
            `;
            
            // Add timeline notes if available
            if (tl.notes) {
                const notesP = document.createElement('p');
                notesP.style.cssText = 'font-size: 12px; opacity: 0.7; margin-top: 12px; text-align: center; font-style: italic;';
                notesP.textContent = tl.notes;
                timelineContainer.parentElement.appendChild(notesP);
            }
        }
    }
    
    // ==========================================================================
    // NEW: KEYWORD EXTRACTION (Using AI-generated data)
    // ==========================================================================
    function renderKeywords(data) {
        const cloud = document.getElementById('keywordCloud');
        cloud.innerHTML = '';
        
        // If no keywords, show message
        if (!data.keywords || data.keywords.length === 0) {
            cloud.innerHTML = '<span style="opacity: 0.6; font-size: 13px;">No keywords extracted</span>';
            return;
        }
        
        data.keywords.forEach(kw => {
            const tag = document.createElement('span');
            tag.className = `keyword-tag ${kw.in_resume ? 'in-resume' : 'missing'}`;
            tag.innerHTML = `${escapeHtml(kw.term)}`;
            
            // Add importance indicator
            if (kw.importance === 'critical') {
                tag.innerHTML += ' <span style="font-size:9px; opacity:0.7;">★</span>';
                tag.title = `CRITICAL: ${kw.in_resume ? 'Already in your resume' : 'Should add to resume'}`;
            } else {
                tag.title = kw.in_resume ? 'In your resume' : 'Consider adding';
            }
            
            cloud.appendChild(tag);
        });
    }
    
    function copyKeywords() {
        if (!analysisData || !analysisData.keywords) return;
        const keywords = analysisData.keywords.map(k => k.term);
        navigator.clipboard.writeText(keywords.join(', ')).then(() => {
            showErrorToast('Keywords copied to clipboard!', 2000);
        });
    }
    
    // ==========================================================================
    // COMPANY INTEL (renders inside Job Intel card)
    // ==========================================================================
    function renderCompanyIntel(data) {
        const container = document.getElementById('companyIntelContainer');
        container.innerHTML = '';
        
        // Only render if we have company intel
        if (!data.company_intel || !data.company_intel.known) {
            return;
        }
        
        const ci = data.company_intel;
        container.innerHTML = `
            <div class="intel-panel" style="background: rgba(0,0,0,0.02);">
                <div class="intel-panel-header">
                    <div class="intel-panel-title">Company: ${escapeHtml(data.company || 'Unknown')}</div>
                </div>
                <ul class="intel-list">
                    <li><span>Type</span><span>${escapeHtml(ci.type)}</span></li>
                    <li><span>Size</span><span>${escapeHtml(ci.size)}</span></li>
                    <li><span>Reputation</span><span style="text-align:right; max-width:55%;">${escapeHtml(ci.reputation)}</span></li>
                    ${ci.recent_news && ci.recent_news !== 'None known' ? `<li><span>Recent News</span><span style="text-align:right; max-width:55%;">${escapeHtml(ci.recent_news)}</span></li>` : ''}
                    ${ci.culture_notes && ci.culture_notes !== 'Unknown' ? `<li><span>Culture</span><span style="text-align:right; max-width:55%;">${escapeHtml(ci.culture_notes)}</span></li>` : ''}
                </ul>
            </div>
        `;
    }
    
    // ==========================================================================
    // NEW: NETWORK FINDER (generates search URLs based on AI-identified company)
    // ==========================================================================
    function renderNetworkFinder(data) {
        const company = data.company;
        const container = document.getElementById('networkLinks');
        
        // If company is not specified, show message
        if (!company || company === 'Not Specified' || company.toLowerCase().includes('not specified')) {
            document.getElementById('networkCompany').textContent = 'Unknown Company';
            container.innerHTML = '<span style="opacity: 0.6; font-size: 13px;">Company not identified - network search unavailable</span>';
            return;
        }
        
        document.getElementById('networkCompany').textContent = company;
        
        const companyEncoded = encodeURIComponent(company);
        
        container.innerHTML = `
            <a href="https://www.linkedin.com/search/results/people/?keywords=${companyEncoded}%20AND%20(recruiter%20OR%20talent%20OR%20HR)" target="_blank" class="network-link">
                Find Recruiters
            </a>
            <a href="https://www.linkedin.com/search/results/people/?keywords=${companyEncoded}%20AND%20(director%20OR%20VP%20OR%20executive)" target="_blank" class="network-link">
                Find Executives
            </a>
            <a href="https://www.linkedin.com/search/results/people/?keywords=${companyEncoded}%20AND%20(army%20OR%20military%20OR%20veteran%20OR%20special%20operations)" target="_blank" class="network-link">
                Find Veterans
            </a>
            <a href="https://www.linkedin.com/search/results/people/?keywords=${companyEncoded}%20AND%20(AWS%20OR%20Northrop%20OR%20Chenega%20OR%20Triple%20Canopy)" target="_blank" class="network-link">
                Past Employers
            </a>
            <a href="https://www.glassdoor.com/Search/results.htm?keyword=${companyEncoded}" target="_blank" class="network-link">
                Glassdoor
            </a>
            <a href="https://www.google.com/search?q=${companyEncoded}+federal+contracts+awards" target="_blank" class="network-link">
                Contract News
            </a>
        `;
    }
    
    // ==========================================================================
    // NEW: FOLLOW-UP TEMPLATES (Personalized with AI data)
    // ==========================================================================
    let currentTemplate = 'applied';
    
    function renderTemplates(data) {
        const company = data.company && data.company !== 'Not Specified' ? data.company : '[Company]';
        const role = data.job_title || '[Role]';
        
        // Get salary target for negotiation template
        const salaryTarget = data.salary_intel ? `$${data.salary_intel.mid}K - $${data.salary_intel.high}K` : '[TARGET SALARY]';
        const salaryReasoning = data.salary_intel ? data.salary_intel.notes : 'market research and role requirements';
        
        // Get top matches for the intro email
        const topMatches = data.analysis ? data.analysis.filter(a => a.toLowerCase().startsWith('match:')).slice(0, 2) : [];
        const matchHighlights = topMatches.length > 0 
            ? topMatches.map(m => m.replace(/^match:\s*/i, '').split('→')[0].trim()).join(' and ')
            : 'relevant federal market experience';
        
        document.getElementById('templateApplied').textContent = `Subject: Following Up – ${role} Application

Hi [Recruiter Name],

I recently submitted my application for the ${role} position at ${company} and wanted to follow up to express my continued interest.

With 25+ years of federal market experience—including $1.4B in IC cloud sales at AWS and program management for $15B IDIQs—I believe my background in ${matchHighlights} aligns well with what you're looking for.

I'd welcome the opportunity to discuss how my experience can contribute to ${company}'s mission. Would you have 15-20 minutes for a brief call this week?

Best regards,
Doug Datka
312.399.0776`;
        
        document.getElementById('templateInterview').textContent = `Subject: Thank You – ${role} Interview

Hi [Interviewer Name],

Thank you for taking the time to meet with me today regarding the ${role} position. I enjoyed learning more about ${company}'s priorities and challenges.

Our conversation reinforced my enthusiasm for this opportunity. I was particularly interested in [specific topic discussed], and I'm confident my experience with ${matchHighlights} would allow me to contribute immediately.

Please don't hesitate to reach out if you need any additional information. I look forward to hearing about next steps.

Best regards,
Doug Datka
312.399.0776`;
        
        document.getElementById('templateFollowup').textContent = `Subject: Checking In – ${role} Position

Hi [Recruiter Name],

I hope this message finds you well. I wanted to check in on the status of the ${role} position at ${company}.

I remain very interested in this opportunity and am happy to provide any additional information that would be helpful for your decision-making process.

Is there an updated timeline you can share for next steps?

Best regards,
Doug Datka
312.399.0776`;
        
        document.getElementById('templateNegotiate').textContent = `Subject: RE: ${role} Offer Discussion

Hi [Recruiter/Hiring Manager],

Thank you for extending the offer for the ${role} position. I'm excited about the opportunity to join ${company}.

After reviewing the offer and considering ${salaryReasoning}, I'd like to discuss the compensation package. Based on my background—including TS/SCI with Full Scope Poly, $1.4B in federal cloud sales, and 25+ years of executive leadership—I believe a base salary in the range of ${salaryTarget} would be more aligned with the value I'll bring.

I'm also interested in discussing [signing bonus / equity / PTO / start date flexibility].

I'm committed to making this work and look forward to finding a package that reflects the mutual fit.

Best regards,
Doug Datka
312.399.0776`;
        
        showTemplate('applied');
    }
    
    function showTemplate(type) {
        currentTemplate = type;
        const templates = ['applied', 'interview', 'followup', 'negotiate'];
        templates.forEach(t => {
            const el = document.getElementById('template' + t.charAt(0).toUpperCase() + t.slice(1));
            if (el) el.style.display = t === type ? 'block' : 'none';
        });
        document.querySelectorAll('.template-tab').forEach((tab, i) => {
            tab.classList.toggle('active', templates[i] === type);
        });
    }
    
    function copyCurrentTemplate() {
        const templateId = 'template' + currentTemplate.charAt(0).toUpperCase() + currentTemplate.slice(1);
        const el = document.getElementById(templateId);
        if (el) {
            navigator.clipboard.writeText(el.textContent).then(() => {
                showErrorToast('Template copied to clipboard!', 2000);
            });
        }
    }
    
    // ==========================================================================
    // NEW: APPLICATION TRACKER (localStorage)
    // ==========================================================================
    let trackedJobs = [];
    
    function initTracker() {
        const stored = localStorage.getItem('dougOMaticTracker');
        if (stored) {
            try {
                trackedJobs = JSON.parse(stored);
                renderTracker();
            } catch (e) {
                trackedJobs = [];
            }
        }
    }
    
    function saveToTracker() {
        if (!analysisData) return;
        
        const job = {
            id: Date.now(),
            company: analysisData.company || 'Unknown',
            role: analysisData.job_title || 'Unknown Role',
            score: analysisData.score || 0,
            status: 'saved',
            date: new Date().toLocaleDateString(),
            jd: document.getElementById('jobDescription').value.substring(0, 500),
            analysis: analysisData
        };
        
        // Check for duplicates
        const exists = trackedJobs.some(j => j.company === job.company && j.role === job.role);
        if (exists) {
            showErrorToast('This job is already in your tracker!', 3000);
            return;
        }
        
        trackedJobs.unshift(job);
        localStorage.setItem('dougOMaticTracker', JSON.stringify(trackedJobs));
        renderTracker();
        
        const btn = document.getElementById('saveToTrackerBtn');
        btn.textContent = '✓ Saved!';
        btn.disabled = true;
        setTimeout(() => {
            btn.textContent = 'Save to Tracker';
            btn.disabled = false;
        }, 2000);
    }
    
    function renderTracker() {
        const count = document.getElementById('trackerCount');
        const empty = document.getElementById('trackerEmpty');
        const table = document.getElementById('trackerTableContainer');
        const tbody = document.getElementById('trackerBody');
        
        count.textContent = `${trackedJobs.length} job${trackedJobs.length !== 1 ? 's' : ''} tracked`;
        
        if (trackedJobs.length === 0) {
            empty.style.display = 'block';
            table.style.display = 'none';
            return;
        }
        
        empty.style.display = 'none';
        table.style.display = 'block';
        
        tbody.innerHTML = trackedJobs.map(job => `
            <tr>
                <td><strong>${escapeHtml(job.company)}</strong></td>
                <td>${escapeHtml(job.role)}</td>
                <td><span class="intel-badge ${job.score >= 75 ? 'green' : job.score >= 50 ? 'gold' : 'clay'}">${job.score}%</span></td>
                <td>
                    <select class="status-select" onchange="updateJobStatus(${job.id}, this.value)" style="padding: 4px 8px; font-size: 12px; border: 1px solid var(--ink-black); border-radius: 4px;">
                        <option value="saved" ${job.status === 'saved' ? 'selected' : ''}>Saved</option>
                        <option value="applied" ${job.status === 'applied' ? 'selected' : ''}>Applied</option>
                        <option value="interviewing" ${job.status === 'interviewing' ? 'selected' : ''}>Interviewing</option>
                        <option value="offered" ${job.status === 'offered' ? 'selected' : ''}>Offered</option>
                        <option value="rejected" ${job.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                    </select>
                </td>
                <td>${job.date}</td>
                <td>
                    <div class="tracker-actions">
                        <button class="tracker-btn" onclick="loadTrackedJob(${job.id})">Load</button>
                        <button class="tracker-btn" onclick="deleteTrackedJob(${job.id})">×</button>
                    </div>
                </td>
            </tr>
        `).join('');
    }
    
    function updateJobStatus(id, status) {
        const job = trackedJobs.find(j => j.id === id);
        if (job) {
            job.status = status;
            localStorage.setItem('dougOMaticTracker', JSON.stringify(trackedJobs));
        }
    }
    
    function loadTrackedJob(id) {
        const job = trackedJobs.find(j => j.id === id);
        if (job && job.analysis) {
            document.getElementById('jobDescription').value = job.jd || '';
            analysisData = job.analysis;
            renderResults(job.analysis);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }
    
    function deleteTrackedJob(id) {
        if (confirm('Remove this job from tracker?')) {
            trackedJobs = trackedJobs.filter(j => j.id !== id);
            localStorage.setItem('dougOMaticTracker', JSON.stringify(trackedJobs));
            renderTracker();
        }
    }
    
    // Initialize tracker on page load
    document.addEventListener('DOMContentLoaded', initTracker);
</script>
<!-- Error Toast (for API/network errors) -->
<div id="errorToast" class="error-toast" role="alert" aria-live="assertive">
    <span id="errorToastText"></span>
    <button class="error-toast-close" onclick="hideErrorToast()" aria-label="Dismiss error message">×</button>
</div>
</body>
</html>